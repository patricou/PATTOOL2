<!-- Standard Title Section -->
<div class="pat-title">
    <h2>{{ "LOCAL_NETWORK.TITLE" | translate }}</h2>
    <app-navigation-buttons></app-navigation-buttons>
</div>

<!-- Main Content -->
<div class="container mt-0">
    <div class="row justify-content-center">
        <div class="col-12" *ngIf="isAuthorized">
            
            <!-- Scan Control Section -->
            <div class="scan-control-section">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fa fa-network-wired"></i> {{ "LOCAL_NETWORK.SCAN_CONTROL" | translate }}</h3>
                    </div>
                    <div class="card-body">
                        <div class="scan-buttons">
                            <button (click)="startScan()" 
                                    class="btn btn-primary btn-sm" 
                                    [disabled]="isScanning">
                                <i class="fa fa-search" *ngIf="!isScanning"></i>
                                <i class="fa fa-spinner fa-spin" *ngIf="isScanning"></i>
                                {{ isScanning ? ("LOCAL_NETWORK.SCANNING" | translate) : ("LOCAL_NETWORK.START_SCAN" | translate) }}
                            </button>
                            
                            <!-- External Vendor API Switch -->
                            <div class="form-check form-switch d-flex align-items-center" style="margin-left: 1rem;">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       role="switch"
                                       id="useExternalVendorAPI"
                                       [(ngModel)]="useExternalVendorAPI"
                                       [disabled]="isScanning"
                                       [title]="'LOCAL_NETWORK.USE_EXTERNAL_VENDOR_API_TOOLTIP' | translate"
                                       style="font-size: 0.75rem;">
                                <label class="form-check-label ms-2" 
                                       for="useExternalVendorAPI"
                                       style="font-size: 0.75rem; white-space: nowrap; cursor: pointer; color: #333;">
                                    <i class="fa" [ngClass]="useExternalVendorAPI ? 'fa-cloud' : 'fa-database'" style="margin-right: 0.3rem; color: #007bff;"></i>
                                    {{ "LOCAL_NETWORK.USE_EXTERNAL_VENDOR_API" | translate }}
                                </label>
                            </div>
                            
                            <!-- Scan Scheduler Switch -->
                            <div class="form-check form-switch d-flex align-items-center" style="margin-left: 1rem;">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       role="switch"
                                       id="scanSchedulerEnabled"
                                       [checked]="scanSchedulerEnabled"
                                       (change)="toggleScanScheduler()"
                                       [disabled]="isLoadingSchedulerStatus"
                                       title="Activer/désactiver le scan automatique toutes les 10 minutes"
                                       style="font-size: 0.75rem;">
                                <label class="form-check-label ms-2" 
                                       for="scanSchedulerEnabled"
                                       style="font-size: 0.75rem; white-space: nowrap; cursor: pointer; color: #333;"
                                       (click)="!isLoadingSchedulerStatus && toggleScanScheduler()">
                                    <i class="fa" [ngClass]="scanSchedulerEnabled ? 'fa-clock-o' : 'fa-clock-o'" 
                                       [style.color]="scanSchedulerEnabled ? '#28a745' : '#6c757d'" 
                                       style="margin-right: 0.3rem;"></i>
                                    <span *ngIf="!isLoadingSchedulerStatus">
                                        Scan auto (10 min)
                                    </span>
                                    <span *ngIf="isLoadingSchedulerStatus">
                                        <i class="fa fa-spinner fa-spin"></i>
                                    </span>
                                </label>
                            </div>
                            <button (click)="openRouterInterface()" 
                                    class="btn btn-secondary btn-sm"
                                    [title]="'LOCAL_NETWORK.OPEN_ROUTER_TOOLTIP' | translate">
                                <i class="fa fa-wifi"></i>
                                {{ "LOCAL_NETWORK.OPEN_ROUTER" | translate }}
                            </button>
                            <button (click)="openDeviceMappingsModal()" 
                                    class="btn btn-info btn-sm"
                                    [title]="'LOCAL_NETWORK.VIEW_MAPPINGS_TOOLTIP' | translate">
                                <i class="fa fa-database"></i>
                                {{ "LOCAL_NETWORK.VIEW_MAPPINGS" | translate }}
                            </button>
                            <button (click)="openMacVendorMappingsModal()" 
                                    class="btn btn-warning btn-sm"
                                    [title]="'LOCAL_NETWORK.VIEW_VENDOR_MAPPINGS_TOOLTIP' | translate">
                                <i class="fa fa-industry"></i>
                                {{ "LOCAL_NETWORK.VIEW_VENDOR_MAPPINGS" | translate }}
                            </button>
                        </div>
                        
                        <!-- Progress Section -->
                        <div *ngIf="isScanning || scanProgress > 0" class="progress-section mt-3">
                            <div class="progress mb-2">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar"
                                     [attr.aria-valuenow]="scanProgress"
                                     aria-valuemin="0"
                                     aria-valuemax="100"
                                     [style.width.%]="scanProgress">
                                    {{ scanProgress }}%
                                </div>
                            </div>
                            <div class="progress-info text-muted small">
                                <span *ngIf="isScanning">
                                    <i class="fa fa-spinner fa-spin"></i>
                                    {{ "LOCAL_NETWORK.SCANNING" | translate }}: {{ scanProgressText }}
                                    <span *ngIf="devices.length > 0"> - {{ devices.length }} {{ "LOCAL_NETWORK.DEVICES_FOUND" | translate }}</span>
                                </span>
                                <span *ngIf="!isScanning && scanProgress === 100">
                                    <i class="fa fa-check-circle text-success"></i>
                                    {{ "LOCAL_NETWORK.SCAN_COMPLETE" | translate }}
                                </span>
                            </div>
                        </div>

                        <div *ngIf="lastScanTime" class="mt-2 text-muted">
                            <i class="fa fa-clock-o"></i>
                            {{ "LOCAL_NETWORK.LAST_SCAN" | translate }}: {{ lastScanTime | date:'short' }}
                        </div>

                        <div *ngIf="errorMessage" class="alert alert-danger mt-3">
                            <i class="fa fa-exclamation-circle"></i> {{ errorMessage }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Section -->
            <div class="statistics-section mt-4" *ngIf="devices.length > 0">
                <div class="row">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-value">{{ devices.length }}</div>
                            <div class="stat-label">{{ "LOCAL_NETWORK.DEVICES_FOUND" | translate }}</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-value text-danger">{{ getCriticalVulnerabilities() }}</div>
                            <div class="stat-label">{{ "LOCAL_NETWORK.CRITICAL_VULN" | translate }}</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-value text-warning">{{ getHighVulnerabilities() }}</div>
                            <div class="stat-label">{{ "LOCAL_NETWORK.HIGH_VULN" | translate }}</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-value">{{ getTotalVulnerabilities() }}</div>
                            <div class="stat-label">{{ "LOCAL_NETWORK.TOTAL_VULN" | translate }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Devices List -->
            <div class="devices-section mt-4" *ngIf="devices.length > 0">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="mb-0">
                        <i class="fa fa-list"></i> {{ "LOCAL_NETWORK.DEVICES" | translate }}
                        <span class="badge bg-secondary ms-2" style="font-size: 0.75rem; font-weight: normal;">
                            {{ getUnknownDevicesCount() }} inconnu{{ getUnknownDevicesCount() > 1 ? 's' : '' }} / {{ getKnownDevicesCount() }} connu{{ getKnownDevicesCount() > 1 ? 's' : '' }}
                        </span>
                    </h3>
                    <div class="sort-controls d-flex align-items-center">
                        <!-- OUI Lookup input -->
                        <div class="input-group input-group-sm me-2" style="width: 150px;">
                            <span class="input-group-text">
                                <i class="fa fa-industry"></i>
                            </span>
                            <input type="text" 
                                   class="form-control form-control-sm" 
                                   [(ngModel)]="ouiInput"
                                   (keyup.enter)="lookupVendorByOUI()"
                                   [placeholder]="'LOCAL_NETWORK.OUI_LOOKUP_PLACEHOLDER' | translate"
                                   maxlength="8"
                                   style="text-transform: uppercase;">
                            <button *ngIf="ouiInput" 
                                    class="btn btn-sm btn-outline-info" 
                                    type="button"
                                    (click)="lookupVendorByOUI()"
                                    [title]="'LOCAL_NETWORK.LOOKUP_VENDOR_BY_OUI' | translate">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                        <!-- Filter input -->
                        <div class="input-group me-3" style="width: 250px;">
                            <span class="input-group-text">
                                <i class="fa fa-search"></i>
                            </span>
                            <input type="text" 
                                   class="form-control form-control-sm" 
                                   [(ngModel)]="deviceFilter"
                                   [placeholder]="'LOCAL_NETWORK.FILTER_PLACEHOLDER' | translate">
                            <button *ngIf="deviceFilter" 
                                    class="btn btn-sm btn-outline-secondary" 
                                    type="button"
                                    (click)="deviceFilter = ''"
                                    [title]="'LOCAL_NETWORK.CLEAR_FILTER' | translate">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>
                        <!-- Sort controls -->
                        <label class="me-2" style="color: #fff;">
                            <i class="fa fa-sort"></i> {{ "LOCAL_NETWORK.SORT_BY" | translate }}:
                        </label>
                        <select class="form-select form-select-sm" 
                                style="width: auto; display: inline-block;"
                                [ngModel]="deviceSortBy"
                                (ngModelChange)="changeDeviceSort($event)">
                            <option value="vulnerabilities">{{ "LOCAL_NETWORK.SORT_VULNERABILITIES" | translate }}</option>
                            <option value="ip">{{ "LOCAL_NETWORK.SORT_IP" | translate }}</option>
                            <option value="name">{{ "LOCAL_NETWORK.SORT_NAME" | translate }}</option>
                            <option value="type">{{ "LOCAL_NETWORK.SORT_TYPE" | translate }}</option>
                            <option value="status">{{ "LOCAL_NETWORK.SORT_STATUS" | translate }}</option>
                        </select>
                        <button class="btn btn-sm btn-outline-light ms-2" 
                                (click)="changeDeviceSort(deviceSortBy)"
                                [title]="deviceSortDirection === 'asc' ? ('LOCAL_NETWORK.SORT_ASCENDING_TOOLTIP' | translate) : ('LOCAL_NETWORK.SORT_DESCENDING_TOOLTIP' | translate)">
                            <i class="fa" [ngClass]="deviceSortDirection === 'asc' ? 'fa-sort-up' : 'fa-sort-down'"></i>
                        </button>
                    </div>
                </div>
                
                <div class="devices-grid">
                    <div class="device-card" 
                         [ngClass]="{
                           'new-device': isNewDevice(device),
                           'different-ip': hasDifferentIPInMongoDB(device)
                         }" 
                         *ngFor="let device of getSortedDevices()">
                    <div class="device-header" [ngClass]="getDeviceHeaderClass(device)">
                        <div class="device-header-content">
                            <div class="device-title-section">
                                <h4 class="device-title">
                                    <i class="fa" [ngClass]="getDeviceIcon(device)"></i>
                                    <span class="device-name">{{ getDeviceDisplayName(device) }}</span>
                                </h4>
                                <div class="device-subtitle" *ngIf="device.hostname && device.hostname !== device.ipAddress && device.hostname !== getDeviceDisplayName(device)">
                                    <i class="fa fa-tag"></i>
                                    <span>{{ device.hostname }}</span>
                                </div>
                            </div>
                            <div class="device-header-actions">
                                <button (click)="openDeviceUrl(device)" 
                                        class="btn btn-xs btn-light device-open-btn"
                                        [title]="'LOCAL_NETWORK.OPEN_HTTP_TOOLTIP' | translate">
                                    <i class="fa fa-link"></i>
                                    {{ "LOCAL_NETWORK.OPEN_HTTP" | translate }}
                                </button>
                                <span class="badge device-status-badge" [ngClass]="{
                                    'badge-success': device.status === 'online',
                                    'badge-secondary': device.status === 'offline',
                                    'badge-warning': device.status === 'unknown'
                                }">
                                    {{ device.status }}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="device-body">
                        <!-- Basic Information -->
                        <div class="device-info-grid">
                            <div class="info-item" *ngIf="device.hostname && device.hostname !== device.ipAddress">
                                <i class="fa fa-tag"></i>
                                <div>
                                    <strong>{{ "LOCAL_NETWORK.HOSTNAME" | translate }}</strong>
                                    <div>{{ device.hostname }}</div>
                                </div>
                            </div>
                            <div class="info-item">
                                <i class="fa fa-network-wired"></i>
                                <div>
                                    <strong>{{ "LOCAL_NETWORK.IP_ADDRESS" | translate }}</strong>
                                    <div>{{ device.ipAddress }}</div>
                                </div>
                            </div>
                            <div class="info-item" style="display: flex !important;">
                                <i class="fa fa-cube"></i>
                                <div>
                                    <strong>{{ "LOCAL_NETWORK.DEVICE_TYPE" | translate }}</strong>
                                    <div>
                                        <span class="badge badge-primary" 
                                              style="font-size: 0.75rem; padding: 0.25rem 0.5rem; color: #000; font-weight: 600;"
                                              [title]="device.vendor ? ('Détecté via: ' + (device.macAddressSource === 'arp' ? 'MAC Address (ARP)' : device.macAddressSource === 'mongodb' ? 'MongoDB' : 'Local') + ' - Fabricant: ' + device.vendor) : 'Type détecté via ports ouverts'">
                                            <i class="fa fa-info-circle" style="margin-right: 3px; font-size: 0.7rem;"></i>
                                            {{ (device.deviceType && device.deviceType !== 'null' && device.deviceType !== 'undefined') ? device.deviceType : ("LOCAL_NETWORK.UNKNOWN_DEVICE_TYPE" | translate) }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="info-item">
                                <i class="fa fa-fingerprint"></i>
                                <div>
                                    <strong>{{ "LOCAL_NETWORK.MAC_ADDRESS" | translate }}</strong>
                                    <!-- Conflict: Both MAC addresses are different -->
                                    <div *ngIf="hasMacConflict(device)" class="mt-1">
                                        <div class="mb-2">
                                            <code style="color: #dc3545; font-weight: bold; font-size: 0.9em;" [title]="'ARP (Real Device): ' + device.macAddress">
                                                {{ device.macAddress }}
                                            </code>
                                            <span style="color: #dc3545; font-size: 0.85em; margin-left: 5px;">(ARP - Real Device)</span>
                                        </div>
                                        <div>
                                            <code style="color: #dc3545; font-weight: bold; font-size: 0.9em;" [title]="'MongoDB: ' + device.macAddressMongoDB">
                                                {{ device.macAddressMongoDB }}
                                            </code>
                                            <span style="color: #dc3545; font-size: 0.85em; margin-left: 5px;">(MongoDB)</span>
                                        </div>
                                    </div>
                                    <!-- No conflict: Single MAC address with source color -->
                                    <div *ngIf="!hasMacConflict(device) && device.macAddress" class="mt-1">
                                        <code [style.color]="getMacAddressColor(device)" style="font-weight: bold; font-size: 0.9em;" [title]="getMacAddressSourceTooltip(device)">
                                            {{ device.macAddress }}
                                        </code>
                                        <span [style.color]="getMacAddressColor(device)" style="font-size: 0.85em; margin-left: 5px;" *ngIf="device.macAddressSource === 'mongodb'">(MongoDB)</span>
                                        <span [style.color]="getMacAddressColor(device)" style="font-size: 0.85em; margin-left: 5px;" *ngIf="device.macAddressSource === 'arp'">(ARP)</span>
                                        <span [style.color]="getMacAddressColor(device)" style="font-size: 0.85em; margin-left: 5px;" *ngIf="device.macAddressSource === 'local'">(Local)</span>
                                    </div>
                                    <span *ngIf="!device.macAddress && !device.macAddressARP" class="text-muted mt-1 d-block">{{ "LOCAL_NETWORK.NOT_AVAILABLE" | translate }}</span>
                                    <!-- Vendor Info Button -->
                                    <button *ngIf="device.macAddress" 
                                            (click)="openVendorInfoModal(device.macAddress)"
                                            class="btn btn-xs btn-warning mt-2"
                                            [title]="'LOCAL_NETWORK.GET_VENDOR_INFO' | translate"
                                            style="font-size: 0.7rem; padding: 0.2rem 0.4rem;">
                                        <i class="fa fa-info-circle"></i>
                                        {{ "LOCAL_NETWORK.GET_VENDOR_INFO" | translate }}
                                    </button>
                                </div>
                            </div>
                            
                            <!-- New Device Indicator -->
                            <div class="info-item" *ngIf="isNewDevice(device)" style="grid-column: 1 / -1; margin-top: 10px; padding: 10px; background-color: rgba(255, 192, 203, 0.2); border-radius: 4px; border: 1px solid #ff69b4;">
                                <div style="text-align: center; width: 100%;">
                                    <i class="fa fa-star" style="color: #ff69b4; margin-right: 5px;"></i>
                                    <strong style="color: #ff69b4;">{{ "LOCAL_NETWORK.NEW_DEVICE_DETECTED" | translate }}</strong>
                                </div>
                            </div>
                            
                            <div class="info-item" *ngIf="device.vendor" style="grid-column: 1 / -1; margin-top: 5px; padding: 8px; background-color: rgba(23, 162, 184, 0.15); border-radius: 4px; border-left: 3px solid #17a2b8;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <i class="fa fa-industry" style="font-size: 1rem; color: #17a2b8;"></i>
                                    <div style="flex: 1;">
                                        <strong style="font-size: 0.85rem; color: #fff;">{{ "LOCAL_NETWORK.VENDOR" | translate }}</strong>
                                        <div style="margin-top: 4px;">
                                            <span class="badge" 
                                                  [ngClass]="useExternalVendorAPI ? 'badge-success' : 'badge-info'"
                                                  style="font-size: 0.75rem; padding: 0.25rem 0.5rem; font-weight: 600; white-space: normal; word-wrap: break-word; word-break: normal; overflow-wrap: break-word; display: inline-block; max-width: 100%;"
                                                  [title]="useExternalVendorAPI ? 'Fabricant détecté via API externe (macvendors.com)' : 'Fabricant détecté via base de données locale (OUI)'">
                                                <i class="fa" [ngClass]="useExternalVendorAPI ? 'fa-cloud' : 'fa-database'" style="margin-right: 3px; font-size: 0.7rem;"></i>
                                                {{ device.vendor }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="info-item" *ngIf="device.os">
                                <i class="fa fa-laptop"></i>
                                <div>
                                    <strong>{{ "LOCAL_NETWORK.OS" | translate }}</strong>
                                    <div>{{ device.os }}</div>
                                </div>
                            </div>
                            <div class="info-item" *ngIf="device.webInterface">
                                <i class="fa fa-globe"></i>
                                <div>
                                    <strong>{{ "LOCAL_NETWORK.WEB_INTERFACE" | translate }}</strong>
                                    <div>
                                        <a [href]="device.webUrl" 
                                           target="_blank" 
                                           class="btn btn-xs btn-success web-interface-btn"
                                           [title]="('LOCAL_NETWORK.OPEN_DETECTED_TOOLTIP' | translate) + ': ' + device.webUrl">
                                            <i class="fa fa-globe"></i> 
                                            {{ "LOCAL_NETWORK.OPEN_DETECTED" | translate }}
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="info-item" *ngIf="device.databaseServer">
                                <i class="fa fa-database"></i>
                                <div>
                                    <strong>{{ "LOCAL_NETWORK.DATABASE" | translate }}</strong>
                                    <div><span class="badge badge-warning">{{ device.databaseServer }}</span></div>
                                </div>
                            </div>
                            <div class="info-item" *ngIf="device.fileSharing">
                                <i class="fa fa-folder-open"></i>
                                <div>
                                    <strong>{{ "LOCAL_NETWORK.FILE_SHARING" | translate }}</strong>
                                    <div><span class="badge badge-info">{{ "LOCAL_NETWORK.ENABLED" | translate }}</span></div>
                                </div>
                            </div>
                            <div class="info-item" *ngIf="device.remoteAccess">
                                <i class="fa fa-terminal"></i>
                                <div>
                                    <strong>{{ "LOCAL_NETWORK.REMOTE_ACCESS" | translate }}</strong>
                                    <div><span class="badge badge-secondary">{{ device.remoteAccess }}</span></div>
                                </div>
                            </div>
                            <div class="info-item" *ngIf="device.lastSeen">
                                <i class="fa fa-clock-o"></i>
                                <div>
                                    <strong>{{ "LOCAL_NETWORK.LAST_SEEN" | translate }}</strong>
                                    <div>{{ device.lastSeen | date:'short' }}</div>
                                </div>
                            </div>
                        </div>

                        <!-- Services and Ports Details -->
                        <div *ngIf="hasServices(device.services)" class="services-section mt-3">
                            <h5><i class="fa fa-server"></i> {{ "LOCAL_NETWORK.SERVICES" | translate }}</h5>
                            <div class="services-list">
                                <div class="service-item" *ngFor="let service of getServicesArray(device.services)">
                                    <div class="service-header">
                                        <span class="badge badge-info">{{ service.port }}</span>
                                        <strong>{{ service.service }}</strong>
                                        <span *ngIf="service.version" class="service-version">
                                            v{{ service.version }}
                                        </span>
                                        <a [href]="'http://' + device.ipAddress + ':' + service.port" 
                                           target="_blank" 
                                           class="btn btn-xs btn-primary port-link">
                                            <i class="fa fa-link"></i> HTTP
                                        </a>
                                        <a [href]="'https://' + device.ipAddress + ':' + service.port" 
                                           target="_blank" 
                                           class="btn btn-xs btn-success port-link">
                                            <i class="fa fa-lock"></i> HTTPS
                                        </a>
                                    </div>
                                    <div class="service-details" *ngIf="service.banner || service.server || service.poweredBy">
                                        <small class="text-muted">
                                            <span *ngIf="service.server">{{ "LOCAL_NETWORK.SERVER" | translate }}: {{ service.server }}</span>
                                            <span *ngIf="service.poweredBy"> | {{ "LOCAL_NETWORK.POWERED_BY" | translate }}: {{ service.poweredBy }}</span>
                                            <span *ngIf="service.banner && !service.server"> | {{ service.banner }}</span>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Open Ports (if no detailed services) -->
                        <div *ngIf="device.openPorts && device.openPorts.length > 0 && !hasServices(device.services)" class="ports-section mt-3">
                            <h5><i class="fa fa-plug"></i> {{ "LOCAL_NETWORK.OPEN_PORTS" | translate }}</h5>
                            <div class="ports-list">
                                <div class="port-item" *ngFor="let port of device.openPorts">
                                    <span class="badge badge-info">{{ port }}</span>
                                    <a [href]="'http://' + device.ipAddress + ':' + port" 
                                       target="_blank" 
                                       class="btn btn-xs btn-primary port-link">
                                        <i class="fa fa-link"></i> HTTP
                                    </a>
                                    <a [href]="'https://' + device.ipAddress + ':' + port" 
                                       target="_blank" 
                                       class="btn btn-xs btn-success port-link">
                                        <i class="fa fa-lock"></i> HTTPS
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Vulnerabilities Section -->
                        <div *ngIf="device.vulnerabilities && device.vulnerabilities.length > 0" class="vulnerabilities-section mt-3">
                            <h5><i class="fa fa-shield"></i> {{ "LOCAL_NETWORK.VULNERABILITIES" | translate }}</h5>
                            <div class="vulnerability-item" *ngFor="let vuln of device.vulnerabilities">
                                <div class="vulnerability-header">
                                    <span class="badge" [ngClass]="getSeverityClass(vuln.severity)">
                                        {{ vuln.severity }}
                                    </span>
                                    <strong>{{ vuln.type }}</strong>
                                    <span *ngIf="vuln.port" class="text-muted ml-2">
                                        ({{ "LOCAL_NETWORK.PORT" | translate }}: {{ vuln.port }})
                                    </span>
                                </div>
                                <p class="vulnerability-description">{{ vuln.description }}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Device Footer -->
                    <div class="device-footer">
                        <!-- Add to MongoDB button (for new devices) -->
                        <button *ngIf="isNewDevice(device)" 
                                (click)="openMappingModalForDevice(device)" 
                                class="btn btn-sm btn-success w-100"
                                [title]="'LOCAL_NETWORK.ADD_TO_MONGODB_TOOLTIP' | translate">
                            <i class="fa fa-plus"></i>
                            {{ "LOCAL_NETWORK.ADD_TO_MONGODB" | translate }}
                        </button>
                        <!-- Edit in MongoDB button (for existing devices) -->
                        <button *ngIf="!isNewDevice(device)" 
                                (click)="editDeviceInMongoDB(device)" 
                                class="btn btn-sm btn-info w-100"
                                [title]="'LOCAL_NETWORK.EDIT_MAPPING' | translate">
                            <i class="fa fa-edit"></i>
                            {{ "LOCAL_NETWORK.EDIT_MAPPING" | translate }}
                        </button>
                    </div>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div class="empty-state mt-4" *ngIf="!isLoading && devices.length === 0 && !errorMessage && !isScanning">
                <div class="text-center">
                    <i class="fa fa-network-wired fa-3x text-muted mb-3"></i>
                    <p class="text-muted">{{ "LOCAL_NETWORK.NO_SCAN_YET" | translate }}</p>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Device Mappings Modal -->
<ng-template #deviceMappingsModal let-c="close" let-d="dismiss">
    <div class="modal-header slideshow-header">
        <h5 class="modal-title">
            <i class="fa fa-database"></i> {{ "LOCAL_NETWORK.DEVICE_MAPPINGS_TITLE" | translate }}
        </h5>
        <div class="d-flex align-items-center gap-2 ms-auto">
            <button (click)="showCreateMappingForm()" 
                    class="btn btn-success btn-sm"
                    [disabled]="isLoadingMappings || isSavingMapping"
                    [title]="'LOCAL_NETWORK.ADD_MAPPING' | translate">
                <i class="fa fa-plus"></i>
                <span class="d-none d-md-inline ms-1">{{ "LOCAL_NETWORK.ADD_MAPPING" | translate }}</span>
            </button>
            <button type="button" 
                    class="btn btn-outline-light btn-sm rounded-circle" 
                    (click)="closeDeviceMappingsModal()" 
                    [attr.aria-label]="'COMMUN.CLOSE' | translate"
                    style="min-width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; padding: 0;">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>
    <div class="modal-body slideshow-body" style="padding: 20px; overflow-y: auto;">
        <div *ngIf="isLoadingMappings" class="text-center text-white">
            <i class="fa fa-spinner fa-spin fa-2x"></i>
            <p class="mt-2">{{ "LOCAL_NETWORK.LOADING_MAPPINGS" | translate }}</p>
        </div>
        
        <div *ngIf="mappingsInfo && !isLoadingMappings" class="alert alert-info mb-3">
            <i class="fa fa-info-circle"></i>
            {{ mappingsInfo }}
        </div>
        
        <div *ngIf="mappingsError" class="alert alert-danger mb-3">
            <i class="fa fa-exclamation-triangle"></i>
            <strong>Erreur:</strong> {{ mappingsError }}
        </div>
        
        <div *ngIf="!isLoadingMappings && deviceMappings.length === 0 && !mappingsError && !mappingsInfo && !showMappingForm" class="text-center text-white mb-3">
            <i class="fa fa-info-circle fa-2x"></i>
            <p class="mt-2">{{ "LOCAL_NETWORK.NO_MAPPINGS" | translate }}</p>
        </div>

        <!-- Device Mapping Form -->
        <div *ngIf="showMappingForm && !isLoadingMappings" class="device-mapping-form mb-4">
            <div class="card bg-dark text-white">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fa" [ngClass]="editingMapping ? 'fa-edit' : 'fa-plus'"></i>
                        {{ editingMapping ? ("LOCAL_NETWORK.EDIT_MAPPING" | translate) : ("LOCAL_NETWORK.ADD_MAPPING" | translate) }}
                    </h5>
                </div>
                <div class="card-body">
                    <form (ngSubmit)="saveDeviceMapping()">
                        <div class="mb-3">
                            <label for="mappingIpAddress" class="form-label">{{ "LOCAL_NETWORK.IP_ADDRESS" | translate }} *</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="mappingIpAddress"
                                   [(ngModel)]="mappingForm.ipAddress"
                                   name="ipAddress"
                                   required
                                   placeholder="192.168.1.1">
                        </div>
                        <div class="mb-3">
                            <label for="mappingDeviceName" class="form-label">{{ "LOCAL_NETWORK.DEVICE_NAME" | translate }} *</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="mappingDeviceName"
                                   [(ngModel)]="mappingForm.deviceName"
                                   name="deviceName"
                                   required
                                   placeholder="Device Name">
                        </div>
                        <div class="mb-3">
                            <label for="mappingMacAddress" class="form-label">{{ "LOCAL_NETWORK.MAC_ADDRESS" | translate }}</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="mappingMacAddress"
                                   [(ngModel)]="mappingForm.macAddress"
                                   name="macAddress"
                                   placeholder="00:11:22:33:44:55">
                        </div>
                        <div class="mb-3">
                            <label for="mappingDeviceNumber" class="form-label">{{ "LOCAL_NETWORK.DEVICE_NUMBER" | translate }}</label>
                            <input type="number" 
                                   class="form-control" 
                                   id="mappingDeviceNumber"
                                   [(ngModel)]="mappingForm.deviceNumber"
                                   name="deviceNumber"
                                   placeholder="1">
                        </div>
                        <div class="d-flex gap-2">
                            <button type="submit" 
                                    class="btn btn-success"
                                    [disabled]="isSavingMapping || !mappingForm.ipAddress || !mappingForm.deviceName">
                                <i class="fa fa-spinner fa-spin" *ngIf="isSavingMapping"></i>
                                <i class="fa fa-save" *ngIf="!isSavingMapping"></i>
                                <span class="ms-1">{{ isSavingMapping ? ("LOCAL_NETWORK.SAVING" | translate) : ("LOCAL_NETWORK.SAVE" | translate) }}</span>
                            </button>
                            <button type="button" 
                                    class="btn btn-secondary"
                                    (click)="cancelMappingForm()"
                                    [disabled]="isSavingMapping">
                                <i class="fa fa-times"></i>
                                <span class="ms-1">{{ "LOCAL_NETWORK.CANCEL" | translate }}</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div *ngIf="!isLoadingMappings && deviceMappings.length > 0 && !showMappingForm" class="device-mappings-list">
            <div class="table-responsive">
                <table class="table table-dark table-striped table-hover">
                    <thead>
                        <tr>
                            <th style="cursor: default;">#</th>
                            <th (click)="sortMappings('ipAddress')" 
                                [class.sortable]="true"
                                [title]="'Cliquer pour trier par IP'">
                                {{ "LOCAL_NETWORK.IP_ADDRESS" | translate }}
                                <i class="fa" [ngClass]="getSortIcon('ipAddress')" style="margin-left: 5px;"></i>
                            </th>
                            <th (click)="sortMappings('deviceName')" 
                                [class.sortable]="true"
                                [title]="'Cliquer pour trier par nom'">
                                {{ "LOCAL_NETWORK.DEVICE_NAME" | translate }}
                                <i class="fa" [ngClass]="getSortIcon('deviceName')" style="margin-left: 5px;"></i>
                            </th>
                            <th style="cursor: default;">{{ "LOCAL_NETWORK.MAC_ADDRESS" | translate }}</th>
                            <th style="cursor: default; width: 120px;">{{ "LOCAL_NETWORK.ACTIONS" | translate }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let mapping of sortedDeviceMappings; let i = index">
                            <td>{{ mapping.deviceNumber || (i + 1) }}</td>
                            <td><code>{{ mapping.ipAddress }}</code></td>
                            <td><strong>{{ mapping.deviceName }}</strong></td>
                            <td><code>{{ mapping.macAddress || '-' }}</code></td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" 
                                            class="btn btn-outline-primary"
                                            (click)="editMapping(mapping)"
                                            [title]="'LOCAL_NETWORK.EDIT_MAPPING' | translate">
                                        <i class="fa fa-edit"></i>
                                    </button>
                                    <button type="button" 
                                            class="btn btn-outline-danger"
                                            (click)="deleteMapping(mapping)"
                                            [title]="'LOCAL_NETWORK.DELETE_MAPPING' | translate">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="text-center text-white mt-3">
                <small>{{ "LOCAL_NETWORK.TOTAL_MAPPINGS" | translate }}: {{ deviceMappings.length }}</small>
            </div>
        </div>
    </div>
</ng-template>

<!-- MAC Vendor Mappings Modal -->
<ng-template #macVendorMappingsModal let-c="close" let-d="dismiss">
    <div class="modal-header slideshow-header">
        <h5 class="modal-title">
            <i class="fa fa-industry"></i> {{ "LOCAL_NETWORK.MAC_VENDOR_MAPPINGS_TITLE" | translate }}
        </h5>
        <div class="d-flex align-items-center gap-2 ms-auto">
            <button (click)="showCreateMacVendorMappingForm()" 
                    class="btn btn-success btn-sm"
                    [disabled]="isLoadingMacVendorMappings || isSavingMacVendorMapping"
                    [title]="'LOCAL_NETWORK.ADD_VENDOR_MAPPING' | translate">
                <i class="fa fa-plus"></i>
                <span class="d-none d-md-inline ms-1">{{ "LOCAL_NETWORK.ADD_VENDOR_MAPPING" | translate }}</span>
            </button>
            <button type="button" 
                    class="btn btn-outline-light btn-sm rounded-circle" 
                    (click)="closeMacVendorMappingsModal()" 
                    [attr.aria-label]="'COMMUN.CLOSE' | translate"
                    style="min-width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; padding: 0;">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>
    <div class="modal-body slideshow-body" style="padding: 20px; overflow-y: auto;">
        <div *ngIf="isLoadingMacVendorMappings" class="text-center text-white">
            <i class="fa fa-spinner fa-spin fa-2x"></i>
            <p class="mt-2">{{ "LOCAL_NETWORK.LOADING_VENDOR_MAPPINGS" | translate }}</p>
        </div>
        
        <div *ngIf="macVendorMappingsInfo && !isLoadingMacVendorMappings" class="alert alert-info mb-3">
            <i class="fa fa-info-circle"></i>
            {{ macVendorMappingsInfo }}
        </div>
        
        <div *ngIf="macVendorMappingsError" class="alert alert-danger mb-3">
            <i class="fa fa-exclamation-triangle"></i>
            <strong>Erreur:</strong> {{ macVendorMappingsError }}
        </div>
        
        <div *ngIf="!isLoadingMacVendorMappings && macVendorMappings.length === 0 && !macVendorMappingsError && !macVendorMappingsInfo && !showMacVendorMappingForm" class="text-center text-white mb-3">
            <i class="fa fa-info-circle fa-2x"></i>
            <p class="mt-2">{{ "LOCAL_NETWORK.NO_VENDOR_MAPPINGS" | translate }}</p>
        </div>

        <!-- MAC Vendor Mapping Form -->
        <div *ngIf="showMacVendorMappingForm && !isLoadingMacVendorMappings" class="mac-vendor-mapping-form mb-4">
            <div class="card bg-dark text-white">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fa" [ngClass]="editingMacVendorMapping ? 'fa-edit' : 'fa-plus'"></i>
                        {{ editingMacVendorMapping ? ("LOCAL_NETWORK.EDIT_VENDOR_MAPPING" | translate) : ("LOCAL_NETWORK.ADD_VENDOR_MAPPING" | translate) }}
                    </h5>
                </div>
                <div class="card-body">
                    <form (ngSubmit)="saveMacVendorMapping()">
                        <div class="mb-3">
                            <label for="vendorMappingOui" class="form-label">OUI *</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="vendorMappingOui"
                                   [(ngModel)]="macVendorMappingForm.oui"
                                   name="oui"
                                   required
                                   placeholder="00:11:22"
                                   maxlength="8"
                                   style="text-transform: uppercase;">
                            <small class="form-text text-muted">Format: XX:XX:XX (premiers 3 octets de l'adresse MAC)</small>
                        </div>
                        <div class="mb-3">
                            <label for="vendorMappingVendor" class="form-label">{{ "LOCAL_NETWORK.VENDOR" | translate }} *</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="vendorMappingVendor"
                                   [(ngModel)]="macVendorMappingForm.vendor"
                                   name="vendor"
                                   required
                                   placeholder="Vendor Name">
                        </div>
                        <div class="d-flex gap-2">
                            <button type="submit" 
                                    class="btn btn-success"
                                    [disabled]="isSavingMacVendorMapping || !macVendorMappingForm.oui || !macVendorMappingForm.vendor">
                                <i class="fa fa-spinner fa-spin" *ngIf="isSavingMacVendorMapping"></i>
                                <i class="fa fa-save" *ngIf="!isSavingMacVendorMapping"></i>
                                <span class="ms-1">{{ isSavingMacVendorMapping ? ("LOCAL_NETWORK.SAVING" | translate) : ("LOCAL_NETWORK.SAVE" | translate) }}</span>
                            </button>
                            <button type="button" 
                                    class="btn btn-secondary"
                                    (click)="cancelMacVendorMappingForm()"
                                    [disabled]="isSavingMacVendorMapping">
                                <i class="fa fa-times"></i>
                                <span class="ms-1">{{ "LOCAL_NETWORK.CANCEL" | translate }}</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div *ngIf="!isLoadingMacVendorMappings && macVendorMappings.length > 0 && !showMacVendorMappingForm" class="mac-vendor-mappings-list">
            <div class="table-responsive">
                <table class="table table-dark table-striped table-hover">
                    <thead>
                        <tr>
                            <th style="cursor: default;">#</th>
                            <th (click)="sortMacVendorMappings('oui')" 
                                [class.sortable]="true"
                                [title]="'Cliquer pour trier par OUI'">
                                OUI
                                <i class="fa" [ngClass]="getMacVendorSortIcon('oui')" style="margin-left: 5px;"></i>
                            </th>
                            <th (click)="sortMacVendorMappings('vendor')" 
                                [class.sortable]="true"
                                [title]="'Cliquer pour trier par vendor'">
                                {{ "LOCAL_NETWORK.VENDOR" | translate }}
                                <i class="fa" [ngClass]="getMacVendorSortIcon('vendor')" style="margin-left: 5px;"></i>
                            </th>
                            <th (click)="sortMacVendorMappings('dateCreation')" 
                                [class.sortable]="true"
                                [title]="'Cliquer pour trier par date de création'">
                                {{ "LOCAL_NETWORK.CREATION_DATE" | translate }}
                                <i class="fa" [ngClass]="getMacVendorSortIcon('dateCreation')" style="margin-left: 5px;"></i>
                            </th>
                            <th (click)="sortMacVendorMappings('dateModification')" 
                                [class.sortable]="true"
                                [title]="'Cliquer pour trier par date de modification'">
                                {{ "LOCAL_NETWORK.MODIFICATION_DATE" | translate }}
                                <i class="fa" [ngClass]="getMacVendorSortIcon('dateModification')" style="margin-left: 5px;"></i>
                            </th>
                            <th style="cursor: default; width: 120px;">{{ "LOCAL_NETWORK.ACTIONS" | translate }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let mapping of sortedMacVendorMappings; let i = index">
                            <td>{{ i + 1 }}</td>
                            <td><code>{{ mapping.oui }}</code></td>
                            <td><strong>{{ mapping.vendor }}</strong></td>
                            <td>{{ mapping.dateCreation | date:'short' }}</td>
                            <td>{{ mapping.dateModification | date:'short' }}</td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" 
                                            class="btn btn-outline-primary"
                                            (click)="editMacVendorMapping(mapping)"
                                            [title]="'LOCAL_NETWORK.EDIT_VENDOR_MAPPING' | translate">
                                        <i class="fa fa-edit"></i>
                                    </button>
                                    <button type="button" 
                                            class="btn btn-outline-danger"
                                            (click)="deleteMacVendorMapping(mapping)"
                                            [title]="'LOCAL_NETWORK.DELETE_VENDOR_MAPPING' | translate">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="text-center text-white mt-3">
                <small>{{ "LOCAL_NETWORK.TOTAL_VENDOR_MAPPINGS" | translate }}: {{ macVendorMappings.length }}</small>
            </div>
        </div>
    </div>
</ng-template>

<!-- Vendor Info Modal -->
<ng-template #vendorInfoModal let-c="close" let-d="dismiss">
    <div class="modal-header slideshow-header">
        <h5 class="modal-title">
            <i class="fa fa-info-circle"></i> {{ "LOCAL_NETWORK.VENDOR_INFO" | translate }}
        </h5>
        <button type="button" 
                class="btn btn-outline-light btn-sm rounded-circle" 
                (click)="closeVendorInfoModal()" 
                [attr.aria-label]="'COMMUN.CLOSE' | translate"
                style="min-width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; padding: 0;">
            <i class="fa fa-times"></i>
        </button>
    </div>
    <div class="modal-body" style="background-color: #1a1a1a; color: #fff; padding: 1.5rem;">
        <div *ngIf="isLoadingVendorInfo" class="text-center py-4">
            <i class="fa fa-spinner fa-spin fa-2x"></i>
            <p class="mt-3">{{ "LOCAL_NETWORK.LOADING_VENDOR_INFO" | translate }}</p>
        </div>
        
        <div *ngIf="!isLoadingVendorInfo && vendorInfo">
            <div *ngIf="vendorInfo.success" class="vendor-info-success">
                <div class="mb-3">
                    <h6><i class="fa fa-check-circle text-success"></i> {{ "LOCAL_NETWORK.VENDOR_FOUND" | translate }}</h6>
                </div>
                <div class="vendor-details">
                    <div class="mb-2">
                        <strong>{{ "LOCAL_NETWORK.MAC_ADDRESS" | translate }}:</strong>
                        <code class="ms-2">{{ vendorInfo.macAddress }}</code>
                    </div>
                    <div class="mb-2">
                        <strong>OUI:</strong>
                        <code class="ms-2">{{ vendorInfo.oui }}</code>
                    </div>
                    <div class="mb-2">
                        <strong>{{ "LOCAL_NETWORK.VENDOR" | translate }}:</strong>
                        <span class="ms-2 badge badge-success" style="font-size: 1rem; padding: 0.5rem 1rem;">
                            {{ vendorInfo.vendor }}
                        </span>
                    </div>
                    <div class="mb-2 mt-3">
                        <strong>API URL:</strong>
                        <a [href]="vendorInfo.apiUrl" target="_blank" class="ms-2 text-info">
                            {{ vendorInfo.apiUrl }}
                            <i class="fa fa-external-link"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <div *ngIf="!vendorInfo.success" class="vendor-info-error">
                <div class="mb-3">
                    <h6><i class="fa fa-exclamation-triangle text-warning"></i> {{ "LOCAL_NETWORK.VENDOR_NOT_FOUND" | translate }}</h6>
                </div>
                <div class="vendor-details">
                    <div class="mb-2">
                        <strong>{{ "LOCAL_NETWORK.MAC_ADDRESS" | translate }}:</strong>
                        <code class="ms-2">{{ vendorInfo.macAddress }}</code>
                    </div>
                    <div *ngIf="vendorInfo.oui" class="mb-2">
                        <strong>OUI:</strong>
                        <code class="ms-2">{{ vendorInfo.oui }}</code>
                    </div>
                    <div class="mb-2">
                        <strong>{{ "LOCAL_NETWORK.ERROR" | translate }}:</strong>
                        <span class="ms-2 text-warning">{{ vendorInfo.error }}</span>
                    </div>
                    <div *ngIf="vendorInfo.apiUrl" class="mb-2 mt-3">
                        <strong>API URL:</strong>
                        <a [href]="vendorInfo.apiUrl" target="_blank" class="ms-2 text-info">
                            {{ vendorInfo.apiUrl }}
                            <i class="fa fa-external-link"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div *ngIf="!isLoadingVendorInfo && !vendorInfo" class="text-center py-4">
            <i class="fa fa-exclamation-circle text-warning fa-2x"></i>
            <p class="mt-3">{{ "LOCAL_NETWORK.NO_VENDOR_INFO" | translate }}</p>
        </div>
    </div>
    <div class="modal-footer" style="background-color: #1a1a1a; border-top: 1px solid #333;">
        <button type="button" 
                class="btn btn-secondary" 
                (click)="closeVendorInfoModal()">
            {{ "COMMUN.CLOSE" | translate }}
        </button>
    </div>
</ng-template>

<!-- Vendor Info Modal -->
<ng-template #vendorInfoModal let-c="close" let-d="dismiss">
    <div class="modal-header slideshow-header">
        <h5 class="modal-title">
            <i class="fa fa-info-circle"></i> {{ "LOCAL_NETWORK.VENDOR_INFO" | translate }}
        </h5>
        <button type="button" 
                class="btn btn-outline-light btn-sm rounded-circle" 
                (click)="closeVendorInfoModal()" 
                [attr.aria-label]="'COMMUN.CLOSE' | translate"
                style="min-width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; padding: 0;">
            <i class="fa fa-times"></i>
        </button>
    </div>
    <div class="modal-body" style="background-color: #1a1a1a; color: #fff; padding: 1.5rem;">
        <div *ngIf="isLoadingVendorInfo" class="text-center py-4">
            <i class="fa fa-spinner fa-spin fa-2x"></i>
            <p class="mt-3">{{ "LOCAL_NETWORK.LOADING_VENDOR_INFO" | translate }}</p>
        </div>
        
        <div *ngIf="!isLoadingVendorInfo && vendorInfo">
            <div *ngIf="vendorInfo.success" class="vendor-info-success">
                <div class="mb-3">
                    <h6><i class="fa fa-check-circle text-success"></i> {{ "LOCAL_NETWORK.VENDOR_FOUND" | translate }}</h6>
                </div>
                <div class="vendor-details">
                    <div class="mb-2">
                        <strong>{{ "LOCAL_NETWORK.MAC_ADDRESS" | translate }}:</strong>
                        <code class="ms-2">{{ vendorInfo.macAddress }}</code>
                    </div>
                    <div class="mb-2">
                        <strong>OUI:</strong>
                        <code class="ms-2">{{ vendorInfo.oui }}</code>
                    </div>
                    <div class="mb-2">
                        <strong>{{ "LOCAL_NETWORK.VENDOR" | translate }}:</strong>
                        <span class="ms-2 badge badge-success" style="font-size: 1rem; padding: 0.5rem 1rem;">
                            {{ vendorInfo.vendor }}
                        </span>
                    </div>
                    <div class="mb-2 mt-3">
                        <strong>API URL:</strong>
                        <a [href]="vendorInfo.apiUrl" target="_blank" class="ms-2 text-info">
                            {{ vendorInfo.apiUrl }}
                            <i class="fa fa-external-link"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <div *ngIf="!vendorInfo.success" class="vendor-info-error">
                <div class="mb-3">
                    <h6><i class="fa fa-exclamation-triangle text-warning"></i> {{ "LOCAL_NETWORK.VENDOR_NOT_FOUND" | translate }}</h6>
                </div>
                <div class="vendor-details">
                    <div class="mb-2">
                        <strong>{{ "LOCAL_NETWORK.MAC_ADDRESS" | translate }}:</strong>
                        <code class="ms-2">{{ vendorInfo.macAddress }}</code>
                    </div>
                    <div *ngIf="vendorInfo.oui" class="mb-2">
                        <strong>OUI:</strong>
                        <code class="ms-2">{{ vendorInfo.oui }}</code>
                    </div>
                    <div class="mb-2">
                        <strong>{{ "LOCAL_NETWORK.ERROR" | translate }}:</strong>
                        <span class="ms-2 text-warning">{{ vendorInfo.error }}</span>
                    </div>
                    <div *ngIf="vendorInfo.apiUrl" class="mb-2 mt-3">
                        <strong>API URL:</strong>
                        <a [href]="vendorInfo.apiUrl" target="_blank" class="ms-2 text-info">
                            {{ vendorInfo.apiUrl }}
                            <i class="fa fa-external-link"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div *ngIf="!isLoadingVendorInfo && !vendorInfo" class="text-center py-4">
            <i class="fa fa-exclamation-circle text-warning fa-2x"></i>
            <p class="mt-3">{{ "LOCAL_NETWORK.NO_VENDOR_INFO" | translate }}</p>
        </div>
    </div>
    <div class="modal-footer" style="background-color: #1a1a1a; border-top: 1px solid #333;">
        <button type="button" 
                class="btn btn-secondary" 
                (click)="closeVendorInfoModal()">
            {{ "COMMUN.CLOSE" | translate }}
        </button>
    </div>
</ng-template>
