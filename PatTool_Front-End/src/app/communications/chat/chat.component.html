<!-- Chat Component - Displays all available discussions -->
<div class="chat-container">
    <!-- Header Section -->
    <div class="pat-title">
        <h2>{{ "RESULTS.TITLE" | translate }}</h2>
        <app-navigation-buttons></app-navigation-buttons>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Filter Section -->
    <div class="filter-container">
        <div class="chat-stats">
            <i class="fa fa-comments"></i>
            <span>{{ filteredDiscussions.length }} {{ "RESULTS.DISCUSSIONS" | translate }}</span>
        </div>
        <div class="filter-section-redesigned">
            <div class="filter-input-container-desktop">
                <i class="fa fa-search search-icon"></i>
                <input type="text" 
                       [(ngModel)]="dataFIlter" 
                       (ngModelChange)="applyFilter()"
                       placeholder="{{ 'CHAT.FILTER_PLACEHOLDER' | translate }}" 
                       class="filter-input" />
                <button class="filter-clear-btn" 
                        (click)="clearFilter()" 
                        type="button"
                        [ngbTooltip]="('COMMUN.CLEAR_FILTER' | translate)" 
                        placement="bottom"
                        container="body"
                        [class.disabled]="!dataFIlter || dataFIlter.trim() === ''">
                    <i class="fa fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="discussions-loading">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p>{{ connectionStatus || ("CHAT.LOADING_DISCUSSIONS" | translate) }}</p>
    </div>

    <!-- Discussions List -->
    <div *ngIf="!isLoading" class="discussions-list">
        <!-- Empty State -->
        <div *ngIf="availableDiscussions.length === 0" class="empty-state">
            <i class="fa fa-comments empty-icon"></i>
            <h3>{{ "CHAT.NO_DISCUSSIONS" | translate }}</h3>
            <p>{{ "CHAT.NO_DISCUSSIONS_DESC" | translate }}</p>
        </div>

        <!-- No Results from Filter -->
        <div *ngIf="availableDiscussions.length > 0 && filteredDiscussions.length === 0" class="empty-state">
            <i class="fa fa-search empty-icon"></i>
            <h3>{{ "CHAT.NO_FILTER_RESULTS" | translate }}</h3>
            <p>{{ "CHAT.NO_FILTER_RESULTS_DESC" | translate }}</p>
        </div>

        <!-- Discussion Cards -->
        <div *ngIf="availableDiscussions.length > 0" class="discussions-grid">
            <div *ngFor="let discussion of filteredDiscussions" 
                 class="discussion-card"
                 [attr.data-type]="discussion.type"
                 (click)="openDiscussionModal(discussion)">
                <div class="discussion-card-header">
                    <div class="discussion-icon">
                        <i *ngIf="discussion.type === 'general'" class="fa fa-globe"></i>
                        <i *ngIf="discussion.type === 'event'" class="fa fa-calendar"></i>
                        <i *ngIf="discussion.type === 'friendGroup'" class="fa fa-users"></i>
                    </div>
                    <div class="discussion-title-wrapper">
                        <h4 class="discussion-title">{{ discussion.title }}</h4>
                        <div class="discussion-type-badge" [ngClass]="'type-' + discussion.type">
                            <span *ngIf="discussion.type === 'general'">{{ "CHAT.TYPE_GENERAL" | translate }}</span>
                            <span *ngIf="discussion.type === 'event'">{{ "CHAT.TYPE_EVENT" | translate }}</span>
                            <span *ngIf="discussion.type === 'friendGroup'">{{ "CHAT.TYPE_GROUP" | translate }}</span>
                        </div>
                    </div>
                    <div class="discussion-actions" *ngIf="isDiscussionOwner(discussion)">
                        <button class="btn btn-sm btn-danger delete-discussion-btn" 
                                (click)="deleteDiscussion(discussion, $event)"
                                [attr.aria-label]="'Delete discussion'"
                                [ngbTooltip]="'Delete discussion'"
                                placement="top">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="discussion-card-body">
                    <div class="discussion-info">
                        <!-- Discussion Owner (shown for all types) -->
                        <p class="discussion-info-item" *ngIf="getDiscussionOwnerName(discussion)">
                            <i class="fa fa-user-circle"></i>
                            <span><strong>{{ "CHAT.OWNER" | translate }}:</strong> {{ getDiscussionOwnerName(discussion) }}</span>
                        </p>

                        <!-- Event Info -->
                        <p class="discussion-info-item" *ngIf="discussion.type === 'event' && discussion.event && discussion.event.beginEventDate">
                            <i class="fa fa-calendar"></i>
                            <span><strong>{{ "CHAT.EVENT_DATE" | translate }}:</strong> {{ discussion.event.beginEventDate | date:'short' }}</span>
                        </p>
                        <p class="discussion-info-item" *ngIf="discussion.type === 'event' && discussion.event && discussion.event.startLocation">
                            <i class="fa fa-map-marker"></i>
                            <span><strong>{{ "CHAT.EVENT_LOCATION" | translate }}:</strong> {{ discussion.event.startLocation }}</span>
                        </p>
                        <p class="discussion-info-item" *ngIf="discussion.type === 'event' && discussion.event && discussion.event.visibility">
                            <i class="fa fa-eye"></i>
                            <span><strong>{{ "CHAT.EVENT_VISIBILITY" | translate }}:</strong> 
                                <ng-container *ngIf="isStandardVisibility(discussion.event.visibility)">
                                    {{ getVisibilityLabel(discussion.event.visibility) | translate }}
                                </ng-container>
                                <ng-container *ngIf="!isStandardVisibility(discussion.event.visibility)">
                                    {{ discussion.event.visibility }}
                                </ng-container>
                            </span>
                        </p>
                        <p class="discussion-info-item" *ngIf="discussion.type === 'event' && discussion.event && discussion.event.status">
                            <i class="fa fa-info-circle"></i>
                            <span><strong>{{ "CHAT.EVENT_STATUS" | translate }}:</strong> {{ getStatusLabel(discussion.event.status) | translate }}</span>
                        </p>

                        <!-- Friend Group Info -->
                        <p class="discussion-info-item" *ngIf="discussion.type === 'friendGroup' && discussion.friendGroup">
                            <i class="fa fa-users"></i>
                            <span><strong>{{ "CHAT.MEMBERS_COUNT" | translate }}:</strong> {{ getGroupMembersCount(discussion.friendGroup) }} {{ "CHAT.MEMBERS" | translate }}</span>
                        </p>
                        <p class="discussion-info-item" *ngIf="discussion.type === 'friendGroup' && discussion.friendGroup && getGroupMembersList(discussion.friendGroup).length > 0">
                            <i class="fa fa-user"></i>
                            <span><strong>{{ "CHAT.MEMBERS_LIST" | translate }}:</strong> <span class="members-list">{{ getGroupMembersList(discussion.friendGroup).join(', ') }}</span></span>
                        </p>

                        <!-- General Discussion Info -->
                        <p class="discussion-info-item" *ngIf="discussion.type === 'general'">
                            <i class="fa fa-info-circle"></i>
                            <span>{{ "CHAT.GENERAL_DISCUSSION_DESC" | translate }}</span>
                        </p>
                    </div>
                </div>

                <div class="discussion-card-footer">
                    <div class="discussion-stats">
                        <span *ngIf="discussion.messageCount !== undefined" class="message-count">
                            <i class="fa fa-comment"></i>
                            {{ discussion.messageCount }} {{ (discussion.messageCount !== 1 ? "CHAT.MESSAGES" : "CHAT.MESSAGE") | translate }}
                        </span>
                        <span *ngIf="discussion.lastMessageDate" class="last-message-date">
                            <i class="fa fa-clock-o"></i>
                            {{ discussion.lastMessageDate | date:'short' }}
                        </span>
                        <span class="discussion-id" *ngIf="hasAdminRole()">
                            <i class="fa fa-hashtag"></i>
                            <strong>{{ "CHAT.ID" | translate }}:</strong> {{ discussion.id }}
                        </span>
                        <span class="discussion-id" *ngIf="hasAdminRole() && discussion.type === 'event' && discussion.event && discussion.event.id">
                            <i class="fa fa-calendar"></i>
                            <strong>{{ "CHAT.EVENT_ID" | translate }}:</strong> {{ discussion.event.id }}
                        </span>
                        <span class="discussion-id" *ngIf="hasAdminRole() && discussion.type === 'friendGroup' && discussion.friendGroup && discussion.friendGroup.id">
                            <i class="fa fa-users"></i>
                            <strong>{{ "CHAT.GROUP_ID" | translate }}:</strong> {{ discussion.friendGroup.id }}
                        </span>
                    </div>
                    <div class="discussion-action">
                        <i class="fa fa-arrow-right"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>
