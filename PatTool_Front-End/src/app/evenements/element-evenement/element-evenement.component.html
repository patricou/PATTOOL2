<!-- <div class="panel panel-default" [ngClass]="{'animated pulse':mouseOvered}" (mouseout)="mouseOvered=false" (mouseover)="mouseOvered=true" data-bs-hover-animate="pulse"> -->
<!-- thw following line allows to have tooltips on button in footer !! -->
<div style="position:relative;" (click)="openImageModal(getEventThumbnail(), evenement.evenementName)">
    <img class="card-img img-fluid img-thumbnail mx-auto d-block clickable-image" 
         [src]="thumbnailUrl" 
         alt="Card image" />
    <div class="card-img-overlay">
        <h4 class="card-title text-center pat-card"><b>{{evenement.evenementName}}</b></h4>
        <!-- <br><small><i>{{ "EVENTELEM.REF" | translate }} : {{evenement.id}}</i></small></p> -->
    </div>
</div>
<div class="card-block pat-card-block">
    <div class="text-center">
        <span class="badge rounded-pill bg-danger" (click)="addRateMinus()" placement="left"
            ngbTooltip="{{ 'COMMUN.IDONTLIKE' | translate }}"> {{evenement.ratingMinus || 0}}</span>
        <ngb-rating [(rate)]="currentRate">
        </ngb-rating>
        <span class="badge rounded-pill bg-success" (click)="addRatePlus()" placement="right"
            ngbTooltip="{{ 'COMMUN.ILIKE' | translate }}">{{evenement.ratingPlus || 0}}</span>
    </div>
    <div class="alert alert-warning small pat-alert">
        <!-- <b>  {{"EVENTELEM.DESC" | translate }} :</b> -->{{evenement.comments}}
    </div>
    <div class="card-text text-center" [ngSwitch]="evenement.status">
        <!--{{"EVENTELEM.STATUS" | translate }} :-->
        <b>
            <span *ngSwitchCase="'Closed'" class="badge bg-danger me-2">{{"COMMUN.STATUSCLOSE" | translate }}</span>
            <span *ngSwitchCase="'Open'" class="badge bg-success me-2">{{"COMMUN.STATUSOPEN" | translate }}</span>
            <span *ngSwitchCase="'Cancel'" class="badge bg-warning me-2">{{"COMMUN.STATUSCANCEL" | translate }}</span>
            <span [ngSwitch]="evenement.visibility" class="badge">
                <span *ngSwitchCase="'public'" class="badge bg-success">{{"EVENTCREATION.PUBLIC" | translate }}</span>
                <span *ngSwitchCase="'private'" class="badge bg-warning">{{"EVENTCREATION.PRIVATE" | translate }}</span>
                <span *ngSwitchDefault class="badge bg-info">{{evenement.visibility}}</span>
            </span>
        </b>
    </div>
    <small class="mb-1"><i>{{"EVENTELEM.AUTHOR" | translate }} : {{ evenement.author.firstName }} {{
            evenement.author.lastName }} / {{ evenement.author.userName }}</i></small>
    <div class="card-text" [ngSwitch]="+evenement.type">
        {{"EVENTELEM.TYPE" | translate }} :
        <span *ngSwitchCase="11">{{"EVENTCREATION.TYPE.DOCUMENTS" | translate }}</span>
        <span *ngSwitchCase="3">{{"EVENTCREATION.TYPE.RUN" | translate }}</span>
        <span *ngSwitchCase="6">{{"EVENTCREATION.TYPE.PARTY" | translate }}</span>
        <span *ngSwitchCase="4">{{"EVENTCREATION.TYPE.WALK" | translate }}</span>
        <span *ngSwitchCase="10">{{"EVENTCREATION.TYPE.PHOTOS" | translate }}</span>
        <span *ngSwitchCase="9">{{"EVENTCREATION.TYPE.RANDO" | translate }}</span>
        <span *ngSwitchCase="2">{{"EVENTCREATION.TYPE.SKI" | translate }}</span>
        <span *ngSwitchCase="7">{{"EVENTCREATION.TYPE.VACATION" | translate }}</span>
        <span *ngSwitchCase="5">{{"EVENTCREATION.TYPE.BIKE" | translate }}</span>
        <span *ngSwitchCase="8">{{"EVENTCREATION.TYPE.TRAVEL" | translate }}</span>
        <span *ngSwitchCase="1">{{"EVENTCREATION.TYPE.VTT" | translate }}</span>
    </div>
    <div class="card-text" [ngSwitch]="+evenement.diffculty">
        {{"EVENTELEM.DIFF" | translate }} :
        <span *ngSwitchCase="0">{{"EVENTCREATION.DIFF.NA" | translate }}</span>
        <span *ngSwitchCase="1">{{"EVENTCREATION.DIFF.0" | translate }}</span>
        <span *ngSwitchCase="2">{{"EVENTCREATION.DIFF.1" | translate }}</span>
        <span *ngSwitchCase="3">{{"EVENTCREATION.DIFF.2" | translate }}</span>
        <span *ngSwitchCase="4">{{"EVENTCREATION.DIFF.3" | translate }}</span>
        <span *ngSwitchCase="5">{{"EVENTCREATION.DIFF.4" | translate }}</span>
        <span *ngSwitchDefault>{{"EVENTCREATION.DIFF.NA" | translate }}</span>
    </div>
    <div class="card-text">
        {{"EVENTELEM.STARTLOCATION" | translate }} : {{evenement.startLocation}}
    </div>
    <div class="card-text">
        {{"EVENTELEM.BEGINDT" | translate }} : {{formatEventDateTime(evenement.beginEventDate, evenement.startHour)}}
    </div>
    <!--    
    <div class="card-text">
        {{"EVENTELEM.DURATION" | translate }} : {{evenement.durationEstimation }}
    </div>
    -->
    <div [hidden]="tfl">
        <div class="card-text">
            <hr>
            <h5 class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <b> <span style="font-size: 0.85rem;">{{"EVENTELEM.FILES" | translate }} ({{ evenement.fileUploadeds.length }})</span> : </b>
                    <button class="btn btn-sm btn-outline-primary ms-1" 
                            style="padding: 0.1rem 0.25rem; font-size: 0.65rem;"
                            (click)="toggleFilesList()"
                            [title]="showFilesList ? ('Hide files list' | translate) : ('Show files list' | translate)">
                        <i class="fa" [class.fa-plus]="!showFilesList" [class.fa-minus]="showFilesList"></i>
                    </button>
                </div>
                <button class="btn btn-sm btn-success" 
                        *ngIf="evenement.fileUploadeds && evenement.fileUploadeds.length > 0"
                        (click)="downloadAllFiles()">
                    <i class="fa fa-download"></i> {{ 'COMMUN.DOWNLOAD_ALL' | translate }}
                </button>
            </h5>
            <ul class="list-group" *ngIf="showFilesList">
                <li class="list-group-item d-flex justify-content-between align-items-center"
                    *ngFor="let uploadedFile of evenement.fileUploadeds ">
                    <span class="file-name">
                        <span class="badge" 
                              [class.bg-secondary]="!isImageFile(uploadedFile.fileName) && !isPdfFile(uploadedFile.fileName)"
                              [class.bg-info]="isImageFile(uploadedFile.fileName)"
                              [class.bg-danger]="isPdfFile(uploadedFile.fileName)"
                              [title]="uploadedFile.fileName"
                              ngbTooltip="{{uploadedFile.fileName}}" placement="top">
                            {{uploadedFile.fileName}}
                        </span>
                        <small class="text-muted ms-2 clickable-user" 
                               (click)="openUserModal(uploadedFile.uploaderMember)"
                               title="Cliquer pour voir les détails de l'utilisateur">
                            {{uploadedFile.uploaderMember.userName}}
                        </small>
                    </span>
                    <div class="file-actions">
                        <button class="btn btn-sm btn-outline-primary me-2" 
                                placement="left"
                                ngbTooltip="{{ isImageFile(uploadedFile.fileName) ? ('EVENTELEM.CLICK_TO_VIEW' | translate) : ('EVENTELEM.CLICK_TO_OPEN_PDF' | translate) }}"
                                *ngIf="isImageFile(uploadedFile.fileName) || isPdfFile(uploadedFile.fileName)"
                                (click)="handleFileClick(uploadedFile)">
                            <i class="fa fa-eye" aria-hidden="true"></i>
                        </button>
                        <button class="btn btn-sm btn-primary me-2" placement="left"
                            ngbTooltip="{{ 'COMMUN.DOWNLOAD' | translate }}"
                            (click)="openWindows(uploadedFile.fieldId, uploadedFile.fileName)">
                            <i class="fa fa-files-o" aria-hidden="true"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" placement="left"
                            ngbTooltip="{{ 'EVENTELEM.DELETEFILE' | translate }}"
                            [disabled]="!isFileOwner(uploadedFile.uploaderMember)"
                            (click)="delFile(uploadedFile.fieldId)">
                            <i class="fa fa-trash" aria-hidden="true"></i>
                        </button>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="card-text" [hidden]="!isAnyParticpants()">
        <hr>
        <h5 class="pat-members">
            <b> <span style="font-size: 0.85rem;">{{"EVENTELEM.MEMBERS" | translate }} ({{ evenement.members.length }})</span> : </b>
            <button class="btn btn-sm btn-outline-primary ms-1" 
                    style="padding: 0.1rem 0.25rem; font-size: 0.65rem;"
                    (click)="toggleParticipantsList()"
                    [title]="showParticipantsList ? ('EVENTELEM.HIDE_PARTICIPANTS' | translate) : ('EVENTELEM.SHOW_PARTICIPANTS' | translate)">
                <i class="fa" [class.fa-plus]="!showParticipantsList" [class.fa-minus]="showParticipantsList"></i>
            </button>
        </h5>
        <div *ngIf="showParticipantsList">
            <div *ngFor="let member of evenement.members" class="d-flex align-items-center mb-1">
                <small class="clickable-user flex-grow-1" 
                       (click)="openUserModal(member)"
                       title="Cliquer pour voir les détails du participant">
                    {{member.firstName}} {{member.lastName}} / {{member.userName}}
                </small>
                <button class="btn btn-xs btn-outline-primary ms-2" 
                        style="padding: 0.1rem 0.25rem; font-size: 0.6rem;"
                        (click)="sendEmail(member.addressEmail); $event.stopPropagation()"
                        title="{{ 'EVENTELEM.SEND_EMAIL' | translate }}">
                    <i class="fa fa-envelope"></i>
                </button>
            </div>
        </div>
    </div>
</div>
<div class="card-footer card-text text-center">
    <!-- <iframe width="100%" height="250" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" sandbox="allow-forms allow-scripts allow-same-origin" [src]="safeUrlMap" allowfullscreen></iframe> -->
    <!-- Unified Photos Button (opens FS selector if present, else uploaded slideshow) -->
    <button class="btn btn-sm btn-outline-success mb-1 me-1" 
            [hidden]="!(hasImageFiles() || getPhotoFromFsCount() > 0)" 
            (click)="openPhotos()"
            placement="right"
            container="body"
            ngbTooltip="{{ 'EVENTELEM.SLIDESHOW' | translate }}">
        <i class="fa fa-picture-o" aria-hidden="true"></i>
    </button>
    
    <!-- View Details Button -->
    <a class="btn btn-sm btn-outline-info mb-1 me-1 eye-button" [routerLink]="['/details-evenement', evenement.id]" placement="top"
        ngbTooltip="{{ 'EVENTELEM.VIEW_DETAILS' | translate }}">
        <i class="fa fa-eye" aria-hidden="true"></i>
    </a>
    
    <!-- URLs Button -->
    <button class="btn btn-primary btn-sm mb-1 me-1" [hidden]="!isUrlEventsAvailable()" 
        (click)="openUrlsModal(urlsModal)" placement="top"
        ngbTooltip="{{ 'EVENTELEM.URLS' | translate }} ({{ getUrlEventsCount() }})">
        <i class="fa fa-link" aria-hidden="true"></i> {{ getUrlEventsCount() }}
    </button>

    <!-- Comments Button -->
    <button class="btn btn-sm comments-button mb-1 me-1" [hidden]="!hasComments()" (click)="openCommentsModal()" placement="top"
        ngbTooltip="{{ 'EVENTHOME.COMMENTARIES' | translate }}">
        <i class="fa fa-comments" aria-hidden="true"></i> {{ getCommentsCount() }}
    </button>
    
    <a class="btn btn-sm btn-outline-info mb-1 me-1" (click)="open(content)"
        ngbTooltip=" {{ 'EVENTELEM.CHAT' | translate }}" placement="top"><i class="fa fa-comments" aria-hidden="true"></i></a>
    <a class="btn btn-sm btn-info mb-1 me-1" [hidden]="!isParticipant()" (click)="delMemberClick()"
        ngbTooltip=" {{ 'EVENTELEM.IDWTP' | translate }}" placement="top"><i class="fa fa-user" aria-hidden="true"></i></a>
    <a class="btn btn-sm btn-success mb-1 me-1" [hidden]="isParticipant()" (click)="addMemberClick()"
        ngbTooltip=" {{ 'EVENTELEM.IWTP' | translate }}" placement="top"><i class="fa fa-user-o" aria-hidden="true"></i></a>
    <a class="btn btn-sm btn-primary mb-1 me-1" [hidden]="!isAuthor()" (click)="changeStatusEvent(evenement.status)"
        ngbTooltip="{{ 'EVENTELEM.CHGTSTATUS' | translate }}" placement="top"><i class="fa fa-circle-o-notch"
            aria-hidden="true"></i></a>
    <a class="btn btn-sm btn-warning mb-1 me-1" [routerLink]="['/updeven',evenement.id]"
        ngbTooltip="{{ 'EVENTELEM.UTE' | translate }}" placement="top"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>
    <a class="btn btn-sm btn-danger mb-1 me-1" [hidden]="!isAuthor()" (click)="deleteEvenement()" placement="top"
        ngbTooltip="{{ 'EVENTELEM.DTE' | translate }}"><i class="fa fa-trash" aria-hidden="true"></i></a>
    <a class="btn btn-sm btn-outline-primary mb-1 me-1" [hidden]="!isAnyFiles()" (click)="toogleFileListe()"
        placement="top" ngbTooltip="{{ 'EVENTELEM.FILESDOWNLOAD'| translate }}"><i class="fa fa-download"
            aria-hidden="true"></i> {{ getFilesCount() }}</a>

    <div class="file-upload-wrapper me-1" placement="top" ngbTooltip="{{ 'EVENTELEM.UPLOAD' | translate }}">
        <label [for]="'file-upload-input-' + evenement.id" class="btn btn-sm btn-success mb-1">
            <i class="fa fa-upload" aria-hidden="true"></i>
        </label>
        <input type="file" [id]="'file-upload-input-' + evenement.id" #fileInput (change)="onFileSelected($event)" multiple 
               accept="image/*,.pdf,.doc,.docx,.txt,.zip,.rar" style="display: none;" />
    </div>

    <!-- JSON View Button -->
    <button class="btn btn-sm btn-secondary mb-1 me-1" (click)="openJsonModal()" placement="top"
        ngbTooltip="{{ 'EVENTELEM.VIEW_JSON' | translate }}">
        <i class="fa fa-code" aria-hidden="true"></i>
    </button>
</div>


<!-- Modal window for live chat - Design moderne -->
<ng-template #content let-c="close" let-d="dismiss">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content chat-modal">
            <!-- Header moderne -->
            <div class="modal-header chat-header">
                <div class="d-flex align-items-center">
                    <div class="chat-avatar me-3">
                        <i class="fa fa-comments"></i>
                    </div>
                    <div>
                        <h5 class="modal-title mb-0">{{evenement.evenementName}}</h5>
                        <small class="text-muted">{{"EVENTELEM.LIVECHAT" | translate }}</small>
                    </div>
                </div>
                <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="d('Cross click')"></button>
            </div>
            
            <!-- Messages Container -->
            <div class="modal-body chat-body p-0">
                <div class="chat-messages" #chatMessagesContainer>
                    <div *ngFor="let item of items | async" class="message-item" [class.own-message]="item.user.userName == user.userName">
                        <div class="message-avatar">
                            <i class="fa fa-user"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-author">{{item.user.userName}}</span>
                                <span class="message-time">{{item.date | date:'short'}} {{item.date | date:'shortTime'}}</span>
                                <button *ngIf="item.user.userName == user.userName" 
                                        class="btn btn-sm btn-outline-danger message-delete" 
                                        (click)="deleteMessage(item)"
                                        ngbTooltip="{{ 'EVENTELEM.DELMESCHAT' | translate }}">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                            <div class="message-text">{{item.message}}</div>
                        </div>
                    </div>
                    <div *ngIf="!(items | async)?.length" class="no-messages text-center py-4">
                        <i class="fa fa-comment-o fa-3x text-muted mb-3"></i>
                        <p class="text-muted">{{ 'EVENTELEM.NO_MESSAGES_YET' | translate }}</p>
                    </div>
                </div>
            </div>
            
            <!-- Input moderne -->
            <div class="modal-footer chat-footer">
                <div class="input-group">
                    <input [(ngModel)]="msgVal" 
                           type="text" 
                           class="form-control chat-input" 
                           placeholder="{{ 'RESULTS.MESSAGEPLHD' | translate }}" 
                           (keyup.enter)="Send()" 
                           autofocus />
                    <button class="btn btn-primary chat-send-btn" 
                            type="button" 
                            (click)="Send()"
                            [disabled]="!msgVal.trim()">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</ng-template>


<!-- Comments Modal -->
<ng-template #commentsModal let-c="close" let-d="dismiss">
    <div class="modal-header selector-header">
        <h5 class="modal-title">
            <i class="fa fa-comments"></i> {{ 'EVENTHOME.COMMENTARIES' | translate }} - {{ evenement.evenementName }}
        </h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="c()"></button>
    </div>
    <div class="modal-body selector-body">
        <div *ngIf="hasComments(); else noCommentsTemplate">
            <div class="comments-container">
                <div class="comment-item" *ngFor="let comment of getEventComments()">
                    <div class="comment-header">
                        <div class="comment-author">
                            <i class="fa fa-user"></i> {{ comment.commentOwner }}
                        </div>
                        <div class="comment-date">
                            <i class="fa fa-clock-o"></i> {{ comment.dateCreation | date:'short' }}
                        </div>
                    </div>
                    <div class="comment-content">
                        {{ comment.commentary }}
                    </div>
                </div>
            </div>
        </div>
        <ng-template #noCommentsTemplate>
            <div class="text-center text-muted py-4">
                <i class="fa fa-comments fa-3x mb-3"></i>
                <p>{{ 'EVENTHOME.NO_COMMENTARIES_ADDED' | translate }}</p>
            </div>
        </ng-template>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="c()">
            <i class="fa fa-times"></i> {{ 'COMMUN.CLOSE' | translate }}
        </button>
    </div>
</ng-template>

<!-- JSON View Modal -->
<ng-template #jsonModal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h5 class="modal-title">{{evenement.evenementName}}<small> ({{ 'EVENTELEM.FORMAT_JSON' | translate }})</small></h5>
    </div>
    <div class="modal-body">
        <div class="json-container">
            <pre class="json-content">{{getEventAsJson()}}</pre>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="c('Close click')">{{"COMMUN.CLOSE" | translate }}</button>
    </div>
</ng-template>

<!-- URLs Modal -->
<ng-template #urlsModal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h5 class="modal-title">
            <i class="fa fa-link"></i> {{ 'EVENTELEM.URLS' | translate }} - {{ evenement.evenementName }}
        </h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
    </div>
    <div class="modal-body">
        <div *ngIf="isUrlEventsAvailable(); else noUrlsTemplate">
            <div class="url-events-container">
                <!-- Group URLs by type -->
                <div *ngFor="let typeKey of getSortedTypeKeys()" class="url-type-group mb-4">
                    <!-- Type Header -->
                    <div class="url-type-header mb-3">
                        <h6 class="url-type-title">
                            <i class="fa fa-folder"></i> {{ getUrlTypeLabel(typeKey) | translate }}
                            <span class="badge bg-secondary ms-2">{{ getGroupedUrlEvents()[typeKey].length }}</span>
                        </h6>
                        <hr class="url-type-divider">
                    </div>
                    
                    <!-- URLs for this type -->
                    <div class="url-type-content">
                        <div class="url-event-item mb-3" *ngFor="let urlEvent of getGroupedUrlEvents()[typeKey]; let i = index">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <div class="url-event-meta">
                                        <small class="text-muted">
                                            <i class="fa fa-user"></i> {{ urlEvent.owner }} | 
                                            <i class="fa fa-calendar"></i> {{ urlEvent.dateCreation | date:'short' }}
                                        </small>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="url-event-content d-flex align-items-start gap-3">
                                        <div class="url-event-link">
                                            <a [href]="urlEvent.link" target="_blank" class="btn btn-outline-primary btn-sm">
                                                <i class="fa fa-external-link"></i> {{ urlEvent.link }}
                                            </a>
                                        </div>
                                        <div class="url-event-description flex-grow-1" *ngIf="urlEvent.urlDescription">
                                            <p class="text-muted mb-0">{{ urlEvent.urlDescription }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <ng-template #noUrlsTemplate>
            <div class="text-center text-muted py-4">
                <i class="fa fa-link fa-3x mb-3"></i>
                <p>{{ 'EVENTHOME.NO_LINKS_ADDED' | translate }}</p>
            </div>
        </ng-template>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="c('Close click')">
            <i class="fa fa-times"></i> {{ 'COMMUN.CLOSE' | translate }}
        </button>
    </div>
</ng-template>

<!-- FS Photos Selector Modal -->
<ng-template #fsPhotosSelectorModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title">
            <i class="fa fa-image"></i>
            {{ 'EVENTELEM.PHOTOS_SELECTION' | translate }} - {{ evenement.evenementName }}
        </h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <!-- Uploaded photos section (MongoDB) -->
        <div *ngIf="hasImageFiles()" class="mb-3 p-2 border rounded">
            <div class="d-flex align-items-center">
                <input class="form-check-input me-2" type="radio" name="fsLink" id="fsLinkUploaded" value="__UPLOADED__" [(ngModel)]="selectedFsLink">
                <label class="form-check-label flex-grow-1" for="fsLinkUploaded">
                    <div class="d-flex align-items-center">
                        <span class="badge bg-primary me-2">{{ 'EVENTELEM.SLIDESHOW' | translate }}</span>
                        <strong class="me-2">{{ 'EVENTELEM.PHOTOS' | translate }}</strong>
                        <small class="text-muted">({{ getImageFilesCount() }})</small>
                    </div>
                    <small class="text-muted d-block mt-1">{{ 'EVENTELEM.MONGODB_PHOTOS_DESC' | translate }}</small>
                </label>
            </div>
        </div>

        <!-- Filesystem links list -->
        <div class="mb-2" *ngIf="getPhotoFromFsLinks().length > 0">
            <div class="mb-2"><strong>{{ 'EVENTELEM.PHOTOS_FROM_FS_HEADING' | translate }}</strong></div>
            <div class="list-group">
                <label class="list-group-item d-flex align-items-start" *ngFor="let link of getPhotoFromFsLinks(); let i = index">
                    <input class="form-check-input me-2 mt-1" type="radio" name="fsLink" [value]="link.link" [(ngModel)]="selectedFsLink">
                    <div class="flex-grow-1">
                        <div class="d-flex align-items-center">
                            <span class="badge bg-secondary me-2">{{ i + 1 }}</span>
                            <span class="text-break">{{ link.link }}</span>
                        </div>
                        <small class="text-muted d-block" *ngIf="link.urlDescription">{{ link.urlDescription }}</small>
                    </div>
                </label>
            </div>
        </div>

        <!-- Other Photos links (type PHOTOS) -->
        <div class="mb-2" *ngIf="getPhotosUrlLinks().length > 0">
            <div class="mb-2"><strong>{{ 'EVENTELEM.OTHER_PHOTOS_LINKS' | translate }}</strong></div>
            <div class="list-group">
                <label class="list-group-item d-flex align-items-start" *ngFor="let link of getPhotosUrlLinks(); let j = index">
                    <input class="form-check-input me-2 mt-1" type="radio" name="fsLink" [value]="'PHOTOS:' + link.link" [(ngModel)]="selectedFsLink">
                    <div class="flex-grow-1">
                        <div class="d-flex align-items-center">
                            <span class="badge bg-info me-2">{{ j + 1 }}</span>
                            <span class="text-break">{{ link.link }}</span>
                        </div>
                        <small class="text-muted d-block" *ngIf="link.urlDescription">{{ link.urlDescription }}</small>
                    </div>
                </label>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="modal.dismiss('Cancel')">
            <i class="fa fa-times"></i> {{ 'COMMUN.CLOSE' | translate }}
        </button>
        <button type="button" class="btn btn-primary" [disabled]="!selectedFsLink" (click)="confirmFsPhotosSelection(modal)">
            <i class="fa fa-play"></i> {{ 'EVENTELEM.SLIDESHOW' | translate }}
        </button>
    </div>
</ng-template>

<!-- Image Modal for large display -->
<ng-template #imageModal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h5 class="modal-title">{{ selectedImageAlt }}</h5>
        <button type="button" class="btn btn-outline-light btn-sm rounded-circle ms-auto" (click)="onSlideshowClose(c)" aria-label="Close">
            <i class="fa fa-times"></i>
        </button>
    </div>
    <div class="modal-body text-center" #imageContainer [style.cursor]="isDraggingImage ? 'grabbing' : (imageZoom > getMinImageZoom() ? 'grab' : 'default')" style="overflow:hidden; user-select: none;"
         (mousedown)="onImageMouseDown($event)" (mousemove)="onImageMouseMove($event)"
         (mouseup)="onImageMouseUp()" (mouseleave)="onImageMouseUp()" (document:mouseup)="onImageMouseUp()">
        <img #imageEl [src]="selectedImageUrl" [alt]="selectedImageAlt"
             class="img-fluid modal-image"
             [style.transform]="'translate3d(' + imageTranslateX + 'px,' + imageTranslateY + 'px,0) scale(' + imageZoom + ')'
             "
             style="transform-origin:center center; user-select:none;"
             (wheel)="onWheelImage($event)" draggable="false" />
    </div>
    <div class="modal-footer d-flex justify-content-between align-items-center">
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-secondary" (click)="zoomOutImage()"><i class="fa fa-search-minus"></i></button>
            <button type="button" class="btn btn-outline-secondary" (click)="resetImageZoom()"><i class="fa fa-refresh"></i></button>
            <button type="button" class="btn btn-outline-secondary" (click)="zoomInImage()"><i class="fa fa-search-plus"></i></button>
        </div>
        <button type="button" class="btn btn-secondary" (click)="c()">Close</button>
    </div>
</ng-template>

<!-- User Details Modal -->
<ng-template #userModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title">
            <i class="fa fa-user me-2"></i>
            Détails de l'utilisateur
        </h5>
        <button type="button" class="btn-close" (click)="modal.dismiss('Cross click')" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" *ngIf="selectedUser">
        <div class="user-details">
            <div class="detail-row">
                <strong>Prénom :</strong>
                <span>{{ selectedUser.firstName }}</span>
            </div>
            <div class="detail-row">
                <strong>Nom :</strong>
                <span>{{ selectedUser.lastName }}</span>
            </div>
            <div class="detail-row">
                <strong>Nom d'utilisateur :</strong>
                <span>{{ selectedUser.userName }}</span>
            </div>
            <div class="detail-row">
                <strong>Email :</strong>
                <span>{{ selectedUser.addressEmail }}
                    <button class="btn btn-sm btn-outline-primary ms-2" 
                            (click)="sendEmail(selectedUser.addressEmail)"
                            title="{{ 'EVENTELEM.SEND_EMAIL' | translate }}">
                        <i class="fa fa-envelope"></i>
                    </button>
                </span>
            </div>
            <div class="detail-row">
                <strong>ID :</strong>
                <span>{{ selectedUser.id }}</span>
            </div>
            <div class="detail-row">
                <strong>Keycloak ID :</strong>
                <span>{{ selectedUser.keycloakId }}</span>
            </div>
            <div class="detail-row">
                <strong>Rôles :</strong>
                <span>{{ selectedUser.roles.join(', ') }}</span>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="modal.dismiss('Close click')">
            Fermer
        </button>
    </div>
</ng-template>

<!-- Slideshow Modal -->
<ng-template #slideshowModal let-c="close" let-d="dismiss">
    <div class="modal-header slideshow-header">
        <h5 class="modal-title">
            <i class="fa fa-picture-o"></i> {{ 'EVENTELEM.SLIDESHOW_TITLE' | translate }} - {{ evenement.evenementName }}
        </h5>
        <button type="button" class="btn btn-outline-light btn-sm rounded-circle ms-auto" (click)="onSlideshowClose(c)" aria-label="Close">
            <i class="fa fa-times"></i>
        </button>
    </div>
    <div class="modal-body slideshow-body">
        <div class="slideshow-container">
            <div class="slideshow-image-wrapper" #slideshowContainer
                 (mousedown)="onSlideshowMouseDown($event)" (mousemove)="onSlideshowMouseMove($event)"
                 (mouseup)="onSlideshowMouseUp()" (mouseleave)="onSlideshowMouseUp()" (document:mouseup)="onSlideshowMouseUp()"
                 (touchstart)="onSlideshowTouchStart($event)" (touchmove)="onSlideshowTouchMove($event)" (touchend)="onSlideshowTouchEnd($event)"
                 [style.cursor]="isDraggingSlideshow ? 'grabbing' : (slideshowZoom > getMinSlideshowZoom() ? 'grab' : 'default')" style="overflow:hidden; user-select: none;">
                <img #slideshowImgEl *ngIf="slideshowImages.length > 0" 
                     [src]="getCurrentSlideshowImage()" 
                     alt="Slideshow image {{ currentSlideshowIndex + 1 }}"
                     class="slideshow-image"
                     [style.transform]="'translate3d(' + slideshowTranslateX + 'px,' + slideshowTranslateY + 'px,0) scale(' + slideshowZoom + ')'
                     "
                     style="transform-origin:center center;"
                     (wheel)="onWheelSlideshow($event)"
                     [class.fullscreen-image]="isFullscreen"
                     />
                <div *ngIf="slideshowImages.length === 0" class="slideshow-loading">
                    <i class="fa fa-spinner fa-spin fa-3x"></i>
                    <p>{{ 'EVENTELEM.LOADING_IMAGES' | translate }}</p>
                </div>
                <div *ngIf="slideshowImages.length > 0" class="slideshow-counter">
                    {{ currentSlideshowIndex + 1 }} / {{ slideshowImages.length }}
                </div>
            </div>
            <div class="slideshow-controls" [class.always-visible]="isFullscreen && !isSlideshowActive">
                <button class="btn btn-lg btn-outline-light slideshow-btn-prev" 
                        (click)="previousImage()"
                        [disabled]="slideshowImages.length <= 1">
                    <i class="fa fa-chevron-left"></i>
                </button>
                <button class="btn btn-lg btn-outline-light slideshow-btn-next" 
                        (click)="nextImage()"
                        [disabled]="slideshowImages.length <= 1">
                    <i class="fa fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
    <div class="modal-footer slideshow-footer">
        <div class="d-flex gap-2 align-items-center flex-wrap">
            <button type="button" class="btn btn-secondary" 
                    (click)="toggleSlideshow()"
                    [disabled]="slideshowImages.length <= 1"
                    [ngbTooltip]="isSlideshowActive ? ('EVENTELEM.PAUSE' | translate) : ('EVENTELEM.PLAY' | translate)"
                    placement="top">
                <i class="fa me-1" [ngClass]="isSlideshowActive ? 'fa-pause-circle-o' : 'fa-play-circle-o'"></i>
                <span *ngIf="!isSlideshowActive">{{ 'EVENTELEM.PLAY' | translate }}</span>
                <span *ngIf="isSlideshowActive">{{ 'EVENTELEM.PAUSE' | translate }}</span>
            </button>
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-secondary" (click)="zoomOutSlideshow()"><i class="fa fa-search-minus"></i></button>
                <button type="button" class="btn btn-outline-secondary" (click)="resetSlideshowZoom()"><i class="fa fa-refresh"></i></button>
                <button type="button" class="btn btn-outline-secondary" (click)="zoomInSlideshow()"><i class="fa fa-search-plus"></i></button>
            </div>
            <button type="button" class="btn btn-secondary" 
                    (click)="toggleFullscreen()"
                    [ngbTooltip]="isFullscreen ? ('EVENTELEM.EXIT_FULLSCREEN' | translate) : ('EVENTELEM.FULLSCREEN' | translate)"
                    placement="top">
                <i [class.fa-arrows-alt]="!isFullscreen" [class.fa-compress]="isFullscreen" class="me-1"></i>
                <span *ngIf="!isFullscreen">{{ 'EVENTELEM.FULLSCREEN' | translate }}</span>
                <span *ngIf="isFullscreen">{{ 'EVENTELEM.EXIT_FULLSCREEN' | translate }}</span>
            </button>
            <button type="button" class="btn btn-secondary" (click)="onSlideshowClose(c)">
                <i class="fa fa-times"></i> {{ 'COMMUN.CLOSE' | translate }}
            </button>
        </div>
    </div>
</ng-template>

<!-- Upload Logs Modal -->
<ng-template #uploadLogsModal let-modal>
    <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
            <i class="fa fa-upload me-2"></i>
            Upload Progress
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="modal.dismiss('Cross click')" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        <div class="upload-logs-content">
            <div class="log-content" #logContent>
                <div class="log-entry" *ngFor="let log of uploadLogs">
                    {{ log }}
                </div>
                <div *ngIf="uploadLogs.length === 0" class="text-center text-muted">
                    Waiting for upload to start...
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="modal.dismiss('Cancel click')" [disabled]="isUploading">
            Close
        </button>
    </div>
</ng-template>
