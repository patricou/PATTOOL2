<!-- <div class="panel panel-default" [ngClass]="{'animated pulse':mouseOvered}" (mouseout)="mouseOvered=false" (mouseover)="mouseOvered=true" data-bs-hover-animate="pulse"> -->
<!-- thw following line allows to have tooltips on button in footer !! -->
<div class="card-wrapper" 
     [style.background]="getCardBackgroundGradient()">
    <div class="card-image-container" [ngStyle]="getPhotoFrameStyles()">
        <!-- Show slideshow if active, otherwise show thumbnail -->
        <img *ngIf="!isCardSlideshowActive" 
             #thumbnailImage 
             class="card-img img-fluid mx-auto d-block" 
             [src]="thumbnailUrl" 
             alt="Card image" 
             [ngStyle]="getPhotoImageStyles()"
             (load)="detectDominantColor()"
             (error)="onThumbnailError($event)" />
        
        <!-- Card Slideshow -->
        <div *ngIf="isCardSlideshowActive" class="card-slideshow-display">
            <!-- Photo counter in bottom left -->
            <div class="card-slideshow-counter"
                 [style.color]="getInverseTextColor()"
                 [style.background-color]="titleBackgroundColor">
                {{ currentCardSlideIndex + 1 }} / {{ cardSlideImages.length }}
            </div>
            
            <!-- Image name in bottom center -->
            <div class="card-slideshow-filename"
                 [style.color]="getInverseTextColor()"
                 [style.background-color]="titleBackgroundColor">
                {{ getCurrentCardSlideFileName() }}
            </div>
            
            <!-- RGB values in bottom right -->
            <div class="card-slideshow-rgb"
                 [style.color]="getInverseTextColor()"
                 [style.background-color]="titleBackgroundColor">
                {{ calculatedRgbValues }}
            </div>
            
            <img *ngIf="currentCardSlideImage" 
                 #cardSlideImage
                 class="card-img img-fluid mx-auto d-block slideshow-image" 
                 [src]="currentCardSlideImage" 
                 alt="Slideshow image"
                 [ngStyle]="getPhotoImageStyles()"
                 (load)="detectDominantColorFromSlideshow()" />
            
            <!-- Pause/Play toggle button - visible when playing -->
            <button *ngIf="!cardSlideshowPaused" 
                    class="btn btn-sm btn-outline-light card-slideshow-control-btn"
                    [style.border-color]="getInverseTextColor()"
                    (click)="toggleCardSlideshowPause(); $event.stopPropagation()">
                <i class="fa fa-pause" [style.color]="getInverseTextColor()"></i>
            </button>
            
            <!-- Play button in center when paused -->
            <button *ngIf="cardSlideshowPaused" 
                    class="btn btn-sm btn-outline-light card-slideshow-control-btn"
                    [style.border-color]="getInverseTextColor()"
                    (click)="toggleCardSlideshowPause(); $event.stopPropagation()">
                <i class="fa fa-play" [style.color]="getInverseTextColor()"></i>
            </button>
            
            <!-- Prev button on the left - always visible -->
            <button class="btn btn-sm btn-outline-light card-nav-btn card-nav-left"
                    [style.border-color]="getInverseTextColor()"
                    (click)="previousCardSlide(); $event.stopPropagation()">
                <i class="fa fa-chevron-left" [style.color]="getInverseTextColor()"></i>
            </button>
            
            <!-- Next button on the right - always visible -->
            <button class="btn btn-sm btn-outline-light card-nav-btn card-nav-right"
                    [style.border-color]="getInverseTextColor()"
                    (click)="nextCardSlide(); $event.stopPropagation()">
                <i class="fa fa-chevron-right" [style.color]="getInverseTextColor()"></i>
            </button>
        </div>
        
        <!-- Title overlay on the image - visible on top -->
        <div class="card-img-overlay">
            <h4 class="card-title text-center pat-card" 
                [style.background-color]="getInverseBackgroundColorTransparent()"
                [style.color]="getInverseTextColor()"
                style="padding: 0.1rem 0.75rem; border-radius: 0.25rem; display: inline-block; line-height: 1.1; margin-top: 0.5rem;">
                <b>{{evenement.evenementName}}</b>
            </h4>
            <!-- Play button in title to start slideshow -->
            <button *ngIf="hasImageFiles() && !isCardSlideshowActive" 
                    class="btn btn-sm btn-outline-light play-in-title-btn"
                    [style.border-color]="getInverseTextColor()"
                    (click)="startCardSlideshow(); $event.stopPropagation()">
                <i class="fa fa-play" [style.color]="getInverseTextColor()"></i>
            </button>
        </div>
    </div>
<div class="card-block pat-card-block" [style.color]="getInverseTextColor()">
    <div class="alert alert-warning small pat-alert text-center"
         [style.background-color]="descriptionBackgroundColor"
         [style.color]="getInverseTextColor()"
         [style.border-color]="getInverseTextColor()">
        {{evenement.comments}}
    </div>
    <div class="text-center mt-2" *ngIf="!titleOnly">
        <span class="badge rounded-pill rating-badge" 
              (click)="addRateMinus()" 
              placement="left"
              [style.background-color]="getRatingBadgeGradient()"
              [style.border-color]="getInverseTextColor()"
              [style.color]="getInverseTextColor()"
              ngbTooltip="{{ 'COMMUN.IDONTLIKE' | translate }}"
              (mouseleave)="onTooltipMouseLeave($event)"> {{evenement.ratingMinus || 0}}</span>
        <ngb-rating [(rate)]="currentRate" [style.color]="getInverseTextColor()">
        </ngb-rating>
        <span class="badge rounded-pill rating-badge" 
              (click)="addRatePlus()" 
              placement="right"
              [style.background-color]="getRatingBadgeGradient()"
              [style.border-color]="getInverseTextColor()"
              [style.color]="getInverseTextColor()"
              ngbTooltip="{{ 'COMMUN.ILIKE' | translate }}"
              (mouseleave)="onTooltipMouseLeave($event)">{{evenement.ratingPlus || 0}}</span>
    </div>
    <div class="card-text text-center" [ngSwitch]="evenement.status" *ngIf="!titleOnly" style="margin-top: 0.5rem;">
        <!--{{"EVENTELEM.STATUS" | translate }} :-->
        <b>
            <span *ngSwitchCase="'Closed'" 
                  class="badge status-badge me-2"
                  [style.background-color]="getStatusBadgeGradient()"
                  [style.border-color]="getInverseTextColor()"
                  [style.color]="getInverseTextColor()"
                  [style.border-width]="'2px'"
                  [style.border-style]="'solid'"
                  [style.box-shadow]="'0 2px 4px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.4), inset 0 -1px 0 rgba(0, 0, 0, 0.2)'"
                  [style.text-shadow]="'0 1px 2px rgba(0, 0, 0, 0.3)'">{{"COMMUN.STATUSCLOSE" | translate }}</span>
            <span *ngSwitchCase="'Open'" 
                  class="badge status-badge me-2"
                  [style.background-color]="getStatusBadgeGradient()"
                  [style.border-color]="getInverseTextColor()"
                  [style.color]="getInverseTextColor()"
                  [style.border-width]="'2px'"
                  [style.border-style]="'solid'"
                  [style.box-shadow]="'0 2px 4px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.4), inset 0 -1px 0 rgba(0, 0, 0, 0.2)'"
                  [style.text-shadow]="'0 1px 2px rgba(0, 0, 0, 0.3)'">{{"COMMUN.STATUSOPEN" | translate }}</span>
            <span *ngSwitchCase="'Cancel'" 
                  class="badge status-badge me-2"
                  [style.background-color]="getStatusBadgeGradient()"
                  [style.border-color]="getInverseTextColor()"
                  [style.color]="getInverseTextColor()"
                  [style.border-width]="'2px'"
                  [style.border-style]="'solid'"
                  [style.box-shadow]="'0 2px 4px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.4), inset 0 -1px 0 rgba(0, 0, 0, 0.2)'"
                  [style.text-shadow]="'0 1px 2px rgba(0, 0, 0, 0.3)'">{{"COMMUN.STATUSCANCEL" | translate }}</span>
            <span class="d-inline-flex align-items-center">
                <span [ngSwitch]="evenement.visibility">
                    <span *ngSwitchCase="'public'" 
                          class="badge visibility-badge"
                          [style.background-color]="getVisibilityBadgeGradient()"
                          [style.border-color]="getInverseTextColor()"
                          [style.color]="getInverseTextColor()"
                          [style.border-width]="'2px'"
                          [style.border-style]="'solid'"
                          [style.box-shadow]="'0 2px 4px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.4), inset 0 -1px 0 rgba(0, 0, 0, 0.2)'"
                          [style.text-shadow]="'0 1px 2px rgba(0, 0, 0, 0.3)'"
                          [style.cursor]="'pointer'"
                          (click)="showEventAccessUsers($event)">{{"EVENTCREATION.PUBLIC" | translate }}</span>
                    <span *ngSwitchCase="'private'" 
                          class="badge visibility-badge"
                          [style.background-color]="getVisibilityBadgeGradient()"
                          [style.border-color]="getInverseTextColor()"
                          [style.color]="getInverseTextColor()"
                          [style.border-width]="'2px'"
                          [style.border-style]="'solid'"
                          [style.box-shadow]="'0 2px 4px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.4), inset 0 -1px 0 rgba(0, 0, 0, 0.2)'"
                          [style.text-shadow]="'0 1px 2px rgba(0, 0, 0, 0.3)'"
                          [style.cursor]="'pointer'"
                          (click)="showEventAccessUsers($event)">{{"EVENTCREATION.PRIVATE" | translate }}</span>
                    <span *ngSwitchCase="'friends'" 
                          class="badge visibility-badge"
                          [style.background-color]="getVisibilityBadgeGradient()"
                          [style.border-color]="getInverseTextColor()"
                          [style.color]="getInverseTextColor()"
                          [style.border-width]="'2px'"
                          [style.border-style]="'solid'"
                          [style.box-shadow]="'0 2px 4px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.4), inset 0 -1px 0 rgba(0, 0, 0, 0.2)'"
                          [style.text-shadow]="'0 1px 2px rgba(0, 0, 0, 0.3)'"
                          [style.cursor]="'pointer'"
                          (click)="showEventAccessUsers($event)">{{"EVENTCREATION.FRIENDS" | translate }}</span>
                    <span *ngSwitchCase="'friendGroups'" 
                          class="badge visibility-badge"
                          [style.background-color]="getVisibilityBadgeGradient()"
                          [style.border-color]="getInverseTextColor()"
                          [style.color]="getInverseTextColor()"
                          [style.border-width]="'2px'"
                          [style.border-style]="'solid'"
                          [style.box-shadow]="'0 2px 4px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.4), inset 0 -1px 0 rgba(0, 0, 0, 0.2)'"
                          [style.text-shadow]="'0 1px 2px rgba(0, 0, 0, 0.3)'"
                          [style.cursor]="'pointer'"
                          (click)="showEventAccessUsers($event)">{{getVisibilityDisplayText()}}</span>
                    <span *ngSwitchDefault 
                          class="badge visibility-badge"
                          [style.background-color]="getVisibilityBadgeGradient()"
                          [style.border-color]="getInverseTextColor()"
                          [style.color]="getInverseTextColor()"
                          [style.border-width]="'2px'"
                          [style.border-style]="'solid'"
                          [style.box-shadow]="'0 2px 4px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.4), inset 0 -1px 0 rgba(0, 0, 0, 0.2)'"
                          [style.text-shadow]="'0 1px 2px rgba(0, 0, 0, 0.3)'"
                          [style.cursor]="'pointer'"
                          (click)="showEventAccessUsers($event)">{{getVisibilityDisplayText()}}</span>
                </span>
                <!-- WhatsApp button for friend groups - displayed if friendGroup has WhatsApp link, regardless of owner -->
                <button *ngIf="hasFriendGroupWhatsAppLink()"
                        type="button"
                        class="btn btn-sm ms-2 dynamic-footer-btn"
                        [ngStyle]="getWhatsAppButtonStyles()"
                        (click)="openFriendGroupWhatsAppLink(); $event.stopPropagation()"
                        ngbTooltip="{{ 'FRIENDS.OPEN_WHATSAPP' | translate }}"
                        placement="top"
                        (mouseleave)="onTooltipMouseLeave($event)"
                        style="padding: 0.25rem 0.5rem; line-height: 1;">
                    <i class="fa fa-whatsapp"></i>
                </button>
            </span>
        </b>
    </div>
    <small class="mb-2 proprietaire-line text-center" [style.color]="getInverseTextColor()" *ngIf="!titleOnly && evenement.author">
        <i>{{ "EVENTELEM.OWNER_LABEL" | translate }} : {{ evenement.author.firstName }} {{ evenement.author.lastName }} / {{ evenement.author.userName }}</i>
    </small>
    <div class="card-info-box" [style.background-color]="getSolidColor(0.22)" [style.border-color]="getSolidColor(0.35)" *ngIf="!titleOnly">
        <ul class="card-info-list">
            <li class="card-info-item">
                {{"EVENTELEM.TYPE" | translate }} : {{ getEventTypeLabel(evenement.type) }}
            </li>
            <li class="card-info-item" [ngSwitch]="+evenement.diffculty">
                {{"EVENTELEM.DIFF" | translate }} :
                <span *ngSwitchCase="0">{{"EVENTCREATION.DIFF.NA" | translate }}</span>
                <span *ngSwitchCase="1">{{"EVENTCREATION.DIFF.0" | translate }}</span>
                <span *ngSwitchCase="2">{{"EVENTCREATION.DIFF.1" | translate }}</span>
                <span *ngSwitchCase="3">{{"EVENTCREATION.DIFF.2" | translate }}</span>
                <span *ngSwitchCase="4">{{"EVENTCREATION.DIFF.3" | translate }}</span>
                <span *ngSwitchCase="5">{{"EVENTCREATION.DIFF.4" | translate }}</span>
                <span *ngSwitchDefault>{{"EVENTCREATION.DIFF.NA" | translate }}</span>
            </li>
            <li class="card-info-item">
                {{"EVENTELEM.STARTLOCATION" | translate }} : {{evenement.startLocation}}
            </li>
            <li class="card-info-item">
                {{"EVENTELEM.BEGINDT" | translate }} : {{formatEventDateTime(evenement.beginEventDate, evenement.startHour)}}
            </li>
        </ul>
    </div>
    <div class="card-text" *ngIf="showParticipantsList && !titleOnly">
        <hr>
        <h5 class="pat-members d-flex justify-content-between align-items-center">
            <div>
                <b> <span style="font-size: 0.85rem;">{{"EVENTELEM.MEMBERS" | translate }} ({{ evenement.members.length }})</span> : </b>
                <button class="btn btn-sm btn-outline-secondary ms-1" 
                        style="padding: 0.1rem 0.25rem; font-size: 0.65rem;"
                        (click)="toggleParticipantsList()"
                        [title]="('EVENTELEM.HIDE_PARTICIPANTS' | translate)">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div>
                <button class="btn btn-sm participation-button ms-1" 
                        style="padding: 0.1rem 0.4rem; font-size: 0.7rem;"
                        *ngIf="!isParticipant()"
                        type="button"
                        [ngStyle]="getParticipantButtonStyles(false)"
                        (click)="addMemberClick()">
                    <i class="fa fa-user-plus"></i> {{ 'EVENTELEM.IWTP' | translate }}
                </button>
                <button class="btn btn-sm participation-button ms-1" 
                        style="padding: 0.1rem 0.4rem; font-size: 0.7rem;"
                        *ngIf="isParticipant()"
                        type="button"
                        [ngStyle]="getParticipantButtonStyles(true)"
                        (click)="delMemberClick()">
                    <i class="fa fa-user-times"></i> {{ 'EVENTELEM.IDWTP' | translate }}
                </button>
            </div>
        </h5>
        <div class="participants-container mt-2">
            <div *ngIf="evenement.members.length > 0; else noParticipantsTemplate" class="text-center">
                <span *ngFor="let member of evenement.members; let last = last" class="badge participant-badge me-1 mb-1"
                      [ngStyle]="getParticipantBadgeStyles()">
                    <i class="fa fa-user me-1"></i>
                    <span class="clickable-user" 
                          (click)="openUserModal(member)"
                          title="Cliquer pour voir les détails du participant">
                        {{member.firstName}} {{member.lastName}} / {{member.userName}}
                    </span>
                    <button class="btn btn-xs btn-outline-light ms-2" 
                            style="padding: 0.05rem 0.15rem; font-size: 0.5rem; border: none;"
                            (click)="sendEmail(member.addressEmail); $event.stopPropagation()"
                            title="{{ 'EVENTELEM.SEND_EMAIL' | translate }}">
                        <i class="fa fa-envelope"></i>
                    </button>
                </span>
            </div>
            <ng-template #noParticipantsTemplate>
                <div class="text-muted text-center py-2" [style.color]="getInverseTextColor()">
                    <i class="fa fa-users"></i> Aucun participant pour le moment
                </div>
            </ng-template>
        </div>
    </div>
</div>

<ng-container *ngIf="!titleOnly">
<div class="card-footer card-text text-center" [style.color]="getInverseTextColor()">
    <button class="btn btn-sm btn-outline-success mb-1 me-1 dynamic-footer-btn" 
            [hidden]="!(hasImageFiles() || getPhotoFromFsCount() > 0)" 
            [ngStyle]="getFooterButtonStyles('photos')"
            (click)="openPhotos()"
            placement="top"
            container="body"
            ngbTooltip="{{ 'EVENTELEM.SLIDESHOW_TITLE' | translate }}"
            (mouseleave)="onTooltipMouseLeave($event)">
        <i class="fa fa-picture-o" aria-hidden="true"></i> {{ getTotalPhotosCount() }}
    </button>
    
    <a *ngIf="isAuthor()"
       class="btn btn-sm btn-outline-primary mb-1 me-1 dynamic-footer-btn" 
       [ngStyle]="getFooterButtonStyles('download')"
       (click)="onFilesButtonClick(filesModal); $event.stopPropagation()"
       placement="top" 
       ngbTooltip="{{ 'EVENTELEM.FILESDOWNLOAD'| translate }}"
       (mouseleave)="onTooltipMouseLeave($event)">
        <i class="fa fa-download" aria-hidden="true"></i> {{ getFileUploadedsLength() }}
    </a>

    <div *ngIf="isAuthor()"
         class="file-upload-wrapper me-1" placement="top" ngbTooltip="{{ 'EVENTELEM.UPLOAD' | translate }}"
         (mouseleave)="onTooltipMouseLeave($event)">
        <label [for]="'file-upload-input-' + evenement.id" 
               class="btn btn-sm btn-success mb-1 dynamic-footer-btn"
               [ngStyle]="getFooterButtonStyles('upload')">
            <i class="fa fa-upload" aria-hidden="true"></i>
        </label>
        <input type="file" [id]="'file-upload-input-' + evenement.id" #fileInput (change)="onFileSelected($event)" multiple 
               accept="image/*,video/*,.mp4,.webm,.ogg,.ogv,.mov,.avi,.mkv,.flv,.wmv,.m4v,.3gp,.pdf,.doc,.docx,.xls,.xlsx,.ods,.odt,.txt,.zip,.rar,.gpx,.kml,.kmz,.gdb,.tcx" style="display: none;" />
    </div>
    
    <a class="btn btn-sm btn-outline-info mb-1 me-1 eye-button dynamic-footer-btn" 
       [routerLink]="['/details-evenement', evenement.id]" 
       [ngStyle]="getFooterButtonStyles('details')"
       placement="top"
       ngbTooltip="{{ 'EVENTELEM.VIEW_DETAILS' | translate }}"
       (click)="storeEventIdForReturn()"
       (mouseleave)="onTooltipMouseLeave($event)">
        <i class="fa fa-eye" aria-hidden="true"></i>
    </a>
    
    <button *ngIf="getUrlEventsCount() > 0"
            class="btn btn-primary btn-sm mb-1 me-1 dynamic-footer-btn" 
            [ngStyle]="getFooterButtonStyles('urls')"
            (click)="openUrlsModal(urlsModal)" 
            placement="top"
            ngbTooltip="{{ 'EVENTELEM.URLS' | translate }} ({{ getUrlEventsCount() }})"
            (mouseleave)="onTooltipMouseLeave($event)">
        <i class="fa fa-link" aria-hidden="true"></i> {{ getUrlEventsCount() }}
    </button>

    <button *ngIf="hasComments()" 
            class="btn btn-sm comments-button mb-1 me-1 dynamic-footer-btn" 
            [ngStyle]="getFooterButtonStyles('comments')"
            (click)="openCommentsModal()" 
            placement="top"
            ngbTooltip="{{ 'EVENTHOME.COMMENTARIES' | translate }}"
            (mouseleave)="onTooltipMouseLeave($event)">
        <i class="fa fa-comments" aria-hidden="true"></i> {{ getCommentsCount() }}
    </button>

    <button class="btn btn-sm btn-outline-info mb-1 me-1 dynamic-footer-btn" 
            [ngStyle]="getFooterButtonStyles('discussion')"
            (click)="openDiscussionModal()" 
            placement="top"
            ngbTooltip="Discussion"
            (mouseleave)="onTooltipMouseLeave($event)">
        <i class="fa fa-commenting" aria-hidden="true"></i>
    </button>
    
    <a class="btn btn-sm btn-success mb-1 me-1 dynamic-footer-btn" 
       [ngStyle]="getFooterButtonStyles('participation')"
       (click)="addMemberClick()" 
       ngbTooltip="{{ 'EVENTELEM.PARTICIPATION' | translate }}" 
       placement="top"
       (mouseleave)="onTooltipMouseLeave($event)"><i class="fa fa-user-o" aria-hidden="true"></i></a>
    <a class="btn btn-sm btn-primary mb-1 me-1 dynamic-footer-btn" 
       *ngIf="isAuthor()"
       [ngStyle]="getFooterButtonStyles('status')"
       (click)="changeStatusEvent(evenement.status)"
       ngbTooltip="{{ 'EVENTELEM.CHGTSTATUS' | translate }}" 
       placement="top"
       (mouseleave)="onTooltipMouseLeave($event)"><i class="fa fa-circle-o-notch"
            aria-hidden="true"></i></a>
    <button class="btn btn-sm btn-info mb-1 me-1 dynamic-footer-btn" 
            *ngIf="isAuthor() && canChangeVisibility()" 
            [ngStyle]="getFooterButtonStyles('visibility')"
            (click)="openVisibilityModal(); $event.stopPropagation(); $event.preventDefault()"
            ngbTooltip="{{ 'EVENTELEM.CHANGE_VISIBILITY' | translate }}" 
            placement="top"
            (mouseleave)="onTooltipMouseLeave($event)"
            type="button">
        <i class="fa fa-lock" aria-hidden="true"></i>
    </button>
    <button class="btn btn-sm btn-warning mb-1 me-1 dynamic-footer-btn" 
            *ngIf="isAuthor()" 
            [ngStyle]="getFooterButtonStyles('type')"
            (click)="openTypeModal(); $event.stopPropagation(); $event.preventDefault()"
            ngbTooltip="{{ 'EVENTELEM.CHANGE_TYPE' | translate }}" 
            placement="top"
            (mouseleave)="onTooltipMouseLeave($event)"
            type="button">
        <i class="fa fa-list-alt" aria-hidden="true"></i>
    </button>
    <a *ngIf="isAuthor()"
       class="btn btn-sm btn-warning mb-1 me-1 dynamic-footer-btn" 
       [ngStyle]="getFooterButtonStyles('edit')"
       [routerLink]="['/updeven',evenement.id]"
       (click)="storeEventIdForReturn()"
       ngbTooltip="{{ 'EVENTELEM.UTE' | translate }}" 
       placement="top"
       (mouseleave)="onTooltipMouseLeave($event)"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>
    <!-- Admin delete button - only visible when admin override is enabled -->
    <button *ngIf="adminOverride && isAdmin()"
            type="button"
            class="btn btn-sm btn-danger mb-1 me-1"
            (click)="deleteEvenement(); $event.stopPropagation()"
            [ngbTooltip]="'EVENTELEM.DELETE_EVENT_ADMIN' | translate"
            placement="top"
            (mouseleave)="onTooltipMouseLeave($event)">
        <i class="fa fa-trash" aria-hidden="true"></i>
    </button>

</div>
<div class="text-center mt-1 mb-1" *ngIf="!titleOnly && getCurrentCardLoadTime() > 0" [style.color]="getInverseTextColor()">
    <small style="opacity: 0.7; font-size: 0.7rem;">
        <i class="fa fa-clock-o me-1"></i>Load time: {{ formatTimeForCard(getCurrentCardLoadTime()) }}
    </small>
</div>
</ng-container>

<!-- Comments Modal -->
<ng-template #commentsModal let-c="close" let-d="dismiss">
    <div class="modal-header text-white selector-header rounded-top"
         [ngStyle]="getCommentsModalHeaderStyle()"
         [class.bg-primary]="!getCalculatedColor()">
        <h5 class="modal-title" style="font-size: calc(1.25rem - 2px);">
            <i class="fa fa-comments"></i> {{ 'EVENTHOME.COMMENTARIES' | translate }} - {{ evenement.evenementName }}
        </h5>
        <button type="button" class="btn btn-outline-light btn-sm rounded-circle ms-auto" (click)="c('Close click')" aria-label="Close">
            <i class="fa fa-times"></i>
        </button>
    </div>
    <div class="modal-body selector-body" 
         style="background-color: #ffffff; color: #000000;">
        <app-commentary-editor
            [commentaries]="evenement.commentaries || []"
            [currentUser]="user"
            [eventId]="evenement.id"
            [eventColor]="getCalculatedColor()"
            (commentaryAdded)="onCommentaryAdded($event)"
            (commentaryUpdated)="onCommentaryUpdated($event)"
            (commentaryDeleted)="onCommentaryDeleted($event)">
        </app-commentary-editor>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="c()">
            <i class="fa fa-times"></i> {{ 'COMMUN.CLOSE' | translate }}
        </button>
    </div>
</ng-template>

<!-- JSON View Modal -->
<ng-template #jsonModal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h5 class="modal-title">{{evenement.evenementName}}<small> ({{ 'EVENTELEM.FORMAT_JSON' | translate }})</small></h5>
    </div>
    <div class="modal-body">
        <div class="json-container">
            <pre class="json-content">{{getEventAsJson()}}</pre>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="c('Close click')">{{"COMMUN.CLOSE" | translate }}</button>
    </div>
</ng-template>

<!-- URLs Modal -->
<ng-template #urlsModal let-c="close" let-d="dismiss">
    <div class="modal-header bg-primary text-white border border-2 border-white rounded-top">
        <h5 class="modal-title" style="font-size: calc(1.25rem - 2px);">
            <i class="fa fa-link"></i> {{ 'EVENTELEM.URLS' | translate }} - {{ evenement.evenementName }}
        </h5>
        <button type="button" class="btn btn-outline-light btn-sm rounded-circle ms-auto border border-2 border-white" (click)="d('Cross click')" aria-label="Close">
            <i class="fa fa-times"></i>
        </button>
    </div>
    <div class="modal-body">
        <div *ngIf="isUrlEventsAvailable(); else noUrlsTemplate">
            <div class="url-events-container">
                <!-- Group URLs by type -->
                <div *ngFor="let typeKey of getSortedTypeKeys()" class="url-type-group mb-4">
                    <!-- Type Header -->
                    <div class="url-type-header mb-3">
                        <h6 class="url-type-title">
                            <i class="fa fa-folder"></i> {{ getUrlTypeLabel(typeKey) | translate }}
                            <span class="badge bg-secondary ms-2">{{ getGroupedUrlEvents()[typeKey].length }}</span>
                        </h6>
                        <hr class="url-type-divider">
                    </div>
                    
                    <!-- URLs for this type -->
                    <div class="url-type-content">
                        <div class="url-event-item mb-3" *ngFor="let urlEvent of getGroupedUrlEvents()[typeKey]; let i = index">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <div class="url-event-meta">
                                        <small class="text-muted">
                                            <i class="fa fa-user"></i> {{ urlEvent.owner }} | 
                                            <i class="fa fa-calendar"></i> {{ urlEvent.dateCreation | date:'short' }}
                                        </small>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="url-event-content d-flex align-items-start gap-3">
                                        <div class="url-event-link">
                                            <a [href]="urlEvent.link"
                                               target="_blank"
                                               class="btn btn-outline-primary btn-sm"
                                               [title]="urlEvent.link">
                                                <i class="fa {{ getUrlEventIcon(urlEvent) }}"></i> {{ getTruncatedUrl(urlEvent.link) }}
                                            </a>
                                        </div>
                                        <div class="url-event-description flex-grow-1" *ngIf="urlEvent.urlDescription">
                                            <p class="text-muted mb-0">{{ urlEvent.urlDescription }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <ng-template #noUrlsTemplate>
            <div class="text-center text-muted py-4">
                <i class="fa fa-link fa-3x mb-3"></i>
                <p>{{ 'EVENTHOME.NO_LINKS_ADDED' | translate }}</p>
            </div>
        </ng-template>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="c('Close click')">
            <i class="fa fa-times"></i> {{ 'COMMUN.CLOSE' | translate }}
        </button>
    </div>
</ng-template>

<!-- Files Management Modal -->
<ng-template #filesModal let-c="close" let-d="dismiss">
    <div class="modal-header bg-primary text-white selector-header border border-2 border-white rounded-top">
        <h5 class="modal-title" style="font-size: calc(1.25rem - 2px);">
            <i class="fa fa-files-o"></i> {{ 'EVENTELEM.FILES' | translate }} - {{ evenement.evenementName }} ({{ getFileUploadedsLength() }})
        </h5>
        <button type="button" class="btn btn-outline-light btn-sm rounded-circle ms-auto files-modal-close-btn" (click)="c('Close click')" aria-label="Close">
            <i class="fa fa-times"></i>
        </button>
    </div>
    <div class="modal-body selector-body" style="max-height: 70vh; overflow-y: auto;">
        <div *ngIf="isLoadingFiles" class="text-center py-4">
            <i class="fa fa-spinner fa-spin fa-2x"></i>
            <p class="mt-2">{{ 'COMMUN.LOADING' | translate }}...</p>
        </div>
        <div *ngIf="!isLoadingFiles && evenement.fileUploadeds && evenement.fileUploadeds.length > 0; else noFilesTemplate">
            <div class="files-container">
                <!-- Group files by type -->
                <div *ngFor="let typeKey of getSortedFileTypeKeys()" class="file-type-group mb-4">
                    <!-- Type Header -->
                    <div class="file-type-header mb-3">
                        <h6 class="file-type-title clickable-file-type-header"
                            [ngbTooltip]="getFileTypeLabel(typeKey) | translate"
                            placement="top"
                            container="body"
                            (click)="toggleFileTypeExpansion(typeKey)"
                            (mouseleave)="onTooltipMouseLeave($event)"
                            [style.cursor]="'pointer'">
                            <i class="fa me-2" 
                               [class.fa-chevron-right]="!isFileTypeExpanded(typeKey)"
                               [class.fa-chevron-down]="isFileTypeExpanded(typeKey)"></i>
                            <i class="fa fa-folder me-2"></i> {{ getFileTypeLabel(typeKey) | translate }}
                            <span class="badge bg-secondary ms-2">{{ getGroupedFiles()[typeKey].length }}</span>
                        </h6>
                        <hr class="file-type-divider">
                    </div>
                    
                    <!-- Files for this type -->
                    <div class="file-type-content" *ngIf="isFileTypeExpanded(typeKey)">
                        <ul class="list-group files-list" 
                            [style.background-color]="getFilesListGradient()">
                            <li class="list-group-item d-flex justify-content-between align-items-center"
                                *ngFor="let uploadedFile of getGroupedFiles()[typeKey]">
                    <span class="file-name d-flex align-items-center">
                        <!-- Thumbnail for image files -->
                        <img *ngIf="isImageFile(uploadedFile.fileName) && getFileThumbnail(uploadedFile.fieldId)" 
                             [src]="getFileThumbnail(uploadedFile.fieldId)" 
                             class="file-thumbnail me-2"
                             [class.file-thumbnail-clickable]="isImageFile(uploadedFile.fileName)"
                             [alt]="uploadedFile.fileName"
                             (click)="isImageFile(uploadedFile.fileName) && handleFileClick(uploadedFile)"
                             (load)="onFileThumbnailLoaded(uploadedFile.fieldId)"
                             (error)="hideImageOnError($event)"
                             [style.cursor]="isImageFile(uploadedFile.fileName) ? 'pointer' : 'default'"
                             [title]="isImageFile(uploadedFile.fileName) ? ('EVENTELEM.CLICK_TO_VIEW' | translate) : ''" />
                        <!-- Loading indicator for image thumbnails -->
                        <span *ngIf="isImageFile(uploadedFile.fileName) && isThumbnailLoading(uploadedFile.fieldId) && !getFileThumbnail(uploadedFile.fieldId)"
                              class="file-thumbnail-loading me-2">
                            <i class="fa fa-spinner fa-spin"></i>
                        </span>
                        <!-- Thumbnail for video files -->
                        <ng-container *ngIf="isVideoFile(uploadedFile.fileName)">
                            <ng-container *ngIf="getVideoThumbnail(uploadedFile.fieldId) as videoThumbnail; else videoThumbnailLoading">
                                <img [src]="videoThumbnail" 
                                     class="file-thumbnail video-thumbnail me-2"
                                     [alt]="uploadedFile.fileName"
                                     (click)="openSingleVideoInVideoshow(uploadedFile.fieldId, uploadedFile.fileName)"
                                     (error)="hideImageOnError($event)"
                                     style="cursor: pointer;"
                                     [title]="'EVENTELEM.CLICK_TO_VIEW' | translate" />
                            </ng-container>
                            <ng-template #videoThumbnailLoading>
                                <span *ngIf="isVideoThumbnailLoading(uploadedFile.fieldId)"
                                      class="file-thumbnail-loading me-2">
                                    <i class="fa fa-spinner fa-spin"></i>
                                </span>
                            </ng-template>
                        </ng-container>
                        <span class="badge"
                              [class.badge-clickable]="isImageFile(uploadedFile.fileName) || isVideoFile(uploadedFile.fileName) || isPdfFile(uploadedFile.fileName) || isTrackFile(uploadedFile.fileName)"
                              [style.background-color]="getFileBadgeColor(uploadedFile.fileName)"
                              [style.border-color]="getInverseTextColor()"
                              [style.color]="getInverseTextColor()"
                              [title]="uploadedFile.fileName"
                              ngbTooltip="{{uploadedFile.fileName}}" 
                              placement="top"
                              (mouseleave)="onTooltipMouseLeave($event)"
                              (click)="(isImageFile(uploadedFile.fileName) || isVideoFile(uploadedFile.fileName) || isPdfFile(uploadedFile.fileName) || isTrackFile(uploadedFile.fileName)) && handleFileClick(uploadedFile)"
                              [style.cursor]="(isImageFile(uploadedFile.fileName) || isVideoFile(uploadedFile.fileName) || isPdfFile(uploadedFile.fileName) || isTrackFile(uploadedFile.fileName)) ? 'pointer' : 'default'">
                            {{getTruncatedFileName(uploadedFile.fileName)}}
                        </span>
                        <small class="text-muted ms-2 clickable-user" [style.color]="getInverseTextColor()" 
                               (click)="openUserModal(uploadedFile.uploaderMember)"
                               title="Cliquer pour voir les détails de l'utilisateur">
                            {{uploadedFile.uploaderMember.userName}}
                        </small>
                    </span>
                    <div class="file-actions">
                        <button class="btn btn-sm btn-warning me-2"
                                *ngIf="isImageFile(uploadedFile.fileName)"
                                [disabled]="isThumbnailFile(uploadedFile)"
                                ngbTooltip="{{ 'EVENTELEM.SET_AS_CARD_IMAGE' | translate }}"
                                (click)="setFileAsThumbnail(uploadedFile)"
                                [style.background-color]="getFileActionButtonGradient()"
                                [style.border-color]="getInverseTextColor()"
                                [style.color]="getInverseTextColor()"
                                (mouseleave)="onTooltipMouseLeave($event)">
                            <i class="fa fa-star" aria-hidden="true"></i>
                        </button>
                        <button class="btn btn-sm btn-info me-2"
                                *ngIf="isTrackFile(uploadedFile.fileName)"
                                ngbTooltip="{{ 'EVENTELEM.VIEW_TRACK' | translate }}"
                                (click)="openTrackFile(uploadedFile)"
                                [style.background-color]="getFileActionButtonGradient()"
                                [style.border-color]="getInverseTextColor()"
                                [style.color]="getInverseTextColor()"
                                (mouseleave)="onTooltipMouseLeave($event)">
                            <i class="fa fa-eye" aria-hidden="true"></i>
                        </button>
                        <button class="btn btn-sm btn-primary me-2"
                                *ngIf="isVideoFile(uploadedFile.fileName)"
                                ngbTooltip="{{ 'EVENTELEM.CLICK_TO_VIEW_VIDEO' | translate }}"
                                (click)="openSingleVideoInVideoshow(uploadedFile.fieldId, uploadedFile.fileName)"
                                [style.background-color]="getFileActionButtonGradient()"
                                [style.border-color]="getInverseTextColor()"
                                [style.color]="getInverseTextColor()"
                                (mouseleave)="onTooltipMouseLeave($event)">
                            <i class="fa fa-video-camera" aria-hidden="true"></i>
                        </button>
                        <button class="btn btn-sm btn-primary me-2"
                                *ngIf="isPdfFile(uploadedFile.fileName)"
                                ngbTooltip="{{ 'EVENTELEM.CLICK_TO_OPEN_PDF' | translate }}"
                                (click)="openPdfFile(uploadedFile.fieldId, uploadedFile.fileName)"
                                [style.background-color]="getFileActionButtonGradient()"
                                [style.border-color]="getInverseTextColor()"
                                [style.color]="getInverseTextColor()"
                                (mouseleave)="onTooltipMouseLeave($event)">
                            <i class="fa fa-eye" aria-hidden="true"></i>
                        </button>
                        <button class="btn btn-sm btn-primary me-2" placement="left"
                            ngbTooltip="{{ 'COMMUN.DOWNLOAD' | translate }}"
                            (click)="openWindows(uploadedFile.fieldId, uploadedFile.fileName)"
                            [style.background-color]="getFileActionButtonGradient()"
                            [style.border-color]="getInverseTextColor()"
                            [style.color]="getInverseTextColor()"
                            (mouseleave)="onTooltipMouseLeave($event)">
                            <i class="fa fa-files-o" aria-hidden="true"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" placement="left"
                            [ngbTooltip]="isThumbnailFile(uploadedFile) ? ('EVENTELEM.CANNOT_DELETE_THUMBNAIL' | translate) : ('EVENTELEM.DELETEFILE' | translate)"
                            [disabled]="!isFileOwner(uploadedFile.uploaderMember) || isThumbnailFile(uploadedFile)"
                            (click)="delFile(uploadedFile.fieldId)"
                            [style.background-color]="getFileActionButtonGradient()"
                            [style.border-color]="getInverseTextColor()"
                            [style.color]="getInverseTextColor()"
                            (mouseleave)="onTooltipMouseLeave($event)">
                            <i class="fa fa-trash" aria-hidden="true"></i>
                        </button>
                    </div>
                </li>
            </ul>
                    </div>
                </div>
            </div>
        </div>
        <ng-template #noFilesTemplate>
            <div class="text-center text-muted py-4">
                <i class="fa fa-files-o fa-3x mb-3"></i>
                <p>{{ 'EVENTELEM.NO_FILES' | translate }}</p>
            </div>
        </ng-template>
    </div>
    <div class="modal-footer">
        <button class="btn btn-sm btn-success" 
                *ngIf="evenement.fileUploadeds && evenement.fileUploadeds.length > 0"
                (click)="downloadAllFiles()"
                [style.background-color]="getDownloadAllButtonGradient()"
                [style.border-color]="getInverseTextColor()"
                [style.color]="getInverseTextColor()">
            <i class="fa fa-download"></i> {{ 'COMMUN.DOWNLOAD_ALL' | translate }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="c('Close click')">
            <i class="fa fa-times"></i> {{ 'COMMUN.CLOSE' | translate }}
        </button>
    </div>
</ng-template>

<!-- FS Photos Selector Modal -->
<!-- Photos Selector Modal Component -->
<app-photos-selector-modal #photosSelectorModalComponent (selectionConfirmed)="onPhotosSelectionConfirmed($event)"></app-photos-selector-modal>

<!-- User Details Modal -->
<ng-template #userModal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h5 class="modal-title">
            <i class="fa fa-user me-2"></i>
            Détails de l'utilisateur
        </h5>
        <button type="button" class="btn btn-outline-light btn-sm rounded-circle ms-auto border border-2 border-white" (click)="d('Cross click')" aria-label="Close">
            <i class="fa fa-times"></i>
        </button>
    </div>
    <div class="modal-body" *ngIf="selectedUser">
        <div class="user-details">
            <div class="detail-row">
                <strong>Prénom :</strong>
                <span>{{ selectedUser.firstName }}</span>
            </div>
            <div class="detail-row">
                <strong>Nom :</strong>
                <span>{{ selectedUser.lastName }}</span>
            </div>
            <div class="detail-row">
                <strong>Nom d'utilisateur :</strong>
                <span>{{ selectedUser.userName }}</span>
            </div>
            <div class="detail-row">
                <strong>Email :</strong>
                <span>{{ selectedUser.addressEmail }}
                    <button class="btn btn-sm btn-outline-primary ms-2" 
                            (click)="sendEmail(selectedUser.addressEmail)"
                            title="{{ 'EVENTELEM.SEND_EMAIL' | translate }}">
                        <i class="fa fa-envelope"></i>
                    </button>
                </span>
            </div>
            <div class="detail-row">
                <strong>ID :</strong>
                <span>{{ selectedUser.id }}</span>
            </div>
            <div class="detail-row">
                <strong>Keycloak ID :</strong>
                <span>{{ selectedUser.keycloakId }}</span>
            </div>
            <div class="detail-row">
                <strong>Rôles :</strong>
                <span>{{ selectedUser.roles.join(', ') }}</span>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="c('Close click')">
            Fermer
        </button>
    </div>
</ng-template>

<!-- Slideshow Modal Component -->
<app-slideshow-modal #slideshowModalComponent (closed)="onSlideshowClosed()" (openLocationInTrace)="onSlideshowLocationInTrace($event)"></app-slideshow-modal>

<!-- Videoshow Modal Component -->
<app-videoshow-modal #videoshowModalComponent (closed)="onVideoshowClosed()"></app-videoshow-modal>

<!-- Trace Viewer Modal Component -->
<app-trace-viewer-modal #traceViewerModalComponent (closed)="onTraceViewerClosed()"></app-trace-viewer-modal>


<!-- Upload Logs Modal -->
<ng-template #uploadLogsModal let-modal>
    <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
            <i class="fa fa-upload me-2"></i>
            {{ 'EVENTELEM.UPLOAD_PROGRESS' | translate }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeUploadLogsModal()" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        <div class="upload-logs-content">
            <div class="log-content" #logContent>
                <div class="log-entry" 
                     *ngFor="let log of uploadLogs"
                     [class.log-success]="log.startsWith('SUCCESS:')"
                     [class.log-error]="log.startsWith('ERROR:')">
                    {{ log }}
                </div>
                <div *ngIf="uploadLogs.length === 0" class="text-center text-muted">
                    Waiting for upload to start...
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeUploadLogsModal()">
            Close
        </button>
    </div>
</ng-template>

<!-- Video Compression Quality Selection Modal -->
<ng-template #qualitySelectionModal let-modal>
    <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
            <i class="fa fa-video-camera me-2"></i>
            {{ 'EVENTELEM.VIDEO_COMPRESSION_TITLE' | translate }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="cancelQualitySelection()" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        <p>{{ 'EVENTELEM.VIDEO_COMPRESSION_MESSAGE' | translate: {count: videoCountForModal} }}</p>
        <div class="form-group mb-3">
            <label class="form-label fw-bold">{{ 'EVENTELEM.QUALITY' | translate }}:</label>
            <select class="form-select" [(ngModel)]="selectedCompressionQuality">
                <option value="low">{{ 'EVENTELEM.QUALITY_LOW' | translate }} - {{ 'EVENTELEM.QUALITY_LOW_DESC' | translate }}</option>
                <option value="medium">{{ 'EVENTELEM.QUALITY_MEDIUM' | translate }} - {{ 'EVENTELEM.QUALITY_MEDIUM_DESC' | translate }}</option>
                <option value="high">{{ 'EVENTELEM.QUALITY_HIGH' | translate }} - {{ 'EVENTELEM.QUALITY_HIGH_DESC' | translate }}</option>
                <option value="very-high">{{ 'EVENTELEM.QUALITY_VERY_HIGH' | translate }} - {{ 'EVENTELEM.QUALITY_VERY_HIGH_DESC' | translate }}</option>
                <option value="original">{{ 'EVENTELEM.QUALITY_ORIGINAL' | translate }} - {{ 'EVENTELEM.QUALITY_ORIGINAL_DESC' | translate }}</option>
            </select>
        </div>
        <div class="alert alert-info small">
            <strong>{{ 'EVENTELEM.QUALITY_LOW' | translate }}:</strong> {{ 'EVENTELEM.QUALITY_LOW_DETAILS' | translate }}<br>
            <strong>{{ 'EVENTELEM.QUALITY_MEDIUM' | translate }}:</strong> {{ 'EVENTELEM.QUALITY_MEDIUM_DETAILS' | translate }}<br>
            <strong>{{ 'EVENTELEM.QUALITY_HIGH' | translate }}:</strong> {{ 'EVENTELEM.QUALITY_HIGH_DETAILS' | translate }}<br>
            <strong>{{ 'EVENTELEM.QUALITY_VERY_HIGH' | translate }}:</strong> {{ 'EVENTELEM.QUALITY_VERY_HIGH_DETAILS' | translate }}<br>
            <strong>{{ 'EVENTELEM.QUALITY_ORIGINAL' | translate }}:</strong> {{ 'EVENTELEM.QUALITY_ORIGINAL_DETAILS' | translate }}
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelQualitySelection()">
            {{ 'EVENTELEM.CANCEL' | translate }}
        </button>
        <button type="button" class="btn btn-primary" (click)="confirmQualitySelection()">
            {{ 'EVENTELEM.CONFIRM' | translate }}
        </button>
    </div>
</ng-template>

<!-- Image Compression Selection Modal -->
<ng-template #imageCompressionModal let-modal>
    <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
            <i class="fa fa-image me-2"></i>
            {{ 'EVENTELEM.IMAGE_COMPRESSION_TITLE' | translate }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="cancelImageCompression()" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        <p>{{ 'EVENTELEM.IMAGE_COMPRESSION_MESSAGE' | translate: {count: imageCountForModal} }}</p>
        <div class="form-group mb-3">
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="compressImagesSwitch" [(ngModel)]="compressImages">
                <label class="form-check-label" for="compressImagesSwitch">
                    {{ 'EVENTELEM.COMPRESS_IMAGES' | translate }}
                </label>
            </div>
        </div>
        <div class="alert alert-info small">
            <strong>{{ 'EVENTELEM.COMPRESS_IMAGES_ENABLED' | translate }}:</strong> {{ 'EVENTELEM.COMPRESS_IMAGES_ENABLED_DETAILS' | translate }}<br>
            <strong>{{ 'EVENTELEM.COMPRESS_IMAGES_DISABLED' | translate }}:</strong> {{ 'EVENTELEM.COMPRESS_IMAGES_DISABLED_DETAILS' | translate }}
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelImageCompression()">
            {{ 'EVENTELEM.CANCEL' | translate }}
        </button>
        <button type="button" class="btn btn-primary" (click)="confirmImageCompression()">
            {{ 'EVENTELEM.CONFIRM' | translate }}
        </button>
    </div>
</ng-template>

<!-- Loading Statistics Modal -->
<ng-template #loadingStatsModal let-c="close" let-d="dismiss">
    <div class="modal-header bg-info text-white border border-2 border-white rounded-top">
        <h5 class="modal-title">
            <i class="fa fa-bar-chart me-2"></i>
            Loading Statistics - {{ evenement.evenementName }}
        </h5>
        <button type="button" class="btn btn-outline-light btn-sm rounded-circle ms-auto border border-2 border-white" (click)="c('Close click')" aria-label="Close">
            <i class="fa fa-times"></i>
        </button>
    </div>
    <div class="modal-body">
        <div class="loading-stats-container">
            <!-- Summary Section -->
            <div class="stats-summary mb-4">
                <h6 class="mb-3"><i class="fa fa-clock-o me-2"></i>Summary</h6>
                <div class="row">
                    <div class="col-md-6 mb-2">
                        <div class="stat-item">
                            <strong>Total Load Time:</strong>
                            <span class="badge bg-primary ms-2">{{ formatTime(loadingStats.totalLoadTime) }}</span>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="stat-item">
                            <strong>Component Initialization:</strong>
                            <span class="badge ms-2" 
                                  [class.bg-danger]="getSlowestSummaryOperation() === 'componentInit'"
                                  [class.bg-secondary]="getSlowestSummaryOperation() !== 'componentInit'">
                                {{ formatTime(loadingStats.componentInit) }}
                            </span>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="stat-item">
                            <strong>Thumbnail Load:</strong>
                            <span class="badge ms-2" 
                                  [class.bg-danger]="getSlowestSummaryOperation() === 'thumbnailLoad'"
                                  [class.bg-success]="getSlowestSummaryOperation() !== 'thumbnailLoad'">
                                {{ formatTime(loadingStats.thumbnailLoad) }}
                            </span>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="stat-item">
                            <strong>Color Detection:</strong>
                            <span class="badge ms-2" 
                                  [class.bg-danger]="getSlowestSummaryOperation() === 'colorDetection'"
                                  [class.bg-warning]="getSlowestSummaryOperation() !== 'colorDetection'">
                                {{ formatTime(loadingStats.colorDetection) }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Thumbnails Section -->
            <div class="stats-section mb-4" *ngIf="loadingStats.totalFiles > 0">
                <h6 class="mb-3">
                    <i class="fa fa-file-image-o me-2"></i>
                    File Thumbnails ({{ loadingStats.totalFiles }})
                </h6>
                <div class="mb-2">
                    <strong>Average Load Time:</strong>
                    <span class="badge bg-info ms-2">{{ formatTime(loadingStats.averageFileThumbnailTime) }}</span>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th class="text-end">Load Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let file of loadingStats.fileThumbnails" 
                                [class.table-danger]="file.loadTime === getMaxFileThumbnailTime() && getMaxFileThumbnailTime() > 0">
                                <td>
                                    <small [class.text-danger]="file.loadTime === getMaxFileThumbnailTime() && getMaxFileThumbnailTime() > 0"
                                           [class.fw-bold]="file.loadTime === getMaxFileThumbnailTime() && getMaxFileThumbnailTime() > 0">
                                        {{ file.fileName }}
                                    </small>
                                </td>
                                <td class="text-end">
                                    <span class="badge" 
                                          [class.bg-danger]="file.loadTime === getMaxFileThumbnailTime() && getMaxFileThumbnailTime() > 0"
                                          [class.bg-success]="file.loadTime !== getMaxFileThumbnailTime() && file.loadTime < 500"
                                          [class.bg-warning]="file.loadTime !== getMaxFileThumbnailTime() && file.loadTime >= 500 && file.loadTime < 2000"
                                          [class.bg-secondary]="file.loadTime !== getMaxFileThumbnailTime() && file.loadTime >= 2000">
                                        {{ formatTime(file.loadTime) }}
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Card Slideshow Images Section -->
            <div class="stats-section mb-4" *ngIf="loadingStats.totalCardSlideshowImages > 0">
                <h6 class="mb-3">
                    <i class="fa fa-picture-o me-2"></i>
                    Card Slideshow Images ({{ loadingStats.totalCardSlideshowImages }})
                </h6>
                <div class="mb-2">
                    <strong>Average Load Time:</strong>
                    <span class="badge bg-info ms-2">{{ formatTime(loadingStats.averageCardSlideshowTime) }}</span>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th class="text-end">Load Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let image of loadingStats.cardSlideshowImages" 
                                [class.table-danger]="image.loadTime === getMaxCardSlideshowTime() && getMaxCardSlideshowTime() > 0">
                                <td>
                                    <small [class.text-danger]="image.loadTime === getMaxCardSlideshowTime() && getMaxCardSlideshowTime() > 0"
                                           [class.fw-bold]="image.loadTime === getMaxCardSlideshowTime() && getMaxCardSlideshowTime() > 0">
                                        {{ image.fileName }}
                                    </small>
                                </td>
                                <td class="text-end">
                                    <span class="badge" 
                                          [class.bg-danger]="image.loadTime === getMaxCardSlideshowTime() && getMaxCardSlideshowTime() > 0"
                                          [class.bg-success]="image.loadTime !== getMaxCardSlideshowTime() && image.loadTime < 500"
                                          [class.bg-warning]="image.loadTime !== getMaxCardSlideshowTime() && image.loadTime >= 500 && image.loadTime < 2000"
                                          [class.bg-secondary]="image.loadTime !== getMaxCardSlideshowTime() && image.loadTime >= 2000">
                                        {{ formatTime(image.loadTime) }}
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- No Data Message -->
            <div class="text-center text-muted py-4" *ngIf="loadingStats.totalFiles === 0 && loadingStats.totalCardSlideshowImages === 0">
                <i class="fa fa-info-circle fa-3x mb-3"></i>
                <p>No loading data available yet. Data will appear as elements are loaded.</p>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="c('Close click')">
            <i class="fa fa-times"></i> Close
        </button>
    </div>
</ng-template>

<!-- Visibility Selection Modal -->
<ng-template #visibilityModal let-c="close" let-d="dismiss">
    <div class="modal-header bg-primary text-white border border-2 border-white rounded-top">
        <h5 class="modal-title" style="font-size: calc(1.25rem - 2px);">
            <i class="fa fa-lock me-2"></i> {{ 'EVENTELEM.CHANGE_VISIBILITY' | translate }}
        </h5>
        <button type="button" class="btn btn-outline-light btn-sm rounded-circle ms-auto border border-2 border-white" (click)="d('Cross click')" aria-label="Close">
            <i class="fa fa-times"></i>
        </button>
    </div>
    <div class="modal-body">
        <div class="visibility-options">
            <div *ngFor="let option of visibilityOptions" 
                 class="visibility-option mb-2 p-2 border rounded"
                 [class.selected]="evenement.visibility === option.value"
                 [style.cursor]="'pointer'"
                 [style.background-color]="evenement.visibility === option.value ? getVisibilityBadgeGradient() : 'transparent'"
                 [style.border-color]="evenement.visibility === option.value ? getInverseTextColor() : '#dee2e6'"
                 [style.color]="evenement.visibility === option.value ? getInverseTextColor() : 'inherit'"
                 (click)="onVisibilitySelected(option); option.value !== 'friendGroups' && c('Selected')">
                <i class="fa me-2" 
                   [class.fa-check-circle]="evenement.visibility === option.value"
                   [class.fa-circle-o]="evenement.visibility !== option.value"></i>
                {{ option.label }}
            </div>
        </div>
        
        <!-- Friend Groups Selection (shown when "friendGroups" is selected) -->
        <div *ngIf="evenement.visibility === 'friendGroups'" class="mt-3">
            <label class="form-label fw-bold">
                {{ "EVENTCREATION.SELECT_FRIEND_GROUPS" | translate }}
            </label>
            <div class="friend-groups-checkboxes">
                <div *ngFor="let group of getAuthorizedFriendGroups()" class="form-check mb-2">
                    <input 
                        class="form-check-input" 
                        type="checkbox" 
                        [id]="'group-' + group.id"
                        [checked]="isFriendGroupSelected(group.id)"
                        (change)="toggleFriendGroup(group.id, $event)"
                    />
                    <label class="form-check-label" [for]="'group-' + group.id">
                        {{ group.name }}
                    </label>
                </div>
                <div *ngIf="getAuthorizedFriendGroups().length === 0" class="text-muted">
                    {{ "EVENTCREATION.NO_FRIEND_GROUPS" | translate }}
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button *ngIf="evenement.visibility === 'friendGroups'"
                type="button" 
                class="btn btn-primary me-2" 
                (click)="confirmFriendGroupsSelection()">
            <i class="fa fa-check"></i> {{ 'COMMUN.CONFIRM' | translate }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="c('Close click')">
            <i class="fa fa-times"></i> {{ 'COMMUN.CLOSE' | translate }}
        </button>
    </div>
</ng-template>

<!-- Type Selection Modal -->
<ng-template #typeModal let-c="close" let-d="dismiss">
    <div class="modal-header bg-warning text-white border border-2 border-white rounded-top">
        <h5 class="modal-title" style="font-size: calc(1.25rem - 2px);">
            <i class="fa fa-list-alt me-2"></i> {{ 'EVENTELEM.CHANGE_TYPE' | translate }}
        </h5>
        <button type="button" class="btn btn-outline-light btn-sm rounded-circle ms-auto border border-2 border-white" (click)="d('Cross click')" aria-label="Close">
            <i class="fa fa-times"></i>
        </button>
    </div>
    <div class="modal-body">
        <div class="type-options">
            <div *ngFor="let type of typeOptions" 
                 class="type-option mb-2 p-2 border rounded"
                 [class.selected]="evenement.type === type.value"
                 [style.cursor]="'pointer'"
                 [style.background-color]="evenement.type === type.value ? getStatusBadgeGradient() : 'transparent'"
                 [style.border-color]="evenement.type === type.value ? getInverseTextColor() : '#dee2e6'"
                 [style.color]="evenement.type === type.value ? getInverseTextColor() : 'inherit'"
                 [style.font-size]="'0.875rem'"
                 (click)="onTypeSelected(type); c('Selected')">
                <i class="fa me-2" 
                   [class.fa-check-circle]="evenement.type === type.value"
                   [class.fa-circle-o]="evenement.type !== type.value"></i>
                {{ type.label | translate }}
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="c('Close click')">
            <i class="fa fa-times"></i> Close
        </button>
    </div>
</ng-template>

<!-- Event Access Users Modal -->
<ng-template #eventAccessUsersModal let-c="close" let-d="dismiss">
    <div class="modal-header bg-info text-white border border-2 border-white rounded-top">
        <h5 class="modal-title" style="font-size: calc(1.25rem - 2px);">
            <i class="fa fa-users me-2"></i> {{ 'EVENTELEM.USERS_WITH_ACCESS' | translate }}
            <span *ngIf="evenement.visibility === 'friendGroups' || (evenement.visibility && evenement.visibility !== 'public' && evenement.visibility !== 'private' && evenement.visibility !== 'friends')" class="ms-2">
                - {{ getVisibilityDisplayText() }}
            </span>
        </h5>
        <div class="d-flex align-items-center ms-auto">
            <!-- WhatsApp button for friend groups if available -->
            <button *ngIf="hasFriendGroupWhatsAppLink()"
                    type="button"
                    class="btn btn-outline-light btn-sm me-2 border border-2 border-white"
                    (click)="openFriendGroupWhatsAppLink(); $event.stopPropagation()"
                    [title]="'FRIENDS.OPEN_WHATSAPP' | translate">
                <i class="fa fa-whatsapp"></i>
            </button>
            <button type="button" class="btn btn-outline-light btn-sm rounded-circle border border-2 border-white" (click)="d('Cross click')" aria-label="Close">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>
    <div class="modal-body">
        <div *ngIf="isLoadingEventAccessUsers" class="text-center py-4">
            <i class="fa fa-spinner fa-spin fa-2x"></i>
            <p class="mt-2">{{ 'COMMUN.LOADING' | translate }}...</p>
        </div>
        <div *ngIf="!isLoadingEventAccessUsers">
            <div *ngIf="eventAccessUsers.length === 0" class="text-center text-muted py-4">
                <i class="fa fa-info-circle fa-3x mb-3"></i>
                <p>{{ 'EVENTELEM.NO_ACCESS_USERS' | translate }}</p>
            </div>
            <div *ngIf="eventAccessUsers.length > 0" class="users-list">
                <div class="mb-3">
                    <strong>{{ 'EVENTELEM.TOTAL_USERS' | translate }}: {{ eventAccessUsers.length }}</strong>
                </div>
                <div class="row g-2">
                    <div *ngFor="let user of eventAccessUsers" 
                         class="col-12 col-md-6">
                        <div class="list-group-item d-flex justify-content-between align-items-center h-100"
                             [style.cursor]="'pointer'"
                             (click)="openUserModal(user)">
                            <div class="d-flex align-items-center flex-grow-1">
                                <i class="fa fa-user ms-2 me-2"></i>
                                <div class="flex-grow-1">
                                    <strong>{{ user.firstName }} {{ user.lastName }}</strong>
                                    <div class="text-muted small">{{ user.userName }}</div>
                                    <div class="text-muted small" *ngIf="user.addressEmail">{{ user.addressEmail }}</div>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <!-- WhatsApp button for user if available -->
                                <button *ngIf="user.whatsappLink" 
                                        class="btn btn-sm btn-outline-success me-2" 
                                        (click)="openUserWhatsAppLink(user); $event.stopPropagation()"
                                        [title]="'FRIENDS.OPEN_WHATSAPP' | translate">
                                    <i class="fa fa-whatsapp"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-primary me-2" 
                                        (click)="openUserModal(user); $event.stopPropagation()"
                                        [title]="'EVENTELEM.VIEW_DETAILS' | translate">
                                    <i class="fa fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="c('Close click')">
            <i class="fa fa-times"></i> {{ 'COMMUN.CLOSE' | translate }}
        </button>
    </div>
</ng-template>

<!-- Delete Event Confirmation Modal -->
<ng-template #deleteEventModal let-c="close" let-d="dismiss">
    <div class="modal-header bg-danger text-white border border-2 border-white rounded-top">
        <h5 class="modal-title">
            <i class="fa fa-exclamation-triangle me-2"></i>
            {{ 'EVENTELEM.DELETE_EVENT_CONFIRM_TITLE' | translate }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="d('Cross click')" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        <p class="text-danger mb-3">
            <i class="fa fa-warning me-2"></i>
            {{ 'EVENTELEM.DELETE_EVENT_CONFIRM_MESSAGE' | translate }}
        </p>
        <ul class="list-unstyled mb-0">
            <li *ngIf="deleteConfirmImageCount > 0" class="mb-2">
                <i class="fa fa-image me-2 text-primary"></i>
                {{ 'EVENTELEM.DELETE_EVENT_CONFIRM_IMAGES' | translate: {count: deleteConfirmImageCount} }}
            </li>
            <li *ngIf="deleteConfirmVideoCount > 0" class="mb-2">
                <i class="fa fa-video-camera me-2 text-danger"></i>
                {{ 'EVENTELEM.DELETE_EVENT_CONFIRM_VIDEOS' | translate: {count: deleteConfirmVideoCount} }}
            </li>
            <li *ngIf="deleteConfirmOtherFilesCount > 0" class="mb-2">
                <i class="fa fa-file me-2 text-secondary"></i>
                {{ 'EVENTELEM.DELETE_EVENT_CONFIRM_OTHER_FILES' | translate: {count: deleteConfirmOtherFilesCount} }}
            </li>
            <li *ngIf="deleteConfirmUrlCount > 0" class="mb-2">
                <i class="fa fa-link me-2 text-info"></i>
                {{ 'EVENTELEM.DELETE_EVENT_CONFIRM_URLS' | translate: {count: deleteConfirmUrlCount} }}
            </li>
            <li *ngIf="deleteConfirmCommentaryCount > 0" class="mb-2">
                <i class="fa fa-comment me-2 text-warning"></i>
                {{ 'EVENTELEM.DELETE_EVENT_CONFIRM_COMMENTARIES' | translate: {count: deleteConfirmCommentaryCount} }}
            </li>
            <li *ngIf="deleteConfirmDiscussionCount > 0" class="mb-2">
                <i class="fa fa-comments me-2 text-success"></i>
                {{ 'EVENTELEM.DELETE_EVENT_CONFIRM_DISCUSSION' | translate: {count: deleteConfirmDiscussionCount} }}
            </li>
            <li class="mb-2">
                <i class="fa fa-comments-o me-2 text-muted"></i>
                {{ 'EVENTELEM.DELETE_EVENT_CONFIRM_CHAT' | translate }}
            </li>
        </ul>
        <p class="text-warning mt-3 mb-0">
            <i class="fa fa-info-circle me-2"></i>
            {{ 'EVENTELEM.DELETE_EVENT_IRREVERSIBLE' | translate }}
        </p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="d('Cancel click')">
            <i class="fa fa-times me-1"></i>
            {{ 'COMMUN.CANCEL' | translate }}
        </button>
        <button type="button" class="btn btn-danger" (click)="confirmDeleteEvent(); c('Delete confirmed')">
            <i class="fa fa-trash me-1"></i>
            {{ 'EVENTELEM.DTE' | translate }}
        </button>
    </div>
</ng-template>
