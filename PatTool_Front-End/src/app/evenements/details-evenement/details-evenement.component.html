<!-- Loading Spinner -->
<div *ngIf="loading" class="loading-container">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">{{ 'COMMUN.LOADING' | translate }}</span>
  </div>
  <p class="mt-3 text-muted">{{ 'COMMUN.LOADING' | translate }}</p>
</div>

<!-- Error Message -->
<div *ngIf="error && !loading" class="error-container">
  <div class="alert alert-danger" role="alert">
    <i class="fa fa-exclamation-triangle me-2"></i>
    {{ error }}
  </div>
  <button class="btn btn-primary" (click)="goBack()">
    <i class="fa fa-arrow-left me-2"></i>
    {{ 'COMMUN.BACK' | translate }}
  </button>
</div>

<!-- Slideshow Modal Component (always available) -->
<app-slideshow-modal #slideshowModalComponent (closed)="onSlideshowClosed()" (openLocationInTrace)="onSlideshowLocationInTrace($event)"></app-slideshow-modal>

<!-- Trace Viewer Modal Component -->
<app-trace-viewer-modal #traceViewerModalComponent (closed)="onTraceViewerClosed()"></app-trace-viewer-modal>

<!-- Artistic Event Details Page -->
<div *ngIf="evenement && !loading && !error" class="artistic-event-page" [ngClass]="getTextColorClass()">
  
  <!-- Navigation Buttons - Below menu on the left -->
  <app-navigation-buttons></app-navigation-buttons>
  
  <!-- Background Image Layer -->
  <div class="background-image-layer" [style.background-image]="getMainBackgroundImage()"></div>
  
  <!-- Blur Overlay Layer -->
  <div class="blur-overlay-layer"></div>
  
  <!-- Content Layer -->
  <div class="content-layer">
    
    <!-- Header Section -->
    <header class="artistic-header">
      <div class="header-content">
        <div class="header-title-row">
          <h1 class="event-title" [ngStyle]="getEventTitleStyles()">
            {{ evenement.evenementName }}
            <span class="event-color-badge" *ngIf="getCalculatedColor()" [ngStyle]="getColorBadgeStyles()">
              RGB({{ getCalculatedColor()?.r }}, {{ getCalculatedColor()?.g }}, {{ getCalculatedColor()?.b }})
            </span>
          </h1>
        </div>
        <div class="event-meta">
          <span class="meta-item">
            <i class="fa fa-calendar"></i>
            <span *ngIf="evenement.beginEventDate">
              {{ 'COMMUN.FROM' | translate }} {{ formatEventDateTime(evenement.beginEventDate, evenement.startHour) }}
            </span>
            <span *ngIf="evenement.endEventDate && evenement.endEventDate !== evenement.beginEventDate">
              {{ 'COMMUN.TO' | translate }} {{ formatEventDateTime(evenement.endEventDate, '') }}
            </span>
            <span *ngIf="evenement.endEventDate && evenement.endEventDate === evenement.beginEventDate && evenement.startHour">
              {{ formatEventDateTime(evenement.beginEventDate, evenement.startHour) }}
            </span>
          </span>
          <span class="meta-item" *ngIf="evenement && evenement.author">
            <i class="fa fa-user"></i>
            {{ evenement.author.firstName }} {{ evenement.author.lastName }} <span class="owner-username" *ngIf="evenement.author.userName">({{ evenement.author.userName }})</span>
          </span>
        </div>
      </div>
    </header>

    <!-- Action Container - Below header badges -->
    <div class="action-container" *ngIf="(user && evenement) || evenement">
      <div class="action-container-inline">
        <div class="edit-event-wrapper" *ngIf="isEventOwner()">
          <button type="button"
                  class="btn-compact btn-primary-compact"
                  (click)="navigateToUpdateEvent()"
                  [title]="'EVENTHOME.EDIT_EVENT' | translate">
            <i class="fa fa-edit"></i> {{ 'EVENTHOME.EDIT_EVENT' | translate }}
          </button>
        </div>
        <div class="file-upload-wrapper" *ngIf="user && evenement">
          <label [for]="'file-upload-input-' + evenement.id" 
                 class="btn-compact btn-success-compact">
            <i class="fa fa-upload"></i> {{ 'EVENTELEM.UPLOAD' | translate }}
          </label>
          <input type="file" 
                 [id]="'file-upload-input-' + evenement.id" 
                 #fileInput 
                 (change)="onFileSelected($event)" 
                 multiple 
                 accept="image/*,video/*,.mp4,.webm,.ogg,.ogv,.mov,.avi,.mkv,.flv,.wmv,.m4v,.3gp,.pdf,.doc,.docx,.xls,.xlsx,.ods,.odt,.txt,.zip,.rar,.gpx,.kml,.kmz,.gdb,.tcx" 
                 style="display: none;" />
        </div>
        <div class="notes-section" *ngIf="evenement && evenement.notes">
          <div class="notes-content">
            <p class="notes-text">{{ evenement.notes }}</p>
          </div>
        </div>
        <div class="rating-section" *ngIf="evenement">
          <button type="button" 
                  class="rating-badge rating-plus btn-rating" 
                  (click)="addRatePlus()"
                  [ngbTooltip]="'COMMUN.ILIKE' | translate"
                  placement="top">
            <i class="fa fa-thumbs-up"></i> {{ evenement.ratingPlus || 0 }}
          </button>
          <!-- Star Rating Display -->
          <div class="star-rating-display">
            <span *ngFor="let star of getStarRating(); let i = index" 
                  class="star-icon"
                  [class.star-filled]="star === 1"
                  [class.star-half]="star === 0.5"
                  [class.star-empty]="star === 0">
              <i class="fa" 
                 [class.fa-star]="star === 1"
                 [class.fa-star-half-o]="star === 0.5"
                 [class.fa-star-o]="star === 0"></i>
            </span>
            <span class="star-rating-value" *ngIf="getOverallRating() > 0">
              {{ getOverallRating() | number:'1.1-1' }}
            </span>
          </div>
          <button type="button" 
                  class="rating-badge rating-minus btn-rating" 
                  (click)="addRateMinus()"
                  [ngbTooltip]="'COMMUN.IDONTLIKE' | translate"
                  placement="top">
            <i class="fa fa-thumbs-down"></i> {{ evenement.ratingMinus || 0 }}
          </button>
        </div>
        <div class="add-commentary-wrapper" *ngIf="evenement">
          <button type="button"
                  class="btn-compact btn-primary-compact"
                  (click)="openAddCommentary(); $event.stopPropagation()"
                  [title]="'EVENTHOME.ADD_COMMENTARY' | translate">
            <i class="fa fa-comment"></i> <span class="btn-text">{{ 'EVENTHOME.COMMENTARIES' | translate }}</span>
          </button>
        </div>
        <div class="add-discussion-wrapper" *ngIf="evenement">
          <button type="button"
                  class="btn-compact btn-primary-compact"
                  (click)="openDiscussion(); $event.stopPropagation()"
                  [title]="'EVENTELEM.OPEN_DISCUSSION' | translate">
            <i class="fa fa-comments"></i> <span class="btn-text">{{ 'EVENTELEM.CHAT' | translate }}</span>
          </button>
        </div>
      </div>
      <!-- Hidden commentary editor for when there are no comments -->
      <app-commentary-editor
        *ngIf="evenement && (!evenement.commentaries || evenement.commentaries.length === 0)"
        [showAddButton]="false"
        #commentaryEditor
        [commentaries]="evenement.commentaries || []"
        [currentUser]="user"
        [eventId]="evenement.id"
        [eventColor]="getCalculatedColor()"
        [useCalculatedColorsForModal]="true"
        (commentaryAdded)="onCommentaryAdded($event)"
        (commentaryUpdated)="onCommentaryUpdated($event)"
        (commentaryDeleted)="onCommentaryDeleted($event)"
        style="display: none;">
      </app-commentary-editor>
    </div>

    <!-- Main Content Container - Dynamic Grid -->
    <div class="dynamic-grid-container">

      <!-- First Row: 4 Cards Container (Description, Visibility, Type, Rating) - Full Width -->
      <div class="first-row-cards-container">
        <!-- Description Card - Medium Vertical -->
        <div class="dynamic-card card-medium card-vertical description-card"
             *ngIf="evenement.comments"
             [ngClass]="getCardLayoutClasses('description')"
             [style.order]="getCardOrder('description')">
          <div class="card-header-compact">
            <i class="fa fa-quote-left"></i>
            <span>{{ 'EVENTELEM.DESCRIPTION' | translate }}</span>
          </div>
          <div class="description-content-compact">
            <p class="description-text-compact">{{ evenement.comments }}</p>
          </div>
        </div>

        <!-- Visibility Card - Medium Vertical -->
        <div class="dynamic-card card-medium card-vertical visibility-card"
             *ngIf="evenement"
             [ngClass]="getCardLayoutClasses('visibility')"
             [style.order]="getCardOrder('visibility')">
          <div class="card-header-compact">
            <i class="fa fa-eye"></i>
            <span>{{ 'EVENTCREATION.VISIBILITY' | translate }}</span>
          </div>
          <div class="visibility-content-compact">
            <div class="visibility-badge-wrapper">
              <span class="visibility-badge-compact" [ngSwitch]="evenement.visibility">
                <span *ngSwitchCase="'public'" class="badge-compact badge-public-compact">
                  <i class="fa fa-globe"></i> {{ 'EVENTCREATION.PUBLIC' | translate }}
                </span>
                <span *ngSwitchCase="'private'" class="badge-compact badge-private-compact">
                  <i class="fa fa-lock"></i> {{ 'EVENTCREATION.PRIVATE' | translate }}
                </span>
                <span *ngSwitchCase="'friends'" class="badge-compact badge-friends-compact">
                  <i class="fa fa-users"></i> {{ 'EVENTCREATION.FRIENDS' | translate }}
                </span>
                <span *ngSwitchCase="'friendGroups'" class="badge-compact badge-group-compact">
                  <i class="fa fa-group"></i> {{ getVisibilityDisplayText() || ('EVENTCREATION.FRIEND_GROUPS' | translate) }}
                </span>
                <span *ngSwitchDefault class="badge-compact badge-group-compact">
                  <i class="fa fa-group"></i> {{ getVisibilityDisplayText() || evenement.visibility }}
                </span>
              </span>
            </div>
            <!-- WhatsApp buttons for each friend group with WhatsApp link -->
            <div *ngIf="getEventFriendGroups().length > 0" class="whatsapp-buttons-container">
              <ng-container *ngFor="let group of getEventFriendGroups()">
                <button *ngIf="group.whatsappLink && group.whatsappLink.trim().length > 0"
                        class="btn-compact btn-whatsapp-compact"
                        (click)="openFriendGroupWhatsAppLink(group)"
                        [title]="('FRIENDS.OPEN_WHATSAPP' | translate) + ' - ' + group.name">
                  <i class="fa fa-whatsapp"></i> {{ group.name }}
                </button>
              </ng-container>
            </div>
            
            <!-- Users with Access -->
            <div class="users-with-access-compact">
              <div *ngIf="isLoadingEventAccessUsers" class="text-center py-2">
                <i class="fa fa-spinner fa-spin"></i>
                <small class="text-muted ms-2">{{ 'COMMUN.LOADING' | translate }}...</small>
              </div>
              <div *ngIf="!isLoadingEventAccessUsers">
                <div *ngIf="eventAccessUsers.length === 0" class="text-center text-muted py-2">
                  <small><i class="fa fa-info-circle"></i> {{ 'EVENTELEM.NO_ACCESS_USERS' | translate }}</small>
                </div>
                <div *ngIf="eventAccessUsers.length > 0">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <small class="d-block mb-0">
                      <strong>{{ 'EVENTELEM.TOTAL_USERS' | translate }}: {{ eventAccessUsers.length }}</strong>
                    </small>
                    <button class="btn btn-sm btn-outline-light"
                            (click)="toggleEventAccessUsersExpanded()"
                            [title]="isEventAccessUsersExpanded ? ('COMMUN.COLLAPSE' | translate) : ('COMMUN.EXPAND' | translate)"
                            style="padding: 0.2rem 0.5rem; font-size: 0.7rem; border: 1px solid rgba(255, 255, 255, 0.3);">
                      <i class="fa" [class.fa-chevron-up]="isEventAccessUsersExpanded" [class.fa-chevron-down]="!isEventAccessUsersExpanded"></i>
                    </button>
                  </div>
                  <div class="users-list-compact">
                    <div *ngFor="let user of (isEventAccessUsersExpanded ? eventAccessUsers : []); let i = index" 
                         class="user-item-compact d-flex justify-content-between align-items-center mb-1 p-2 rounded"
                         style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);">
                      <div class="d-flex align-items-center flex-grow-1">
                        <i class="fa fa-user me-2"></i>
                        <div class="flex-grow-1">
                          <div class="fw-bold small">{{ user.firstName }} {{ user.lastName }}</div>
                          <div class="text-muted" style="font-size: 0.75rem;">{{ user.userName }}</div>
                        </div>
                      </div>
                      <div class="d-flex align-items-center">
                        <button *ngIf="user.whatsappLink" 
                                class="btn btn-sm btn-outline-success me-1" 
                                (click)="openUserWhatsAppLink(user); $event.stopPropagation()"
                                [title]="'FRIENDS.OPEN_WHATSAPP' | translate"
                                style="padding: 0.2rem 0.4rem; font-size: 0.7rem;">
                          <i class="fa fa-whatsapp"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Type Card - Medium Vertical -->
        <div class="dynamic-card card-medium card-vertical type-card"
             *ngIf="evenement"
             [ngClass]="getCardLayoutClasses('type')"
             [style.order]="getCardOrder('type')">
          <div class="card-header-compact">
            <i class="fa fa-info-circle"></i>
            <span>{{ 'EVENTELEM.TYPE' | translate }}</span>
          </div>
          <div class="type-content-compact">
            <div class="info-list-compact">
              <div class="info-item-compact">
                <span class="info-label">{{ 'EVENTELEM.TYPE' | translate }}:</span>
                <span class="info-value">{{ getEventTypeLabel(evenement.type) | translate }}</span>
              </div>
              <div class="info-item-compact" *ngIf="evenement.status">
                <span class="info-label">{{ 'EVENTELEM.STATUS' | translate }}:</span>
                <span class="status-badge-compact" [ngSwitch]="evenement.status">
                  <span *ngSwitchCase="'Open'" class="badge-compact badge-status-open">{{ 'COMMUN.STATUSOPEN' | translate }}</span>
                  <span *ngSwitchCase="'Closed'" class="badge-compact badge-status-closed">{{ 'COMMUN.STATUSCLOSE' | translate }}</span>
                  <span *ngSwitchCase="'Cancel'" class="badge-compact badge-status-cancel">{{ 'COMMUN.STATUSCANCEL' | translate }}</span>
                </span>
              </div>
              <div class="info-item-compact" *ngIf="evenement.diffculty">
                <span class="info-label">{{ 'EVENTELEM.DIFF' | translate }}:</span>
                <span class="info-value">{{ getDifficultyLabel(evenement.diffculty) | translate }}</span>
              </div>
              <div class="info-item-compact" *ngIf="evenement.startLocation">
                <span class="info-label">{{ 'EVENTELEM.STARTLOCATION' | translate }}:</span>
                <span class="info-value">{{ evenement.startLocation }}</span>
              </div>
              <div class="info-item-compact" *ngIf="evenement.durationEstimation">
                <span class="info-label">{{ 'EVENTELEM.DURATION' | translate }}:</span>
                <span class="info-value">{{ evenement.durationEstimation }}</span>
              </div>
            </div>
          </div>
        </div>

      <!-- End First Row Cards Container -->


      <!-- Discussion Card - Large Vertical -->
      <div class="dynamic-card card-large card-vertical discussion-card"
           *ngIf="hasDiscussion() && discussionMessages.length > 0"
           [ngClass]="getCardLayoutClasses('discussion')"
           [style.order]="getCardOrder('discussion')"
           [ngStyle]="getCardGridPosition('discussion')">
        <div class="card-header-compact">
          <i class="fa fa-comments"></i>
          <span>{{ 'EVENTELEM.CHAT' | translate }}</span>
          <button type="button" class="btn-compact btn-primary-compact ms-auto" (click)="openDiscussion(); $event.stopPropagation()" [title]="'EVENTELEM.OPEN_DISCUSSION' | translate">
            <i class="fa fa-external-link"></i>
          </button>
        </div>
        
        <!-- Loading State -->
        <div *ngIf="isLoadingDiscussion" class="discussion-loading-compact">
          <i class="fa fa-spinner fa-spin"></i>
          <span>{{ 'COMMUN.LOADING' | translate }}</span>
        </div>
        
        <!-- Error State -->
        <div *ngIf="discussionError && !isLoadingDiscussion" class="discussion-error-compact">
          <i class="fa fa-exclamation-triangle"></i>
          <span>{{ discussionError }}</span>
        </div>
        
        <!-- Messages List -->
        <div #discussionMessagesContainer *ngIf="!isLoadingDiscussion && !discussionError" class="discussion-messages-compact">
          <div *ngIf="discussionMessages.length === 0" class="discussion-empty-compact">
            <i class="fa fa-comments"></i>
            <p>{{ 'EVENTELEM.NO_MESSAGES_YET' | translate }}</p>
          </div>
          
          <div *ngIf="discussionMessages.length > 0" class="discussion-messages-list-compact">
            <div class="discussion-message-row-compact"
                 *ngFor="let message of discussionMessages"
                 [class.is-own]="isOwnDiscussionMessage(message)">
              <div class="discussion-message-compact">
              <div class="message-header-compact">
                <div class="message-author-compact">
                  <i class="fa fa-user-circle"></i>
                  <strong>{{ message.author?.firstName }} {{ message.author?.lastName }}</strong>
                  <span class="message-username-compact">{{ '@' + message.author?.userName }}</span>
                </div>
                <div class="message-date-compact">{{ formatDiscussionDate(message.dateTime) }}</div>
              </div>
              
              <div class="message-content-compact">
                <p class="message-text-compact" *ngIf="message.message">{{ message.message }}</p>
                
                <!-- Message Image -->
                <div class="message-image-compact" *ngIf="message.imageUrl">
                  <img *ngIf="hasDiscussionFileUrl(message.imageFileName || '', 'images', message.imageUrl) && !hasDiscussionImageError(message.id)"
                       [src]="getDiscussionFileUrl(message.imageFileName || '', 'images', message.imageUrl)" 
                       [alt]="message.imageFileName || ('EVENTELEM.IMAGE' | translate)"
                       class="discussion-image-compact"
                       loading="lazy"
                       (error)="onImageError($event)"
                       (click)="openImageInModal(message)"
                       style="max-width: 100%; height: auto;">
                  <div *ngIf="hasDiscussionImageError(message.id)" class="discussion-message-error text-center p-2" style="background: rgba(255, 0, 0, 0.1); border: 1px solid rgba(255, 0, 0, 0.3); border-radius: 4px; color: #ff6b6b;">
                    <i class="fa fa-exclamation-triangle"></i>
                    <small>{{ 'EVENTELEM.IMAGE_DELETED' | translate: {filename: getDeletedImageFilename(message.id)} }}</small>
                  </div>
                  <div *ngIf="!hasDiscussionFileUrl(message.imageFileName || '', 'images', message.imageUrl) && !hasDiscussionImageError(message.id)" class="discussion-message-loading">
                    <i class="fa fa-spinner fa-spin"></i> {{ 'EVENTELEM.LOADING_IMAGES' | translate }}
                  </div>
                </div>
                
                <!-- Message Video -->
                <div class="message-video-compact" *ngIf="message.videoUrl">
                  <video *ngIf="hasDiscussionFileUrl(message.videoFileName || '', 'videos', message.videoUrl)"
                         [src]="getDiscussionFileUrl(message.videoFileName || '', 'videos', message.videoUrl)" 
                         controls
                         autoplay
                         muted
                         playsinline
                         preload="auto"
                         class="discussion-video-compact"
                         style="max-width: 100%; height: auto;"
                         (loadeddata)="onDiscussionVideoLoaded($event)"
                         (canplay)="onDiscussionVideoLoaded($event)">
                    {{ 'EVENTELEM.VIDEO_NOT_SUPPORTED' | translate }}
                  </video>
                  <div *ngIf="!hasDiscussionFileUrl(message.videoFileName || '', 'videos', message.videoUrl)" class="discussion-message-loading">
                    <i class="fa fa-spinner fa-spin"></i> {{ 'EVENTELEM.LOADING_VIDEOS' | translate }}
                  </div>
                </div>
              </div>
            </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Photo Gallery - Medium Vertical -->
      <div class="dynamic-card card-medium card-vertical photos-card"
           *ngIf="photoItemsList.length > 0"
           [ngClass]="getCardLayoutClasses('upload')"
           [style.order]="getCardOrder('upload')"
           [ngStyle]="getCardGridPosition('upload')">
        <div class="card-header-compact">
          <i class="fa fa-camera"></i>
          <span>{{ 'EVENTELEM.PHOTOS' | translate }} ({{ photoItemsList.length }})</span>
          <button type="button" 
                  class="btn-compact btn-primary-compact ms-auto" 
                  (click)="togglePhotoGalleryAutoplay(); $event.stopPropagation()" 
                  [title]="isPhotoGalleryAutoplay ? ('EVENTELEM.STOP_AUTOPLAY' | translate) : ('EVENTELEM.START_AUTOPLAY' | translate)"
                  *ngIf="photoItemsList.length > 1">
            <i class="fa" [class.fa-pause]="isPhotoGalleryAutoplay" [class.fa-play]="!isPhotoGalleryAutoplay"></i>
          </button>
          <button type="button" class="btn-compact btn-primary-compact ms-2" (click)="openPhotosMaximized(); $event.stopPropagation()" [title]="'EVENTELEM.MAXIMIZE' | translate">
            <i class="fa fa-external-link"></i>
          </button>
        </div>
        <div class="photo-gallery">
          <div class="photo-viewer">
            <div class="photo-slider" [style.transform]="'translateX(-' + (currentPhotoIndex * 100) + '%)'">
              <div class="photo-frame" *ngFor="let photoItem of photoItemsList; let i = index">
                <img [src]="photoItem.imageUrl" 
                     [alt]="photoItem.file.fileName" 
                     class="photo-img"
                     loading="lazy"
                     (click)="openPhotosMaximized(i)"
                     (load)="onImageLoad($event)"
                     (error)="onImageError($event)"
                     style="max-width: 100%; height: auto;">
              </div>
            </div>
          </div>
          <button class="photo-nav prev" (click)="prevPhoto()" *ngIf="photoItemsList.length > 1">
            <i class="fa fa-chevron-left"></i>
          </button>
          <button class="photo-nav next" (click)="nextPhoto()" *ngIf="photoItemsList.length > 1">
            <i class="fa fa-chevron-right"></i>
          </button>
        </div>
      </div>

      <!-- Comments - Medium Vertical -->
      <div class="dynamic-card card-medium card-vertical comments-card"
           *ngIf="evenement && evenement.commentaries && evenement.commentaries.length > 0"
           [ngClass]="getCardLayoutClasses('comments')"
           [style.order]="getCardOrder('comments')">
        <div class="card-header-compact">
          <i class="fa fa-comments"></i>
          <span>{{ 'EVENTHOME.COMMENTARIES' | translate }} ({{ evenement.commentaries.length || 0 }})</span>
          <button type="button"
                  class="btn-compact btn-primary-compact ms-auto"
                  (click)="openAddCommentary(); $event.stopPropagation()"
                  [title]="'EVENTHOME.ADD_COMMENTARY' | translate"
                  [ngStyle]="getCommentsAddButtonStyle()">
            <i class="fa fa-plus"></i>
          </button>
        </div>
        <div class="card-body-compact">
          <app-commentary-editor
            [showAddButton]="false"
            #commentaryEditor
            [commentaries]="evenement.commentaries || []"
            [currentUser]="user"
            [eventId]="evenement.id"
            [eventColor]="getCalculatedColor()"
            [useCalculatedColorsForModal]="true"
            (commentaryAdded)="onCommentaryAdded($event)"
            (commentaryUpdated)="onCommentaryUpdated($event)"
            (commentaryDeleted)="onCommentaryDeleted($event)">
          </app-commentary-editor>
        </div>
      </div>

      <!-- URLs - Medium Vertical -->
      <div class="dynamic-card card-medium card-vertical urls-card"
           *ngIf="evenement && getNonPhotoFromFsUrlEventsCount() > 0"
           [ngClass]="getCardLayoutClasses('urls')"
           [style.order]="getCardOrder('urls')"
           [ngStyle]="getCardGridPosition('urls')">
        <div class="card-header-compact">
          <i class="fa fa-link"></i>
          <span>{{ 'EVENTELEM.URLS' | translate }} ({{ getNonPhotoFromFsUrlEventsCount() }})</span>
          <button type="button"
                  class="btn-compact btn-primary-compact ms-auto"
                  *ngIf="!isAddingUrlEvent"
                  (click)="startAddUrlEvent(); $event.stopPropagation()"
                  [title]="'EVENTHOME.ADD_URL_EVENT' | translate">
            <i class="fa fa-plus"></i>
          </button>
        </div>

        <!-- Add link form -->
        <div class="compact-form" *ngIf="isAddingUrlEvent">
          <div class="compact-grid">
            <select [(ngModel)]="newUrlEvent.typeUrl" name="newUrlType" class="compact-input compact-full-row">
              <option value="">{{ 'EVENTHOME.TYPE_URL' | translate }}</option>
              <option *ngFor="let type of getSortedUrlEventTypes()" [value]="type.id">{{ type.label | translate }}</option>
            </select>

            <div class="compact-input-group compact-full-row">
              <input [(ngModel)]="newUrlEvent.link"
                     name="newUrlLink"
                     type="text"
                     class="compact-input"
                     [placeholder]="'EVENTHOME.PLACEHOLDER_URL' | translate"
                     (input)="onNewLinkInputChange($any($event.target).value)"
                     (blur)="onNewLinkBlur()">
              <button *ngIf="newUrlEvent.typeUrl === 'PHOTOFROMFS'"
                      type="button"
                      class="btn-compact btn-secondary-compact"
                      (click)="selectDirectory()"
                      [title]="'EVENTHOME.CHOOSE_FOLDER' | translate">
                <i class="fa fa-folder-open"></i>
              </button>
            </div>

            <input #directoryInput type="file" webkitdirectory style="display:none" (change)="onDirectorySelected($event)">

            <input [(ngModel)]="newUrlEvent.urlDescription"
                   name="newUrlDesc"
                   type="text"
                   class="compact-input compact-full-row"
                   placeholder="{{ 'EVENTHOME.LINK_DESCRIPTION_PLACEHOLDER' | translate }}">
          </div>

          <div class="compact-form-actions">
            <button type="button" class="btn-compact btn-success-compact" (click)="addUrlEvent()">
              <i class="fa fa-check"></i> {{ 'EVENTHOME.SAVE_URL_EVENT' | translate }}
            </button>
            <button type="button" class="btn-compact btn-secondary-compact" (click)="cancelAddUrlEvent()">
              <i class="fa fa-times"></i> {{ 'EVENTHOME.CANCEL_URL_EVENT' | translate }}
            </button>
          </div>
        </div>

        <div class="urls-list-compact">
          <div *ngIf="getNonPhotoFromFsUrlEventsCount() === 0" class="empty-state-compact">
            <i class="fa fa-link"></i>
            <p>{{ 'EVENTHOME.NO_LINKS_ADDED' | translate }}</p>
          </div>

          <div *ngFor="let typeKey of getSortedTypeKeys()" class="url-type-compact">
            <div class="url-type-header-compact">
              <i class="fa {{ getUrlTypeIcon(typeKey) }}"></i>
              {{ getUrlTypeLabel(typeKey) | translate }} ({{ getGroupedUrlEvents()[typeKey].length }})
            </div>
            <div class="url-items-compact">
              <div class="url-item-compact" *ngFor="let urlEvent of getGroupedUrlEvents()[typeKey]">

                <!-- Display mode -->
                <ng-container *ngIf="editingUrlEventIndex !== evenement.urlEvents.indexOf(urlEvent); else editUrlTpl">
                  <div class="url-link-compact" *ngIf="urlEvent.link">
                    <span *ngIf="isPhotoFromFs(urlEvent)" class="url-link-text">
                      <i class="fa {{ getUrlEventIcon(urlEvent) }}"></i>
                      {{ urlEvent.urlDescription || getWebsiteTitle(urlEvent.link) }}
                    </span>
                    <a *ngIf="!isPhotoFromFs(urlEvent)" [href]="urlEvent.link" target="_blank" class="url-link-text">
                      <i class="fa {{ getUrlEventIcon(urlEvent) }}"></i>
                      {{ urlEvent.urlDescription || getWebsiteTitle(urlEvent.link) }}
                    </a>
                    <small class="url-meta-compact">{{ urlEvent.owner }} • {{ formatCommentaryDate(urlEvent.dateCreation) }}</small>
                  </div>

                  <button class="btn-compact btn-fs-compact"
                          *ngIf="isPhotoFromFs(urlEvent)"
                          (click)="openFsPhotosDiaporama(urlEvent.link)">
                    <i class="fa fa-picture-o"></i> {{ 'EVENTELEM.SLIDESHOW' | translate }}
                  </button>

                  <div class="compact-item-actions" *ngIf="canEditUrlEvent(urlEvent) || canDeleteUrlEvent(urlEvent)">
                    <button type="button"
                            class="btn-compact btn-primary-compact"
                            *ngIf="canEditUrlEvent(urlEvent)"
                            (click)="startEditUrlEvent(urlEvent)"
                            [title]="'EVENTHOME.EDIT_LINK' | translate">
                      <i class="fa fa-edit"></i>
                    </button>
                    <button type="button"
                            class="btn-compact btn-secondary-compact"
                            *ngIf="canDeleteUrlEvent(urlEvent)"
                            (click)="removeUrlEvent(urlEvent)"
                            [title]="'EVENTHOME.REMOVE_URL_EVENT' | translate">
                      <i class="fa fa-trash"></i>
                    </button>
                  </div>
                </ng-container>

                <!-- Edit mode -->
                <ng-template #editUrlTpl>
                  <div class="compact-grid">
                    <select [(ngModel)]="editingUrlEvent.typeUrl" name="editUrlType" class="compact-input compact-full-row">
                      <option value="">{{ 'EVENTHOME.TYPE_URL' | translate }}</option>
                      <option *ngFor="let type of getSortedUrlEventTypes()" [value]="type.id">{{ type.label | translate }}</option>
                    </select>

                    <div class="compact-input-group compact-full-row">
                      <input [(ngModel)]="editingUrlEvent.link"
                             name="editUrlLink"
                             type="text"
                             class="compact-input"
                             [placeholder]="'EVENTHOME.PLACEHOLDER_URL' | translate"
                             (input)="onEditLinkInputChange($any($event.target).value)"
                             (blur)="onEditLinkBlur()">
                      <button *ngIf="editingUrlEvent.typeUrl === 'PHOTOFROMFS'"
                              type="button"
                              class="btn-compact btn-secondary-compact"
                              (click)="selectDirectoryForEdit()"
                              [title]="'EVENTHOME.CHOOSE_FOLDER' | translate">
                        <i class="fa fa-folder-open"></i>
                      </button>
                    </div>

                    <input #editDirectoryInput type="file" webkitdirectory style="display:none" (change)="onDirectorySelectedForEdit($event)">

                    <input [(ngModel)]="editingUrlEvent.urlDescription"
                           name="editUrlDesc"
                           type="text"
                           class="compact-input compact-full-row"
                           placeholder="{{ 'EVENTHOME.LINK_DESCRIPTION_PLACEHOLDER' | translate }}">
                  </div>

                  <div class="compact-form-actions">
                    <button type="button" class="btn-compact btn-success-compact" (click)="saveUrlEventEdit()">
                      <i class="fa fa-check"></i>
                    </button>
                    <button type="button" class="btn-compact btn-secondary-compact" (click)="cancelEditUrlEvent()">
                      <i class="fa fa-times"></i>
                    </button>
                  </div>
                </ng-template>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Photos from File System - One card per link with gallery -->
      <ng-container *ngFor="let urlEvent of getPhotoFromFsUrlEvents()">
        <div class="dynamic-card card-medium card-vertical photofromfs-card"
             *ngIf="evenement && urlEvent.link"
             [ngClass]="getCardLayoutClasses('upload')"
             [style.order]="getCardOrder('upload')"
             [ngStyle]="getCardGridPosition('upload')">
          <div class="card-header-compact">
            <i class="fa fa-folder-open"></i>
            <span>{{ urlEvent.urlDescription || getWebsiteTitle(urlEvent.link) }}</span>
            <small class="url-meta-compact ms-2">({{ urlEvent.owner }} • {{ formatCommentaryDate(urlEvent.dateCreation) }})</small>
            <button type="button" 
                    class="btn-compact btn-primary-compact ms-auto" 
                    (click)="togglePhotofromfsAutoplay(urlEvent.link); $event.stopPropagation()" 
                    [title]="isPhotofromfsAutoplay(urlEvent.link) ? ('EVENTELEM.STOP_AUTOPLAY' | translate) : ('EVENTELEM.START_AUTOPLAY' | translate)"
                    *ngIf="getPhotofromfsPhotoItems(urlEvent.link).length > 1">
              <i class="fa" [class.fa-pause]="isPhotofromfsAutoplay(urlEvent.link)" [class.fa-play]="!isPhotofromfsAutoplay(urlEvent.link)"></i>
            </button>
            <button type="button" 
                    class="btn-compact btn-primary-compact ms-2" 
                    (click)="openPhotofromfsMaximized(urlEvent.link, getPhotofromfsCurrentPhotoIndex(urlEvent.link)); $event.stopPropagation()" 
                    [title]="'EVENTELEM.MAXIMIZE' | translate"
                    [disabled]="getPhotofromfsPhotoItems(urlEvent.link).length === 0">
              <i class="fa fa-external-link"></i>
            </button>
          </div>

          <!-- Loading state -->
          <div *ngIf="isPhotofromfsLoading(urlEvent.link)" class="photo-gallery-loading">
            <i class="fa fa-spinner fa-spin"></i>
            <span>{{ 'COMMUN.LOADING' | translate }}</span>
          </div>

          <!-- Gallery -->
          <div class="photo-gallery" *ngIf="!isPhotofromfsLoading(urlEvent.link)">
            <div *ngIf="getPhotofromfsPhotoItems(urlEvent.link).length === 0 && !isPhotofromfsLoading(urlEvent.link)" class="empty-state-compact">
              <i class="fa fa-folder-open"></i>
              <p>{{ 'EVENTHOME.NO_LINKS_ADDED' | translate }}</p>
            </div>

            <div *ngIf="getPhotofromfsPhotoItems(urlEvent.link).length > 0" class="photo-viewer">
              <div class="photo-slider" [style.transform]="'translateX(-' + (getPhotofromfsCurrentPhotoIndex(urlEvent.link) * 100) + '%)'">
                <div class="photo-frame" *ngFor="let photoItem of getPhotofromfsPhotoItems(urlEvent.link); let i = index">
                  <img *ngIf="hasPhotofromfsImageLoaded(photoItem.imageUrl)"
                       [src]="photoItem.imageUrl" 
                       [alt]="photoItem.fileName" 
                       class="photo-img"
                       loading="lazy"
                       (click)="openPhotofromfsMaximized(urlEvent.link, i)"
                       (error)="onImageError($event)">
                  <div *ngIf="!hasPhotofromfsImageLoaded(photoItem.imageUrl)" class="photo-loading-placeholder">
                    <i class="fa fa-spinner fa-spin"></i>
                  </div>
                </div>
              </div>
            </div>

            <button class="photo-nav prev" 
                    (click)="prevPhotofromfsPhoto(urlEvent.link)" 
                    *ngIf="getPhotofromfsPhotoItems(urlEvent.link).length > 1">
              <i class="fa fa-chevron-left"></i>
            </button>
            <button class="photo-nav next" 
                    (click)="nextPhotofromfsPhoto(urlEvent.link)" 
                    *ngIf="getPhotofromfsPhotoItems(urlEvent.link).length > 1">
              <i class="fa fa-chevron-right"></i>
            </button>
          </div>
        </div>
      </ng-container>

      <!-- PDFs - Small Vertical -->
      <div class="dynamic-card card-small card-vertical pdfs-card"
           *ngIf="getPdfFiles().length > 0"
           [ngClass]="getCardLayoutClasses('pdfs')"
           [style.order]="getCardOrder('pdfs')"
           [ngStyle]="getCardGridPosition('pdfs')">
        <div class="card-header-compact">
          <i class="fa fa-file-pdf-o"></i>
          <span>{{ 'EVENTELEM.PDF_DOCUMENTS' | translate }} ({{ getPdfFiles().length }})</span>
        </div>
        <div class="pdfs-list-compact">
          <div class="pdf-item-compact" *ngFor="let pdfFile of getPdfFiles()">
            <div class="pdf-name-compact">{{ pdfFile.fileName }}</div>
            <div class="pdf-meta-compact" *ngIf="pdfFile.uploaderMember.userName || getUploadedFileDate($any(pdfFile))">
              <ng-container *ngIf="pdfFile.uploaderMember.userName">
                <i class="fa fa-user"></i>
                <span class="pdf-owner-compact">{{ pdfFile.uploaderMember.userName }}</span>
              </ng-container>
              <span class="pdf-sep-compact" *ngIf="pdfFile.uploaderMember.userName && getUploadedFileDate($any(pdfFile))">•</span>
              <span class="pdf-date-compact" *ngIf="getUploadedFileDate($any(pdfFile))">
                <i class="fa fa-calendar"></i>
                {{ getUploadedFileDate($any(pdfFile)) | date:'short' }}
              </span>
            </div>
            <div class="pdf-actions-compact">
              <button class="btn-compact btn-primary-compact" (click)="openPdfInPage(pdfFile)" title="{{ 'EVENTELEM.OPEN_PDF' | translate }}">
                <i class="fa fa-eye"></i>
              </button>
              <button class="btn-compact btn-secondary-compact" (click)="downloadPdf(pdfFile)" title="{{ 'EVENTELEM.DOWNLOAD_PDF' | translate }}">
                <i class="fa fa-download"></i>
              </button>
              <button *ngIf="isFileOwner(pdfFile.uploaderMember)"
                      class="btn-compact btn-danger-compact"
                      (click)="delFile(pdfFile.fieldId)"
                      title="{{ 'EVENTELEM.DELETEFILE' | translate }}">
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Track Files (GPX, KML, etc.) - Small Vertical -->
      <div class="dynamic-card card-small card-vertical tracks-card"
           *ngIf="getTrackFiles().length > 0"
           [ngClass]="getCardLayoutClasses('tracks')"
           [style.order]="getCardOrder('tracks')"
           [ngStyle]="getCardGridPosition('tracks')">
        <div class="card-header-compact">
          <i class="fa fa-map-marker"></i>
          <span>{{ 'EVENTELEM.TRACK_FILES' | translate }} ({{ getTrackFiles().length }})</span>
        </div>
        <div class="tracks-list-compact">
          <div class="track-item-compact" *ngFor="let trackFile of getTrackFiles()">
            <div class="track-name-compact">
              <i class="fa" [ngClass]="getTrackFileIcon(trackFile.fileName)"></i>
              {{ trackFile.fileName }}
            </div>
            <div class="track-meta-compact" *ngIf="trackFile.uploaderMember.userName || getUploadedFileDate($any(trackFile))">
              <ng-container *ngIf="trackFile.uploaderMember.userName">
                <i class="fa fa-user"></i>
                <span class="track-owner-compact">{{ trackFile.uploaderMember.userName }}</span>
              </ng-container>
              <span class="track-sep-compact" *ngIf="trackFile.uploaderMember.userName && getUploadedFileDate($any(trackFile))">•</span>
              <span class="track-date-compact" *ngIf="getUploadedFileDate($any(trackFile))">
                <i class="fa fa-calendar"></i>
                {{ getUploadedFileDate($any(trackFile)) | date:'short' }}
              </span>
            </div>
            <div class="track-actions-compact">
              <button class="btn-compact btn-primary-compact" (click)="openTrackFile(trackFile)" title="{{ 'EVENTELEM.OPEN_TRACK' | translate }}">
                <i class="fa fa-map"></i>
              </button>
              <button class="btn-compact btn-secondary-compact" (click)="downloadTrackFile(trackFile)" title="{{ 'EVENTELEM.DOWNLOAD_TRACK' | translate }}">
                <i class="fa fa-download"></i>
              </button>
              <button *ngIf="isFileOwner(trackFile.uploaderMember)"
                      class="btn-compact btn-danger-compact"
                      (click)="delFile(trackFile.fieldId)"
                      title="{{ 'EVENTELEM.DELETEFILE' | translate }}">
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Video Cards - One card per video -->
      <div class="dynamic-card card-medium card-vertical video-card" 
           *ngFor="let videoFile of getVideoFiles(); let i = index"
           [ngClass]="getCardLayoutClasses('upload')"
           [style.order]="getCardOrder('upload')">
        <div class="card-header-compact video-header-compact">
          <div class="video-header-left">
            <i class="fa fa-video-camera"></i>
            <span>{{ videoFile.fileName }}<span *ngIf="getVideoFileSize(videoFile)" class="video-size-badge"> ({{ getVideoFileSize(videoFile) }})</span></span>
          </div>
          <button *ngIf="isFileOwner(videoFile.uploaderMember)"
                  class="btn-compact btn-danger-compact ms-auto"
                  (click)="delFile(videoFile.fieldId)"
                  title="{{ 'EVENTELEM.DELETEFILE' | translate }}">
            <i class="fa fa-trash"></i>
          </button>
        </div>
        <div class="video-meta-compact" *ngIf="videoFile.uploaderMember.userName || getUploadedFileDate($any(videoFile))">
          <ng-container *ngIf="videoFile.uploaderMember.userName">
            <i class="fa fa-user"></i>
            <span class="video-owner-compact">{{ videoFile.uploaderMember.userName }}</span>
          </ng-container>
          <span class="video-sep-compact" *ngIf="videoFile.uploaderMember.userName && getUploadedFileDate($any(videoFile))">•</span>
          <span class="video-date-compact" *ngIf="getUploadedFileDate($any(videoFile))">
            <i class="fa fa-calendar"></i>
            {{ getUploadedFileDate($any(videoFile)) | date:'short' }}
          </span>
        </div>
        <div class="video-container-compact">
          <div *ngIf="!hasVideoUrl(videoFile)" class="video-loading-compact">
            <i class="fa fa-spinner fa-spin"></i>
            <span>{{ 'COMMUN.LOADING' | translate }}</span>
          </div>
          <video 
            *ngIf="hasVideoUrl(videoFile)"
            [src]="getVideoUrl(videoFile)"
            controls
            autoplay
            muted
            loop
            playsinline
            preload="auto"
            class="video-player-compact"
            style="max-width: 100%; height: auto;"
            (error)="onVideoError($event, videoFile)"
            (loadeddata)="onVideoLoaded($event, videoFile)"
            (canplay)="onVideoLoaded($event, videoFile)">
            {{ 'EVENTELEM.VIDEO_NOT_SUPPORTED' | translate }}
          </video>
        </div>
      </div>

    </div>
    <!-- End Dynamic Grid -->
  </div>
  <!-- End Content Layer -->
  
  <!-- Footer Summary -->
  <footer class="event-footer-summary" *ngIf="evenement">
    <div class="footer-summary-content">
      <div class="summary-title">
        <i class="fa fa-list"></i>
        <span>{{ 'EVENTELEM.SUMMARY' | translate }}</span>
      </div>
      <div class="summary-items">
        <div class="summary-item" *ngIf="photoItemsList.length > 0">
          <i class="fa fa-camera"></i>
          <span>{{ 'EVENTELEM.PHOTOS' | translate }}: {{ photoItemsList.length }}</span>
        </div>
        <div class="summary-item" *ngIf="getPhotoFromFsUrlEvents().length > 0">
          <i class="fa fa-folder-open"></i>
          <span>{{ 'EVENTELEM.PHOTOS_FROM_FS' | translate }}: {{ getPhotoFromFsUrlEvents().length }}</span>
        </div>
        <div class="summary-item" *ngIf="evenement.commentaries && evenement.commentaries.length > 0">
          <i class="fa fa-comments"></i>
          <span>{{ 'EVENTHOME.COMMENTARIES' | translate }}: {{ evenement.commentaries.length }}</span>
        </div>
        <div class="summary-item" *ngIf="hasDiscussion() && discussionMessages.length > 0">
          <i class="fa fa-comments"></i>
          <span>{{ 'EVENTELEM.CHAT' | translate }}: {{ discussionMessages.length }}</span>
        </div>
        <div class="summary-item" *ngIf="getNonPhotoFromFsUrlEventsCount() > 0">
          <i class="fa fa-link"></i>
          <span>{{ 'EVENTELEM.URLS' | translate }}: {{ getNonPhotoFromFsUrlEventsCount() }}</span>
        </div>
        <div class="summary-item" *ngIf="getPdfFiles().length > 0">
          <i class="fa fa-file-pdf-o"></i>
          <span>{{ 'EVENTELEM.PDF_DOCUMENTS' | translate }}: {{ getPdfFiles().length }}</span>
        </div>
        <div class="summary-item" *ngIf="getVideoFiles().length > 0">
          <i class="fa fa-video-camera"></i>
          <span>{{ 'EVENTELEM.VIDEOS' | translate }}: {{ getVideoFiles().length }}</span>
        </div>
        <div class="summary-item" *ngIf="getTrackFiles().length > 0">
          <i class="fa fa-map-marker"></i>
          <span>{{ 'EVENTELEM.TRACK_FILES' | translate }}: {{ getTrackFiles().length }}</span>
        </div>
      </div>
    </div>
  </footer>
</div>
<!-- End Artistic Event Page -->

<!-- Image Modal -->
<ng-template #imageModal let-c="close">
  <div class="modal-header">
    <h5 class="modal-title">{{ selectedImageAlt }}</h5>
    <div class="d-flex gap-2">
      <button type="button" class="btn btn-secondary" 
              (click)="toggleFullscreen()"
              [ngbTooltip]="isFullscreen ? ('EVENTELEM.EXIT_FULLSCREEN' | translate) : ('EVENTELEM.FULLSCREEN' | translate)"
              placement="bottom">
        <i [class.fa-arrows-alt]="!isFullscreen" [class.fa-compress]="isFullscreen" class="me-1"></i>
        <span *ngIf="!isFullscreen">{{ 'EVENTELEM.FULLSCREEN' | translate }}</span>
        <span *ngIf="isFullscreen">{{ 'EVENTELEM.EXIT_FULLSCREEN' | translate }}</span>
      </button>
    </div>
    <button type="button" class="btn-close" (click)="c()" [attr.aria-label]="'COMMUN.CLOSE' | translate"><span aria-hidden="true">&times;</span></button>
  </div>
  <div class="modal-body text-center">
    <img [src]="selectedImageUrl" [alt]="selectedImageAlt" class="img-fluid modal-image" style="max-width: 100%; height: auto;" />
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="c()">{{ 'COMMUN.CLOSE' | translate }}</button>
  </div>
</ng-template>

<!-- Upload Logs Modal -->
<ng-template #uploadLogsModal let-modal>
  <div class="modal-header bg-primary text-white">
    <h5 class="modal-title">
      <i class="fa fa-upload me-2"></i>
      {{ 'EVENTELEM.UPLOAD_PROGRESS' | translate }}
    </h5>
    <button type="button" class="btn-close btn-close-white" (click)="modal.dismiss('Cross click')" [attr.aria-label]="'COMMUN.CLOSE' | translate"></button>
  </div>
  <div class="modal-body">
    <div class="upload-logs-content">
      <div class="log-content" #logContent>
        <div class="log-entry" 
             *ngFor="let log of uploadLogs"
             [class.log-success]="log.startsWith('SUCCESS:')"
             [class.log-error]="log.startsWith('ERROR:')">
          {{ log }}
        </div>
        <div *ngIf="uploadLogs.length === 0" class="text-center text-muted">
          {{ 'EVENTELEM.WAITING_FOR_UPLOAD' | translate }}
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()" [disabled]="isUploading">
      {{ 'COMMUN.CLOSE' | translate }}
    </button>
  </div>
</ng-template>

<!-- Video Compression Quality Selection Modal (aligned with element-evenement) -->
<ng-template #qualitySelectionModal let-modal>
  <div class="modal-header bg-primary text-white">
    <h5 class="modal-title">
      <i class="fa fa-video-camera me-2"></i>
      {{ 'EVENTELEM.VIDEO_COMPRESSION_TITLE' | translate }}
    </h5>
    <button type="button" class="btn-close btn-close-white" (click)="cancelQualitySelection()" [attr.aria-label]="'COMMUN.CLOSE' | translate"></button>
  </div>
  <div class="modal-body">
    <p>{{ 'EVENTELEM.VIDEO_COMPRESSION_MESSAGE' | translate: {count: videoCountForModal} }}</p>
    <div class="form-group mb-3">
      <label class="form-label fw-bold">{{ 'EVENTELEM.QUALITY' | translate }}:</label>
      <select class="form-select" [(ngModel)]="selectedCompressionQuality">
        <option value="low">{{ 'EVENTELEM.QUALITY_LOW' | translate }} - {{ 'EVENTELEM.QUALITY_LOW_DESC' | translate }}</option>
        <option value="medium">{{ 'EVENTELEM.QUALITY_MEDIUM' | translate }} - {{ 'EVENTELEM.QUALITY_MEDIUM_DESC' | translate }}</option>
        <option value="high">{{ 'EVENTELEM.QUALITY_HIGH' | translate }} - {{ 'EVENTELEM.QUALITY_HIGH_DESC' | translate }}</option>
        <option value="very-high">{{ 'EVENTELEM.QUALITY_VERY_HIGH' | translate }} - {{ 'EVENTELEM.QUALITY_VERY_HIGH_DESC' | translate }}</option>
        <option value="original">{{ 'EVENTELEM.QUALITY_ORIGINAL' | translate }} - {{ 'EVENTELEM.QUALITY_ORIGINAL_DESC' | translate }}</option>
      </select>
    </div>
    <div class="alert alert-info small">
      <strong>{{ 'EVENTELEM.QUALITY_LOW' | translate }}:</strong> {{ 'EVENTELEM.QUALITY_LOW_DETAILS' | translate }}<br>
      <strong>{{ 'EVENTELEM.QUALITY_MEDIUM' | translate }}:</strong> {{ 'EVENTELEM.QUALITY_MEDIUM_DETAILS' | translate }}<br>
      <strong>{{ 'EVENTELEM.QUALITY_HIGH' | translate }}:</strong> {{ 'EVENTELEM.QUALITY_HIGH_DETAILS' | translate }}<br>
      <strong>{{ 'EVENTELEM.QUALITY_VERY_HIGH' | translate }}:</strong> {{ 'EVENTELEM.QUALITY_VERY_HIGH_DETAILS' | translate }}<br>
      <strong>{{ 'EVENTELEM.QUALITY_ORIGINAL' | translate }}:</strong> {{ 'EVENTELEM.QUALITY_ORIGINAL_DETAILS' | translate }}
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="cancelQualitySelection()">
      {{ 'EVENTELEM.CANCEL' | translate }}
    </button>
    <button type="button" class="btn btn-primary" (click)="confirmQualitySelection()">
      {{ 'EVENTELEM.CONFIRM' | translate }}
    </button>
  </div>
</ng-template>

<!-- Image Compression Selection Modal -->
<ng-template #imageCompressionModal let-modal>
  <div class="modal-header bg-primary text-white">
    <h5 class="modal-title">
      <i class="fa fa-image me-2"></i>
      {{ 'EVENTELEM.IMAGE_COMPRESSION_TITLE' | translate }}
    </h5>
    <button type="button" class="btn-close btn-close-white" (click)="cancelImageCompression()" [attr.aria-label]="'COMMUN.CLOSE' | translate"></button>
  </div>
  <div class="modal-body">
    <p>{{ 'EVENTELEM.IMAGE_COMPRESSION_MESSAGE' | translate: {count: imageCountForModal} }}</p>
    <div class="form-group mb-3">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="compressImagesSwitch" [(ngModel)]="compressImages">
        <label class="form-check-label" for="compressImagesSwitch">
          {{ 'EVENTELEM.COMPRESS_IMAGES' | translate }}
        </label>
      </div>
    </div>
    <div class="alert alert-info small">
      <strong>{{ 'EVENTELEM.COMPRESS_IMAGES_ENABLED' | translate }}:</strong> {{ 'EVENTELEM.COMPRESS_IMAGES_ENABLED_DETAILS' | translate }}<br>
      <strong>{{ 'EVENTELEM.COMPRESS_IMAGES_DISABLED' | translate }}:</strong> {{ 'EVENTELEM.COMPRESS_IMAGES_DISABLED_DETAILS' | translate }}
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="cancelImageCompression()">
      {{ 'EVENTELEM.CANCEL' | translate }}
    </button>
    <button type="button" class="btn btn-primary" (click)="confirmImageCompression()">
      {{ 'EVENTELEM.CONFIRM' | translate }}
    </button>
  </div>
</ng-template>

